/**
 * Developer    :   SongQian
 * Time         :   2021-02-08
 * Descript     :   A, T, K, Y 路口图形组件
 */

(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
    typeof define === 'function' && define.amd ? define(['exports'], factory) :
    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.intersection = {}));
}(this, (function (exports) { 
    'use strict';

    var utils = {
        uuid: function() {
            function S4() {
                return (((1+Math.random()) * 0x10000)|0).toString(16).substring(1);
            }
            return S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4();
        },
        calcRadiusAnyPoint: function(ox, oy, r, angle) {
            //计算圆某角度的点位置
            // angle |= 0;
            // ox |= 0;
            // oy |= 0;
            var x = ox + r * Math.cos(angle * Math.PI / 180);
            var y = oy + r * Math.sin(angle * Math.PI / 180);
            return { x: x, y: y };
        },
        calcTriangleSubtenseLen: function(subtense, angle) {
            //计算等腰三角的底边（弦）的长度
            if(isNaN(subtense) || subtense <= 0) {
                throw new Error('三角边长不能 subtense <= 0值')
            }

            if (isNaN(angle) || angle <= 0) {
                return new Error('三角的角度不能 angle <= 0值')
            }
            var oa = (180 - angle) / 2;
            return 2 * subtense * Math.cos(oa * Math.PI / 180);
        },
        calcTriangleForCH: function(a, b) {
            //计算直角三角形的边（弦）的高
            // var c = Math.sqrt(a * a + b * b);
            // var p = (a + b + c) / 2;
            // var s = Math.sqrt(p * (p - a) * (p - b) * (p - c));
            // return 2 / (c * s);
        },
        calcTriangleHeight: function(c, angle) {
            //计算任意三角形的边（弦）的高
            return Math.sin(angle) * c; 
        },
        calcPointDist: function(a, b) {
            //计算两点距离
            return Math.sqrt((b.x - a.x) * (b.x - a.x) + (b.y - a.y) * (b.y - a.y));
        },
        calcTriangleAngle: function(p1, p2) {
            //计算两点的角度, 0度值在正上方
            var angle = Math.atan2((p2.x - p1.x), (p2.y - p1.y));
            return 180 - (angle * (180 / Math.PI));
        },
        calcLineIntersection: function(p0, p1, p2, p3) {
            //计算两线段的交点
            var A1 = p1.y - p0.y,
			    B1 = p0.x - p1.x,
			    C1 = A1 * p0.x + B1 * p0.y,
			    A2 = p3.y - p2.y,
			    B2 = p2.x - p3.x,
			    C2 = A2 * p2.x + B2 * p2.y,
			    denominator = A1 * B2 - A2 * B1;
            if (denominator == 0) {
                return { x: 0, y: 0 }
            }
            var intersectX = (B2 * C1 - B1 * C2) / denominator,
			intersectY = (A1 * C2 - A2 * C1) / denominator,
			rx0 = (intersectX - p0.x) / (p1.x - p0.x),
			ry0 = (intersectY - p0.y) / (p1.y - p0.y),
			rx1 = (intersectX - p2.x) / (p3.x - p2.x),
			ry1 = (intersectY - p2.y) / (p3.y - p2.y);
            if(((rx0 >= 0 && rx0 <= 1) || (ry0 >= 0 && ry0 <= 1)) && ((rx1 >= 0 && rx1 <= 1) || (ry1 >= 0 && ry1 <= 1))) {
                return {
                    x: intersectX,
                    y: intersectY
                }
            } else {
                return { x: 0, y: 0 };
            }
        }
    }

    //车道绘制
    var LaneRenderer = function() {
        var template = [
            "<g :transform='calcTransform'>",
                "<rect x='0' y='0' width='100' height='499999.5' fill='#333' @click.capture.stop='onPavementClick' />",
                "<line v-if=\"(type === 'solid' || type === 'dotted') && markright && !assist && hasBoundary\" x1='1' x2='1' :y1=\"type === 'dotted' ? 0 : 600\" y2='499999.5' stroke='#fff' stroke-width='2' stroke-dasharray='10,10' style='pointer-events:visibleStroke;' @click.capture.stop='onWhiteLineClick' />",
                "<line v-if=\"(type === 'solid' || type ==='parterre') && markright && hasBoundary\" x1='1' x2='1' y1='0' :y2=\"assist || type === 'parterre' ? '499999.5' : '600' \" stroke='#fff' stroke-width='2' style='pointer-events:visibleStroke;' @click.capture.stop='onParterreBoundaryLineClick' />",
                "<line v-if=\"(type === 'solid' || type === 'dotted') && !markright && !assist  && hasBoundary \" x1='99' x2='99' :y1=\"type === 'dotted' ? 0 : 600\" y2='499999.5' stroke='#fff' stroke-width='2' stroke-dasharray='10,10' style='pointer-events:visibleStroke;' @click.capture.stop='onWhiteLineClick' />",
                "<line v-if=\"(type === 'solid' || type === 'parterre') && !markright && hasBoundary\" x1='99' x2='99' y1='0' :y2=\"assist || type === 'parterre' ? '499999.5' : '600' \" stroke='#fff' stroke-width='2' style='pointer-events:visibleStroke;' @click.capture.stop='onParterreBoundaryLineClick' />",
                "<line v-if=\"['y_dotted', 'y_solid', 'y_double_dashed', 'y_double_solid'].indexOf(type) > -1 && markright && hasBoundary\" x1='1' x2='1' y1='0' y2='499999.5' stroke='#d6cb0a' stroke-width='2' :stroke-dasharray=\"markright && type === 'y_dotted' ? '10,10' : ''\" style='pointer-events:visibleStroke;' @click.capture.stop='onYellowLineClick($event, true)' />",
                "<line v-if=\"['y_double_solid', 'y_double_dashed'].indexOf(type) > -1 && markright && hasBoundary\" x1='5' x2='5' y1='0' y2='499999.5' stroke='#d6cb0a' stroke-width='2' :stroke-dasharray=\"markright && ['y_double_dashed'].indexOf(type) > -1 ? '10,10' : ''\" style='pointer-events:visibleStroke;' @click.capture.stop='onYellowLineClick($event, false)' />",
                "<line v-if=\"['y_dotted', 'y_solid', 'y_double_dashed', 'y_double_solid'].indexOf(type) > -1 && !markright && hasBoundary\" x1='99' x2='99' y1='0' y2='499999.5' stroke='#d6cb0a' stroke-width='2' :stroke-dasharray=\"!markright && type === 'y_dotted' ? '10,10' : ''\" style='pointer-events:visibleStroke;' @click.capture.stop='onYellowLineClick($event, true)' />",
                "<line v-if=\"['y_double_solid', 'y_double_dashed'].indexOf(type) > -1 && !markright && hasBoundary\" x1='95' x2='95' y1='0' y2='499999.5' stroke='#d6cb0a' stroke-width='2' :stroke-dasharray=\"!markright && ['y_double_dashed'].indexOf(type) > -1 ? '10,10' : ''\" style='pointer-events:visibleStroke;' @click.capture.stop='onYellowLineClick($event, false)' />",
                "<rect v-if=\"type === 'y_solid_area' && hasBoundary\" x='15' y='5' width='70' height='499999.5' fill='none' stroke='#d6cb0a' stroke-width='5' style='pointer-events:visibleStroke;' @click.capture.stop='onYellowAreaClick' />",
                "<line v-if=\"type === 'y_solid_area' && hasBoundary\" x1='50' x2='50' y1='0' y2='499999.5' stroke='#d6cb0a' stroke-width='70' stroke-dasharray='30, 50' transform='skewX(45) rotate(45) scale(0.7)' style='pointer-events:visibleStroke;' @click.capture.stop='onYellowAreaClick' />",
                "<rect v-if=\"type === 'parterre'\" x='5' y='0' width='90' height='499999.5' fill='#359f40' @click.capture.stop='onParterreClick' />",
                "<line v-if=\"type === 'parterre'\" x1='25' x2='25' y1='0' y2='499999.5' stroke='#fff' stroke-width='5' style='pointer-events:visibleStroke;' @click.capture.stop='onParterreLineClick($event, true)' />",
                "<line v-if=\"type === 'parterre'\" x1='75' x2='75' y1='0' y2='499999.5' stroke='#fff' stroke-width='5' style='pointer-events:visibleStroke;' @click.capture.stop='onParterreLineClick($event, false)'/>",
                "<circle v-if=\"type === 'parterre' && hasSafeArea\" cx='50' cy='-80' r='42.5' fill='#0075c5' stroke='#fff' stroke-width='5' @click.capture.stop='onParterreSafeAreaClick' />",
                "<rect v-if=\"type === 'parterre' && hasSafeArea\" x='7.5' y='-80' width='85' height='80' fill='#0075c5' stroke='#fff' stroke-width='5' @click.capture.stop='onParterreSafeAreaClick' />",
                "<path v-if=\"type !== 'parterre' && type != 'y_solid_area' \" v-for='(item, i) in calcLaneMark' :d='item.path' fill='#fff' :stroke-width='item.highlight ? 3 : 0' :stroke=\"item.highlight ? '#ff0000' : '#333'\" @click.capture.stop='onLaneMarkClick($event, i)' />",
            "</g>"
        ]
        return template.join("");
    }

    var Lane = Vue.extend({
        template: LaneRenderer.apply(this),
        props: {
            //type : 'solid' | 'dotted' | 'parterre' | 'y_dotted' | 'y_solid' | 'y_double_solid' | 'y_double_dashed' | 'y_solid_area',
            type : { default : 'solid' },
            assist: { default: false, type: Boolean }, // default: false, 是否辅道
            reverse: { default: false, type: Boolean }, // default: false, 是否逆向车道
            markright: { default: true, type: Boolean }, // default: true, 所有的mark标记是否在线路右侧
            hasSafeArea: { default: false, type: Boolean }, //default: false, 是否具有安全岛
            hasBoundary: { default: false, type: Boolean }, // default: false, 是否绘制边线
            landmark: { default: [], type: Array },
            angle: { default: 0, type: Number },
            width: { default: 80, type: Number },
            x: { default: 0, type: Number },
            y: { default: 0, type: Number }
        },
        data: function() {
            return {
            }
        },
        computed: {
            calcTransform: function() {
                var me = this;
                var mx = (Math.cos(me.angle * Math.PI / 180) * me.calcTransformScale).toFixed(6)
                var my = (Math.cos(me.angle * Math.PI / 180) * 1).toFixed(6)
                var m2 = (Math.sin(me.angle * Math.PI / 180) * me.calcTransformScale).toFixed(6)
                var m3 = (-1 * (Math.sin(me.angle * Math.PI / 180) * 1)).toFixed(6)
                return "matrix("+ mx +","+ m2 +","+ m3 +","+ my +", "+ me.x +", "+ me.y +")";
            },
            calcTransformScale: function() {
                var me = this;
                return (me.width / 100).toFixed(3) * 1;
            },
            calcLaneMark: function() {
                var me = this;
                if (me.landmark && me.landmark.length) {
                    var landmarks = [];
                    var landpath = {
                        0 : {
                            left : me.reverse ? "M60,180 L75,155 60,130 60,145 50,140 50,80 35,80 35,150 60,165 60,80 z" : "M40,80 L25,105 40,130 40,115 50,120 50,180 65,180 65,110 40,95 40,80 z",
                            right: me.reverse ? "M40,180 L25,155 40,130 40,145 50,140 50,80 65,80 65,150 40,165 40,80 z" :  "M60,80 L75,105 60,130 60,115 50,120 50,180 35,180 35,110 60,95 60,80 z",
                            straight: me.reverse ? "M50,180 L25,150 40,150 40,80 60,80 60,150 75,150 50,180 z" : "M50,80 L25,110 40,110 40,180 60,180 60,110 75,110 50,80 z",
                            'straight-right' : me.reverse ? "M52.19088075610587,89.52518640528717 L52.19088075610587,80 L70.9453365753878,80 L70.9453365753878,98.75036805251614 L70.89856735888085,98.78161866785217 L70.89856735888085,136.2636067020178 L85,136.2636067020178 L61.5213394492399,180.00196792647887 L38.20688502053156,136.2636067020178 L52.19088075610587,136.2636067020178 L52.19088075610587,111.30686529457614 L38.38460804325791,120.55079731100705 L38.38460804325791,133.12604492226967 L15,114.35067522831685 L38.38460804325791,86.25012191805956 L38.38460804325791,98.75036805251614 L52.19088075610587,89.52518640528717 z" : "M47.70976149823279,170.43375265472486 L47.70976149823279,180 L28.99847138199751,180 L28.99847138199751,161.2129585885323 L29.04513295335969,161.1817228362755 L29.04513295335969,123.71756157952969 L15,123.71756157952969 L38.40077801147733,80.00000272098244 L61.66157133552543,123.71756157952969 L47.70976149823279,123.71756157952969 L47.70976149823279,148.6624333317702 L61.48425736434913,139.4228978142236 L61.48425736434913,126.85363110610737 L85,145.6200710619627 L61.48425736434913,173.7072594912323 L61.48425736434913,161.2129585885323 L47.70976149823279,170.43375265472486 z",
                            'straight-left' : me.reverse ? "M47.69187678931948,111.12793588458692 L47.69187678931948,136.15503771607825 L61.636058321049234,136.15503771607825 L38.38798309172714,180 L15,136.15503771607825 L29.037453335500345,136.15503771607825 L29.037453335500345,80 L47.69187678931948,80 L47.69187678931948,89.38829234451953 L61.636058321049234,98.71419394922509 L61.636058321049234,86.23807140112365 L85,114.28439488925608 L61.636058321049234,133.0235309565054 L61.636058321049234,120.47255167311482 L47.69187678931948,111.12793588458692 z" : "M52.20867948179337,148.7738823685482 L52.20867948179337,123.71295341673175 L38.28453047650009,123.71295341673175 L61.49920699535864,79.99999708452553 L85,123.71295341673175 L70.83630356914226,123.71295341673175 L70.83630356914226,180 L52.20867948179337,180 L52.20867948179337,170.54290963601585 L38.28453047650009,161.20440296030156 L38.28453047650009,173.69738847965175 L15,145.61315703215266 L38.28453047650009,126.84869278208866 L38.28453047650009,139.41663621455493 L52.20867948179337,148.7738823685482 z",
                            uturn : me.reverse ? "M43.58100097106393,180 C28.37053704523235,180 15,162.4108915730634 15,140.10076152555484 L15,138.37538093612966 L15,80 L30.633721426448854,80 L30.633721426448854,138.37538093612966 C30.633721426448854,147.81704706331516 36.299451005108466,155.88479902379515 43.58100097106393,155.88479902379515 C50.562174093687325,155.88479902379515 56.05182061081273,148.48004058934146 56.49720690333107,139.54959816253404 L56.52828040441338,138.37538093612966 L56.52828040441338,123.93330608041595 L43.58100097106393,123.92531811356446 L64.81453923730639,83.98595202014735 L85,123.92531811356446 L72.06501581344523,123.92531811356446 L72.06501581344523,138.37538093612966 C72.06501581344523,161.50027382047085 59.17988327099478,180 43.58100097106393,180 z" : "M56.42140849525995,79.99999649021707 C71.62824310685437,79.99999649021707 84.25141734031217,97.44541059970688 85,119.76563135506788 L85,121.49179232145266 L85,179.89357277151947 L69.36559873594499,179.89357277151947 L69.36559873594499,121.49179232145266 C69.36559873594499,112.04585579806965 63.70122103669707,103.97445485267109 56.42140849525995,103.97445485267109 C49.44190112531376,103.97445485267109 43.95356447305237,111.38256240494398 43.5082844525597,120.31704400522699 L43.477218365814004,121.49179232145266 L43.477218365814004,135.94039922148173 L56.42140849525995,135.94839080123202 L35.19293668741817,175.90582117639931 L15,135.94839080123202 L27.944190121487598,135.94839080123202 L27.944190121487598,121.49179232145266 C27.944190121487598,98.35644021801652 40.826248188681255,79.99999649021707 56.42140849525995,79.99999649021707 z",
                            'straight-uturn' : me.reverse ? "M30.13849873273844,150.7208372690542 L38.22447367940456,150.7208372690542 L38.22447367940456,136.88825665675125 A20.538376364531963,15 0 0 0 50.05021203890378,139.70513029679927 A19.4669846840987,15.154465448973589 0 0 0 69.96192534506913,123.96840605072076 L69.96192534506913,115.83251961549817 L85.00183874586811,115.83251961549817 L65.93915280910274,86.68810631176083 L46.81582206023733,115.81678289125209 L61.87595039840297,115.81678289125209 L61.87595039840297,123.96840605072076 A11.381009737432572,8.859775750542191 0 0 1 50.05021203890378,133.4104405983679 A11.381009737432572,8.859775750542191 0 0 1 38.22447367940456,123.96840605072076 L38.22447367940456,79.99999850717745 L30.13849873273844,79.99999850717745 L30.13849873273844,123.96840605072076 L30.13849873273844,150.7208372690542 zM34.18148620607151,179.91246074552978 L53.264387080203576,150.75231071754638 L15.078370394572785,150.75231071754638 L34.18148620607151,179.91246074552978 z" : "M69.84727069602963,109.16113663862234 L61.7636640547625,109.16113663862234 L61.7636640547625,122.97927483029991 A-20.532360868818497,-15.971818433156129 0 0 0 49.94138934190932,120.16534225201735 A-19.461282988850613,-15.138642865284803 0 0 0 30.03550798778902,135.8856359854385 L30.03550798778902,144.01302784561756 L14.999999635032195,144.01302784561756 L34.05710229181941,173.1270118399143 L53.174831998416174,144.02874813935102 L38.1191146290562,144.02874813935102 L38.1191146290562,135.8856359854385 A-11.37767634758348,-8.850525371916245 0 0 1 49.94138934190932,126.45345974538577 A-11.37767634758348,-8.850525371916245 0 0 1 61.7636640547625,135.8856359854385 L61.7636640547625,179.80813667661835 L69.84727069602963,179.80813667661835 L69.84727069602963,135.8856359854385 L69.84727069602963,109.16113663862234 zM65.80546737539606,79.99999176312576 L46.728155702005644,109.12969605115552 L85,109.12969605115552 L65.80546737539606,79.99999176312576 z",
                            'left-right' : me.reverse ? "M60.521465141151324,80 L39.46993560666951,80 L39.622679854702994,133.41234993423188 L25.75711354511508,141.1220474074688 L25.75711354511508,128.19710222933043 L14.99999997695312,153.45949446177963 L25.75711354511508,179.8968822289321 L25.75711354511508,161.09696222907667 L49.96062029989623,146.22622530101 L74.16412705467737,161.09696222907667 L74.16412705467737,179.8968822289321 L84.92124132364889,153.45949446177963 L74.16412705467737,128.19710222933043 L74.16412705467737,141.1220474074688 L60.5436639849473,133.47062149956582 L60.521465141151324,80 z" : "M60.521465141151324,179.70311616568912 L39.46993560666951,179.72204175781576 L39.622679854702994,126.40317716842256 L25.75711354511508,118.70697325048923 L25.75711354511508,131.6092971178476 L14.99999997695312,106.39111926448108 L25.75711354511508,80.00000236011654 L25.75711354511508,98.7670186356551 L49.96062029989623,113.61172871742323 L74.16412705467737,98.7670186356551 L74.16412705467737,80.00000236011654 L84.92124132364889,106.39111926448108 L74.16412705467737,131.6092971178476 L74.16412705467737,118.70697325048923 L60.5436639849473,126.34500759030553 L60.521465141151324,179.70311616568912 z",
                            'left-uturn': me.reverse ? "M15.097541152027086,80.00001227220753 L38.39968040585772,80.00001227220753 L38.39968040585772,117.4743867318657 C38.39968040585772,119.18415506658778 41.342925199503036,121.54972495435356 47.22941478679361,121.54972495435356 C53.115904374084124,121.54972495435356 56.18396132367297,119.19976938927903 56.18396132367297,117.4743867318657 L56.18396132367297,102.19421054594 L44.22521521931544,102.19421054594 L61.759871825243565,80.00001227220753 L79.17842410006145,102.19421054594 L67.0977684480381,102.19421054594 L67.0977684480381,117.4743867318657 C67.0977684480381,121.54972495435356 61.70181965968841,124.83810131318876 56.059149167729444,126.41514790503265 C50.41938128404817,127.99219449687632 42.57072850099413,127.20523263322389 38.39968040585772,126.07163280581904 L38.39968040585772,136.2115739616944 L55.87628484623076,145.5801675766097 L55.87628484623076,133.08870942339013 L85.00395891351906,161.16950735182706 L55.87628484623076,179.93167749796248 L55.87628484623076,167.36527059582411 L15.318139381136529,145.5801675766097 L15.097541152027086,80.00001227220753 z" : "M84.98677630002581,179.95466540008783 L61.657851025788005,179.95466540008783 L61.657851025788005,142.47166668861865 C61.657851025788005,140.7615048724079 58.711222945559186,138.39539057874637 52.8179667851015,138.39539057874637 C46.92471062464383,138.39539057874637 43.85312691576623,140.74588695627813 43.85312691576623,142.47166668861865 L43.85312691576623,157.75535941322022 L55.82561970722856,157.75535941322022 L38.270806854504286,179.95466540008783 L20.83223179587188,157.75535941322022 L32.926774271130675,157.75535941322022 L32.926774271130675,142.47166668861865 C32.926774271130675,138.39539057874637 38.32892575155023,135.10625744181493 43.97808254441498,133.52884791270725 C49.62433339242744,131.95143838359965 57.48200827303768,132.73858135654046 61.657851025788005,133.87244206756236 L61.657851025788005,123.73016733288406 L44.16115707010966,114.35941765501676 L44.16115707010966,126.85375055883978 L15.000000477312422,98.76649019104556 L44.16115707010966,80.00000216950332 L44.16115707010966,92.56930107074935 L84.76592449125128,114.35941765501676 L84.98677630002581,179.95466540008783 z"
                        },
                        1 : {
                            left: me.reverse ? "M60,440 L75,415 60,390 60,405 50,400 50,340 35,340 35,410 60,425 60,340 z" : "M40,340 L25,365 40,390 40,375 50,380 50,440 65,440 65,370 40,355 40,340 z",
                            right: me.reverse ? "M40,440 L25,415 40,390 40,405 50,400 50,340 65,340 65,410 40,425 40,340 z" : "M60,340 L75,365 60,390 60,375 50,380 50,440 35,440 35,370 60,355 60,340 z",
                            straight: me.reverse ? "M50,440 L25,410 40,410 40,340 60,340 60,410 75,410 50,440 z" : "M50,340 L25,370 40,370 40,440 60,440 60,370 75,370 50,340 z",
                            'straight-right' : me.reverse ? "M52.19088075610587,349.52520929347077 L52.19088075610587,340 L70.9453365753878,340 L70.9453365753878,358.75039094069973 L70.89856735888085,358.78164155603577 L70.89856735888085,396.2636295902014 L85,396.2636295902014 L61.5213394492399,440 L38.20688502053156,396.2636295902014 L52.19088075610587,396.2636295902014 L52.19088075610587,371.30688818275974 L38.38460804325791,380.55082019919064 L38.38460804325791,393.12606781045326 L15,374.35069811650044 L38.38460804325791,346.25014480624316 L38.38460804325791,358.75039094069973 L52.19088075610587,349.52520929347077 z" : "M47.70976149823279,430.43375265472486 L47.70976149823279,440 L28.99847138199751,440 L28.99847138199751,421.2129585885323 L29.04513295335969,421.1817228362755 L29.04513295335969,383.7175615795297 L15,383.7175615795297 L38.40077801147733,340 L61.66157133552543,383.7175615795297 L47.70976149823279,383.7175615795297 L47.70976149823279,408.6624333317702 L61.48425736434913,399.4228978142236 L61.48425736434913,386.8536311061074 L85,405.6200710619627 L61.48425736434913,433.7072594912323 L61.48425736434913,421.2129585885323 L47.70976149823279,430.43375265472486 z",
                            'straight-left' : me.reverse ? "M47.69187678931948,371.1279358845869 L47.69187678931948,396.15503771607825 L61.636058321049234,396.15503771607825 L38.38798309172714,440 L15,396.15503771607825 L29.037453335500345,396.15503771607825 L29.037453335500345,340 L47.69187678931948,340 L47.69187678931948,340 L61.636058321049234,358.7141939492251 L61.636058321049234,346.23807140112365 L85,374.2843948892561 L61.636058321049234,393.0235309565054 L61.636058321049234,380.4725516731148 L47.69187678931948,371.1279358845869 z" : "M52.20867948179337,408.7738823685482 L52.20867948179337,383.71295341673175 L38.28453047650009,383.71295341673175 L61.49920699535864,340 L85,383.71295341673175 L70.83630356914226,383.71295341673175 L70.83630356914226,440 L52.20867948179337,440 L52.20867948179337,430.54290963601585 L38.28453047650009,421.20440296030154 L38.28453047650009,433.69738847965175 L15,405.6131570321527 L38.28453047650009,386.8486927820887 L38.28453047650009,399.41663621455496 L52.20867948179337,408.7738823685482 z",
                            uturn : me.reverse ? "M43.58100097106393,440 C28.37053704523235,440 15,422.4108915730634 15,400.10076152555484 L15,398.37538093612966 L15,340.00000324036546 L30.633721426448854,340.00000324036546 L30.633721426448854,398.37538093612966 C30.633721426448854,407.81704706331516 36.299451005108466,415.88479902379515 43.58100097106393,415.88479902379515 C50.562174093687325,415.88479902379515 56.05182061081273,408.48004058934146 56.49720690333107,399.54959816253404 L56.52828040441338,398.37538093612966 L56.52828040441338,383.93330608041595 L43.58100097106393,383.92531811356446 L64.81453923730639,343.98595202014735 L85,383.92531811356446 L72.06501581344523,383.92531811356446 L72.06501581344523,398.37538093612966 C72.06501581344523,421.50027382047085 59.17988327099478,440 43.58100097106393,440 z" : "M56.42140849525995,340 C71.62824310685437,340 84.25141734031217,357.44541059970686 85,379.76563135506785 L85,381.49179232145264 L85,439.8935727715195 L69.36559873594499,439.8935727715195 L69.36559873594499,381.49179232145264 C69.36559873594499,372.0458557980696 63.70122103669707,363.9744548526711 56.42140849525995,363.9744548526711 C49.44190112531376,363.9744548526711 43.95356447305237,371.382562404944 43.5082844525597,380.317044005227 L43.477218365814004,381.49179232145264 L43.477218365814004,395.9403992214817 L56.42140849525995,395.948390801232 L35.19293668741817,435.9058211763993 L15,395.948390801232 L27.944190121487598,395.948390801232 L27.944190121487598,381.49179232145264 C27.944190121487598,358.35644021801653 40.826248188681255,340 56.42140849525995,340 z",
                            'straight-uturn' : me.reverse ? "M30.13849873273844,410.7208372690542 L38.22447367940456,410.7208372690542 L38.22447367940456,396.88825665675125 A20.538376364531963,15 0 0 0 50.05021203890378,399.70513029679927 A19.4669846840987,15.154465448973589 0 0 0 69.96192534506913,383.9684060507208 L69.96192534506913,375.8325196154982 L85.00183874586811,375.8325196154982 L65.93915280910274,346.68810631176086 L46.81582206023733,375.8167828912521 L61.87595039840297,375.8167828912521 L61.87595039840297,383.9684060507208 A11.381009737432572,8.859775750542191 0 0 1 50.05021203890378,393.4104405983679 A11.381009737432572,8.859775750542191 0 0 1 38.22447367940456,383.9684060507208 L38.22447367940456,340 L30.13849873273844,340 L30.13849873273844,383.9684060507208 L30.13849873273844,410.7208372690542 zM34.18148620607151,439.91246074552976 L53.264387080203576,410.7523107175464 L15.078370394572785,410.7523107175464 L34.18148620607151,439.91246074552976 z" : "M69.84727069602963,369.16116715620046 L61.7636640547625,369.16116715620046 L61.7636640547625,382.97930534787804 A-20.532360868818497,-15.971818433156129 0 0 0 49.94138934190932,380.1653727695955 A-19.461282988850613,-15.138642865284803 0 0 0 30.03550798778902,395.88566650301664 L30.03550798778902,404.0130583631957 L14.999999635032195,404.0130583631957 L34.05710229181941,433.1270423574924 L53.174831998416174,404.02877865692915 L38.1191146290562,404.02877865692915 L38.1191146290562,395.88566650301664 A-11.37767634758348,-8.850525371916245 0 0 1 49.94138934190932,386.4534902629639 A-11.37767634758348,-8.850525371916245 0 0 1 61.7636640547625,395.88566650301664 L61.7636640547625,439.80816719419647 L69.84727069602963,439.80816719419647 L69.84727069602963,395.88566650301664 L69.84727069602963,369.16116715620046 zM65.80546737539606,340.0000222807039 L46.728155702005644,369.12972656873364 L85,369.12972656873364 L65.80546737539606,340.0000222807039 z",
                            'left-right' : me.reverse ? "M60.521465141151324,340.0189844204533 L39.46993560666951,340.000025646576 L39.622679854702994,393.4123728224155 L25.75711354511508,401.1220702956524 L25.75711354511508,388.197125117514 L14.99999997695312,413.4595173499632 L25.75711354511508,439.8969051171157 L25.75711354511508,421.09698511726026 L49.96062029989623,406.2262481891936 L74.16412705467737,421.09698511726026 L74.16412705467737,439.8969051171157 L84.92124132364889,413.4595173499632 L74.16412705467737,388.197125117514 L74.16412705467737,401.1220702956524 L60.5436639849473,393.4706443877494 L60.521465141151324,340.0189844204533 z" : "M60.521465141151324,439.70311616568915 L39.46993560666951,439.72204175781576 L39.622679854702994,386.40317716842253 L25.75711354511508,378.7069732504892 L25.75711354511508,391.60929711784763 L14.99999997695312,366.39111926448106 L25.75711354511508,340.0000023601165 L25.75711354511508,358.7670186356551 L49.96062029989623,373.61172871742326 L74.16412705467737,358.7670186356551 L74.16412705467737,340.0000023601165 L84.92124132364889,366.39111926448106 L74.16412705467737,391.60929711784763 L74.16412705467737,378.7069732504892 L60.5436639849473,386.3450075903055 L60.521465141151324,439.70311616568915 z",
                            'left-uturn': me.reverse ? "M15.097541152027086,340.0000122722075 L38.39968040585772,340.0000122722075 L38.39968040585772,377.4743867318657 C38.39968040585772,379.1841550665878 41.342925199503036,381.54972495435356 47.22941478679361,381.54972495435356 C53.115904374084124,381.54972495435356 56.18396132367297,379.199769389279 56.18396132367297,377.4743867318657 L56.18396132367297,362.19421054594 L44.22521521931544,362.19421054594 L61.759871825243565,340.0000122722075 L79.17842410006145,362.19421054594 L67.0977684480381,362.19421054594 L67.0977684480381,377.4743867318657 C67.0977684480381,381.54972495435356 61.70181965968841,384.83810131318876 56.059149167729444,386.41514790503265 C50.41938128404817,387.9921944968763 42.57072850099413,387.2052326332239 38.39968040585772,386.07163280581904 L38.39968040585772,396.2115739616944 L55.87628484623076,405.5801675766097 L55.87628484623076,393.0887094233901 L85.00395891351906,421.16950735182706 L55.87628484623076,439.9316774979625 L55.87628484623076,427.3652705958241 L15.318139381136529,405.5801675766097 L15.097541152027086,340.0000122722075 z" : "M84.98677630002581,439.95466540008783 L61.657851025788005,439.95466540008783 L61.657851025788005,402.47166668861865 C61.657851025788005,400.7615048724079 58.711222945559186,398.3953905787464 52.8179667851015,398.3953905787464 C46.92471062464383,398.3953905787464 43.85312691576623,400.7458869562781 43.85312691576623,402.47166668861865 L43.85312691576623,417.7553594132202 L55.82561970722856,417.7553594132202 L38.270806854504286,439.95466540008783 L20.83223179587188,417.7553594132202 L32.926774271130675,417.7553594132202 L32.926774271130675,402.47166668861865 C32.926774271130675,398.3953905787464 38.32892575155023,395.10625744181493 43.97808254441498,393.52884791270725 C49.62433339242744,391.9514383835997 57.48200827303768,392.73858135654046 61.657851025788005,393.87244206756236 L61.657851025788005,383.7301673328841 L44.16115707010966,374.3594176550167 L44.16115707010966,386.8537505588398 L15.000000477312422,358.7664901910456 L44.16115707010966,340.0000021695033 L44.16115707010966,352.56930107074936 L84.76592449125128,374.3594176550167 L84.98677630002581,439.95466540008783 z"
                        },
                        2 : {
                            left: me.reverse ? "M60,700 L75,675 60,650 60,665 50,660 50,600 35,600 35,670 60,685 60,700 z" : "M40,600 L25,625 40,650 40,635 50,640 50,700 65,700 65,630 40,615 40,600 z",
                            right: me.reverse ? "M40,700 L25,675 40,650 40,665 50,660 50,600 65,600 65,670 40,685 40,700 z" : "M60,600 L75,625 60,650 60,635 50,640 50,700 35,700 35,630 60,615 60,600 z",
                            straight:  me.reverse ? "M50,700 L25,670 40,670 40,600 60,600 60,670 75,670 50,700 z" : "M50,600 L25,630 40,630 40,700 60,700 60,630 75,630 50,600 z",
                            'straight-right' : me.reverse ? "M52.19088075610587,609.5252092934708 L52.19088075610587,600 L70.9453365753878,600 L70.9453365753878,618.7503909406997 L70.89856735888085,618.7816415560358 L70.89856735888085,656.2636295902014 L85,656.2636295902014 L61.5213394492399,700 L38.20688502053156,656.2636295902014 L52.19088075610587,656.2636295902014 L52.19088075610587,631.3068881827597 L38.38460804325791,640.5508201991906 L38.38460804325791,653.1260678104533 L15,634.3506981165004 L38.38460804325791,606.2501448062432 L38.38460804325791,618.7503909406997 L52.19088075610587,609.5252092934708 z" : "M47.70976149823279,690.4337526547249 L47.70976149823279,700 L28.99847138199751,700 L28.99847138199751,681.2129585885323 L29.04513295335969,681.1817228362755 L29.04513295335969,643.7175615795297 L15,643.7175615795297 L38.40077801147733,600.0000027209824 L61.66157133552543,643.7175615795297 L47.70976149823279,643.7175615795297 L47.70976149823279,668.6624333317702 L61.48425736434913,659.4228978142236 L61.48425736434913,646.8536311061074 L85,665.6200710619627 L61.48425736434913,693.7072594912323 L61.48425736434913,681.2129585885323 L47.70976149823279,690.4337526547249 z",
                            'straight-left' : me.reverse ? "M47.69187678931948,631.1279358845869 L47.69187678931948,656.1550377160783 L61.636058321049234,656.1550377160783 L38.38798309172714,700 L15,656.1550377160783 L29.037453335500345,656.1550377160783 L29.037453335500345,600 L47.69187678931948,600 L47.69187678931948,609.3882923445195 L61.636058321049234,618.7141939492251 L61.636058321049234,606.2380714011236 L85,634.2843948892561 L61.636058321049234,653.0235309565054 L61.636058321049234,640.4725516731148 L47.69187678931948,631.1279358845869 z" : "M52.20867948179337,668.7738823685481 L52.20867948179337,643.7129534167318 L38.28453047650009,643.7129534167318 L61.49920699535864,600 L85,643.7129534167318 L70.83630356914226,643.7129534167318 L70.83630356914226,700 L52.20867948179337,700 L52.20867948179337,690.5429096360158 L38.28453047650009,681.2044029603015 L38.28453047650009,693.6973884796517 L15,665.6131570321527 L38.28453047650009,646.8486927820886 L38.28453047650009,659.416636214555 L52.20867948179337,668.7738823685481 z",
                            uturn : me.reverse ? "M43.58100097106393,700 C28.37053704523235,700 15,682.5356474324384 15,660.2255173849298 L15,658.5001367955047 L15,600.1247590997405 L30.633721426448854,600.1247590997405 L30.633721426448854,658.5001367955047 C30.633721426448854,667.9418029226902 36.299451005108466,676.0095548831702 43.58100097106393,676.0095548831702 C50.562174093687325,676.0095548831702 56.05182061081273,668.6047964487165 56.49720690333107,659.674354021909 L56.52828040441338,658.5001367955047 L56.52828040441338,644.058061939791 L43.58100097106393,644.0500739729395 L64.81453923730639,604.1107078795224 L85,644.0500739729395 L72.06501581344523,644.0500739729395 L72.06501581344523,658.5001367955047 C72.06501581344523,681.6250296798459 59.17988327099478,700 43.58100097106393,700 z" : "M56.42140849525995,600 C71.62824310685437,600 84.25141734031217,617.4454105997069 85,639.7656313550679 L85,641.4917923214526 L85,700 L69.36559873594499,700 L69.36559873594499,641.4917923214526 C69.36559873594499,632.0458557980696 63.70122103669707,623.9744548526711 56.42140849525995,623.9744548526711 C49.44190112531376,623.9744548526711 43.95356447305237,631.382562404944 43.5082844525597,640.317044005227 L43.477218365814004,641.4917923214526 L43.477218365814004,655.9403992214817 L56.42140849525995,655.948390801232 L35.19293668741817,695.9058211763993 L15,655.948390801232 L27.944190121487598,655.948390801232 L27.944190121487598,641.4917923214526 C27.944190121487598,618.3564402180166 40.826248188681255,600 56.42140849525995,600 z",
                            'straight-uturn' : me.reverse ? "M30.13849873273844,670.7208372690542 L38.22447367940456,670.7208372690542 L38.22447367940456,656.8882566567513 A20.538376364531963,15 0 0 0 50.05021203890378,659.7051302967993 A19.4669846840987,15.154465448973589 0 0 0 69.96192534506913,643.9684060507208 L69.96192534506913,635.8325196154982 L85.00183874586811,635.8325196154982 L65.93915280910274,606.6881063117609 L46.81582206023733,635.8167828912522 L61.87595039840297,635.8167828912522 L61.87595039840297,643.9684060507208 A11.381009737432572,8.859775750542191 0 0 1 50.05021203890378,653.4104405983679 A11.381009737432572,8.859775750542191 0 0 1 38.22447367940456,643.9684060507208 L38.22447367940456,600 L30.13849873273844,600 L30.13849873273844,643.9684060507208 L30.13849873273844,670.7208372690542 zM34.18148620607151,699.9124607455298 L53.264387080203576,670.7523107175464 L15.078370394572785,670.7523107175464 L34.18148620607151,699.9124607455298 z" : "M69.84727069602963,629.1611671562005 L61.7636640547625,629.1611671562005 L61.7636640547625,642.979305347878 A-20.532360868818497,-15.971818433156129 0 0 0 49.94138934190932,640.1653727695955 A-19.461282988850613,-15.138642865284803 0 0 0 30.03550798778902,655.8856665030166 L30.03550798778902,664.0130583631957 L14.999999635032195,664.0130583631957 L34.05710229181941,693.1270423574924 L53.174831998416174,664.0287786569291 L38.1191146290562,664.0287786569291 L38.1191146290562,655.8856665030166 A-11.37767634758348,-8.850525371916245 0 0 1 49.94138934190932,646.4534902629639 A-11.37767634758348,-8.850525371916245 0 0 1 61.7636640547625,655.8856665030166 L61.7636640547625,699.8081671941965 L69.84727069602963,699.8081671941965 L69.84727069602963,655.8856665030166 L69.84727069602963,629.1611671562005 zM65.80546737539606,600.0000222807039 L46.728155702005644,629.1297265687336 L85,629.1297265687336 L65.80546737539606,600.0000222807039 z",
                            'left-right' : me.reverse ? "M60.521465141151324,600 L39.46993560666951,600 L39.622679854702994,653.5095407911655 L25.75711354511508,661.2192382644024 L25.75711354511508,648.294293086264 L14.99999997695312,673.5566853187132 L25.75711354511508,699.9940730858657 L25.75711354511508,681.1941530860103 L49.96062029989623,666.3234161579436 L74.16412705467737,681.1941530860103 L74.16412705467737,699.9940730858657 L84.92124132364889,673.5566853187132 L74.16412705467737,648.294293086264 L74.16412705467737,661.2192382644024 L60.5436639849473,653.5678123564994 L60.521465141151324,600 z" : "M60.521465141151324,699.7031161656892 L39.46993560666951,699.7220417578158 L39.622679854702994,646.4031771684225 L25.75711354511508,638.7069732504892 L25.75711354511508,651.6092971178476 L14.99999997695312,626.3911192644811 L25.75711354511508,600.0000023601165 L25.75711354511508,618.7670186356552 L49.96062029989623,633.6117287174233 L74.16412705467737,618.7670186356552 L74.16412705467737,600.0000023601165 L84.92124132364889,626.3911192644811 L74.16412705467737,651.6092971178476 L74.16412705467737,638.7069732504892 L60.5436639849473,646.3450075903055 L60.521465141151324,699.7031161656892 z",
                            'left-uturn' : me.reverse ? "M15.097541152027086,600.0000122722075 L38.39968040585772,600.0000122722075 L38.39968040585772,637.4743867318657 C38.39968040585772,639.1841550665878 41.342925199503036,641.5497249543536 47.22941478679361,641.5497249543536 C53.115904374084124,641.5497249543536 56.18396132367297,639.199769389279 56.18396132367297,637.4743867318657 L56.18396132367297,622.19421054594 L44.22521521931544,622.19421054594 L61.759871825243565,600.0000122722075 L79.17842410006145,622.19421054594 L67.0977684480381,622.19421054594 L67.0977684480381,637.4743867318657 C67.0977684480381,641.5497249543536 61.70181965968841,644.8381013131888 56.059149167729444,646.4151479050327 C50.41938128404817,647.9921944968763 42.57072850099413,647.2052326332239 38.39968040585772,646.071632805819 L38.39968040585772,656.2115739616944 L55.87628484623076,665.5801675766097 L55.87628484623076,653.0887094233901 L85.00395891351906,681.1695073518271 L55.87628484623076,699.9316774979625 L55.87628484623076,687.3652705958241 L15.318139381136529,665.5801675766097 L15.097541152027086,600.0000122722075 z" : "M84.98677630002581,699.9546654000878 L61.657851025788005,699.9546654000878 L61.657851025788005,662.4716666886186 C61.657851025788005,660.7615048724078 58.711222945559186,658.3953905787464 52.8179667851015,658.3953905787464 C46.92471062464383,658.3953905787464 43.85312691576623,660.7458869562781 43.85312691576623,662.4716666886186 L43.85312691576623,677.7553594132203 L55.82561970722856,677.7553594132203 L38.270806854504286,699.9546654000878 L20.83223179587188,677.7553594132203 L32.926774271130675,677.7553594132203 L32.926774271130675,662.4716666886186 C32.926774271130675,658.3953905787464 38.32892575155023,655.1062574418149 43.97808254441498,653.5288479127073 C49.62433339242744,651.9514383835997 57.48200827303768,652.7385813565404 61.657851025788005,653.8724420675624 L61.657851025788005,643.7301673328841 L44.16115707010966,634.3594176550167 L44.16115707010966,646.8537505588398 L15.000000477312422,618.7664901910456 L44.16115707010966,600.0000021695033 L44.16115707010966,612.5693010707494 L84.76592449125128,634.3594176550167 L84.98677630002581,699.9546654000878 z"
                        }
                    }
                    for (var item in me.landmark) {
                        var seq = me.landmark[item].seq * 1;
                        var mark = me.landmark[item].mark;
						var highlight = me.landmark[item].highlight;
                        if (seq < 0 || seq > 2 || !mark) continue;
                        landmarks.push({ path: landpath[seq][mark], highlight: highlight })
                    }
                    return landmarks;
                }
                return [];
            }
        },
        methods: {
            onPavementClick : function(e) {
                //路面点击事件
                this.$emit('on-pavement-click', e);
            },
            onWhiteLineClick: function(e) {
                var me = this;
                if (me.type === 'solid') {
                    //白色实线点击事件
                    me.$emit('on-solid-line-click', e);
                }

                if (me.type === 'dotted') {
                    //白色虚线点击事件
                    me.$emit('on-dotted-line-click', e);
                }
            },
            onParterreBoundaryLineClick: function(e) {
                var me = this;
                if (me.type === 'solid') {
                    me.$emit('on-solid-line-click', e);
                }

                if (me.type === 'parterre' ) {
                    //花坛边线点击事件
                    me.$emit('on-parterre-boundary-line-click', e);
                }
            },
            onYellowLineClick: function(e, isSingle) {
                var me = this;
                if (me.type === 'y_dotted' && isSingle) {
                    //黄色虚线点击事件
                    me.$emit('on-y-dotted-line-click', e);
                }

                if (me.type === 'y_solid' && isSingle) {
                    //黄色实线点击事件
                    me.$emit('on-y-solid-line-click', e);
                }

                if (me.type === 'y_double_solid') {
                    //黄色实线点击事件
                    me.$emit('on-double-y-solid-click', e, isSingle ? 'left' : 'right')
                }

                if (me.type === 'y_double_dashed') {
                    //黄色虚实线点击事件
                    me.$emit('on-double-y-dashed-click', e, isSingle ? 'left' : 'right');
                }
            },
            onYellowAreaClick: function(e) {
                //黄色禁止区域点击事件
                this.$emit('on-y-solid-area-click', e);
            },
            onParterreClick: function(e) {
                //花坛绿色区域事件
                this.$emit('on-parterre-click', e);
            },
            onParterreLineClick: function(e, isLeft) {
                //花坛内部白线点击事件
                var me = this;
                me.$emit('on-parterre-line-click', e, isLeft ? 'left' : 'right');
            },
            onParterreSafeAreaClick: function(e) {
                //花坛安全岛的点击事件
                var me = this;
                me.$emit('on-parterre-safe-area-click', e);
            },
            onLaneMarkClick: function(e, i) {
                //道路路标的点击事件
                var me = this;
                me.$emit('on-lane-mark-click', e, i);
            }
        }
    })

    //行人暂留区
    function StayRenderer() {
        var template = [
            "<use x='0' y='0' :xlink:href=\"'#stayArea_' + defs\" :transform='calcTransform' style='pointer-events:visiblePainted;' @click.stop='onStayAreaClick' />"
        ];
        return template.join('');
    }

    var StayPedestrian = Vue.extend({
        template: StayRenderer.apply(this),
        props: {
            width: { default: 150, type: Number },
            height: { default: 150, type: Number },
            x : { default: 0, type: Number },
            y : { default: 0, type: Number },
            angle: { default: 0, type: Number },
            defs: { default: '', type: String }
        },
        computed: {
            calcTransform: function() {
                var me = this;
                var mx = (Math.cos(me.angle * Math.PI / 180) * me.calcTransformScale.ws).toFixed(6)
                var my = (Math.cos(me.angle * Math.PI / 180) * me.calcTransformScale.hs).toFixed(6)
                var m2 = (Math.sin(me.angle * Math.PI / 180) * me.calcTransformScale.ws).toFixed(6)
                var m3 = (-1 * (Math.sin(me.angle * Math.PI / 180) * me.calcTransformScale.hs)).toFixed(6)
                return "matrix("+ mx +","+ m2 +","+ m3 +","+ my +", "+ me.x +", "+ me.y +")";
            },
            calcTransformScale: function() {
                var me = this;
                var ws = (me.width / 200).toFixed(3) * 1;
                var hs = (me.height / 200).toFixed(3) * 1;
                return { ws: ws, hs: hs };
            }
        },
        methods: {
            onStayAreaClick: function(e) {
                this.$emit('on-stay-area-click', e);
            }
        }
    })

    //十字路口Vue对象
    function crossRender() {
        var template = [
            "<g class='cross-road' clip-path='url(#clip)'>",
                "<defs>",
                    "<g :id=\"'stayArea_' + uuid \"><path d='M200,0 V180 C200,200 200,200 180,200 L0,200 C100,200 200,100 200,0 z' fill='#0075c5' stroke='#fff' stroke-width='3' /></g>",
                "</defs>",
                "<g class='ivsom-road-shading'>",
                    "<path v-show='RoadTop.stayArea' :d='caleRoadTopLeftNotch' fill='#333' stroke-width='0' />",
                    "<path v-show='RoadRight.stayArea' :d='caleRoadTopRightNotch' fill='#333' stroke-width='0' />",
                    "<path v-show='RoadLeft.stayArea' :d='calcRoadBottomLeftNotch' fill='#333' stroke-width='0' />",
                    "<path v-show='RoadBottom.stayArea' :d='calcRoadBottomRightNotch' fill='#333' stroke-width='0' />",
                    "<rect :x='(1920 - RoadWidth) / 2' :y='(1080 - RoadWidth) / 2' :width='RoadWidth' :height='RoadWidth' fill='#333' />",
                    "<rect :x='-499999.5 + (1920 - RoadWidth) / 2' :y='(1080 - RoadWidth) / 2' :width='499999.5' :height='RoadWidth' fill='#333' />",
                    "<rect :x='1920 / 2 + RoadWidth / 2' :y='(1080 - RoadWidth) / 2' :width='499999.5' :height='RoadWidth' fill='#333' />",
                    "<rect :x='(1920 - RoadWidth) / 2' :y='(1080 - RoadWidth) / 2' :width='RoadWidth' :height='499999.5' fill='#333' />",
                    "<rect :x='(1920 - RoadWidth) / 2' :y='-499999.5 + (1080 / 2) - (RoadWidth / 2)' :width='RoadWidth' :height='499999.5' fill='#333' />",
                    "<circle :cx='1920 / 2' :cy='1080 / 2' r='15' fill='#fff'>",
                "</g>",
                "<g>",
                    "<path :d='calcRoadTopLeftBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadTopRightBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadRightTopBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadRightBottomBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadBottomRightBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadBottomLeftBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadLeftTopBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadLeftBottomBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                "</g>",
                "<g>",
                    //行人斑马线
                    "<line v-show='RoadTop.pedestrian' :x1='calcPedestrianLength.top.x1' :x2='calcPedestrianLength.top.x2' :y1='(1080 - RoadWidth) / 2 - 20' :y2='(1080 - RoadWidth) / 2 - 20' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, false)' />",
                    "<line v-show='RoadRight.pedestrian' :x1='1920 / 2 + RoadWidth / 2 + 20' :x2='1920 / 2 + RoadWidth / 2 + 20' :y1='calcPedestrianLength.right.y1' :y2='calcPedestrianLength.right.y2' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, false)' />",
                    "<line v-show='RoadBottom.pedestrian' :x1='calcPedestrianLength.bottom.x1' :x2='calcPedestrianLength.bottom.x2' :y1='1080 / 2 + RoadWidth / 2 + 20' :y2='1080 / 2 + RoadWidth / 2 + 20 ' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, false)' />",
                    "<line v-show='RoadLeft.pedestrian' :x1='(1920 - RoadWidth) / 2 - 20' :x2='(1920 - RoadWidth) / 2 - 20' :y1='calcPedestrianLength.left.y1' :y2='calcPedestrianLength.left.y2' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 3, false)' />",
                "</g>",
                "<g>",
                    //机动车停止线
                    "<line v-if='RoadTop.stopLine' :x1='calcRoadTopStopLine.p1.x' :x2='calcRoadTopStopLine.p2.x' :y1='calcRoadTopStopLine.p1.y' :y2='calcRoadTopStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 0)'/>",
                    "<line v-if='RoadRight.stopLine' :x1='calcRoadRightStopLine.p1.x' :x2='calcRoadRightStopLine.p2.x' :y1='calcRoadRightStopLine.p1.y' :y2='calcRoadRightStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 1)'/>",
                    "<line v-if='RoadBottom.stopLine' :x1='calcRoadBottomStopLine.p1.x' :x2='calcRoadBottomStopLine.p2.x' :y1='calcRoadBottomStopLine.p1.y' :y2='calcRoadBottomStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 2)' />",
                    "<line v-if='RoadLeft.stopLine' :x1='calcRoadLeftStopLine.p1.x' :x2='calcRoadLeftStopLine.p2.x' :y1='calcRoadLeftStopLine.p1.y' :y2='calcRoadLeftStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 3)' />",
                "</g>",
                "<lane ",
                    "v-for='(item, n) in RoadTop.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='180' ",
                    ":width='calcRoadTopLaneWidth' ",
                    ":x='crossTopMoveTo(n).x' ",
                    ":y='crossTopMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 0, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 0, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 0, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 0, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 0, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 0, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 0, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 0, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 0, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 0, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 0, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 0, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 0, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadRight.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-90' ",
                    ":width='calcRoadRightWidth' ",
                    ":x='crossRightMoveTo(n).x' ",
                    ":y='crossRightMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 1, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 1, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 1, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 1, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 1, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 1, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 1, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 1, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 1, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 1, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 1, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 1, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 1, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadBottom.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='0' ",
                    ":width='calcRoadBottomLaneWidth' ",
                    ":x='crossBottomMoveTo(n).x' ",
                    ":y='crossBottomMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 2, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 2, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 2, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 2, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 2, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 2, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 2, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 2, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 2, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 2, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 2, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 2, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 2, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadLeft.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='90' ",
                    ":width='calcRoadLeftLaneWidth' ",
                    ":x='crossLeftMoveTo(n).x' ",
                    ":y='crossLeftMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 3, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 3, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 3, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 3, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 3, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 3, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 3, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 3, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 3, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 3, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 3, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 3, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 3, n, arguments[1])'",
                    "></lane>",
                "<image v-for='(flag, n) in calcRoadTopForUpwardFlag' :x='calcRoadTopFlagPosition(flag, n).x' :y='calcRoadTopFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(-90, '+ calcRoadTopFlagPosition(flag, n).x +' '+ calcRoadTopFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadTopForDownFlag' :x='calcRoadTopFlagPosition(flag, n).x' :y='calcRoadTopFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon'  :transform=\"'rotate(-90, '+ calcRoadTopFlagPosition(flag, n).x +' '+ calcRoadTopFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForUpwardFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForDownFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForUpwardFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForDownFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<image v-for='(flag, n) in calcRoadLeftForUpwardFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 3, flag)' />",
                "<image v-for='(flag, n) in calcRoadLeftForDownFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 3, flag)' />",
                "<g>",
                    //公路边界线
                    "<path v-show='RoadTop.boundary.right.has' :d='calcRoadTopLeftBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(2, 2)' @click.capture.stop='onRoadBoundaryClick($event, 0, true)' />",
                    "<path v-show='RoadTop.boundary.left.has' :d='calcRoadTopRightBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(-2, 2)'  @click.capture.stop='onRoadBoundaryClick($event, 0, false)' />",
                    "<path v-show='RoadRight.boundary.right.has' :d='calcRoadRightTopBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(-2, 2)' @click.capture.stop='onRoadBoundaryClick($event, 1, true)' />",
                    "<path v-show='RoadRight.boundary.left.has' :d='calcRoadRightBottomBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(-2, -2)' @click.capture.stop='onRoadBoundaryClick($event, 1, false)'/>",
                    "<path v-show='RoadBottom.boundary.right.has' :d='calcRoadBottomRightBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(-2, -2)' @click.capture.stop='onRoadBoundaryClick($event, 2, true)'/>",
                    "<path v-show='RoadBottom.boundary.left.has' :d='calcRoadBottomLeftBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(2, -2)' @click.capture.stop='onRoadBoundaryClick($event, 2, false)'/>",
                    "<path v-show='RoadLeft.boundary.left.has' :d='calcRoadLeftTopBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(2, 2)' @click.capture.stop='onRoadBoundaryClick($event, 3, false)'/>",
                    "<path v-show='RoadLeft.boundary.right.has' :d='calcRoadLeftBottomBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(2, -2)' @click.capture.stop='onRoadBoundaryClick($event, 3, true)'/>",
                "</g>",
                "<g>",
                    //行人安全暂留区斑马线
                    "<line v-show='RoadTop.pedestrian && RoadTop.stayArea && RoadTop.stayPedestrian' :x1='calcPedestrianRoadTop.p1.x' :x2='calcPedestrianRoadTop.p2.x' :y1='calcPedestrianRoadTop.p1.y' :y2='calcPedestrianRoadTop.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, true)'/>",
                    "<line v-show='RoadRight.pedestrian && RoadRight.stayArea && RoadRight.stayPedestrian' :x1='calcPedestrianRoadRight.p1.x' :x2='calcPedestrianRoadRight.p2.x' :y1='calcPedestrianRoadRight.p1.y' :y2='calcPedestrianRoadRight.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, true)'/>",
                    "<line v-show='RoadBottom.pedestrian && RoadBottom.stayArea && RoadBottom.stayPedestrian' :x1='calcPedestrianRoadBottom.p1.x' :x2='calcPedestrianRoadBottom.p2.x' :y1='calcPedestrianRoadBottom.p1.y' :y2='calcPedestrianRoadBottom.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, true)'/>",
                    "<line v-show='RoadLeft.pedestrian && RoadLeft.stayArea && RoadLeft.stayPedestrian' :x1='calcPedestrianRoadLeft.p1.x' :x2='calcPedestrianRoadLeft.p2.x' :y1='calcPedestrianRoadLeft.p1.y' :y2='calcPedestrianRoadLeft.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 3, true)'/>",
                "</g>",
                "<stay-pedestrian v-show='RoadTop.stayArea && RoadTop.pedestrian' :width='calcRoadTopStay.width' :height='calcRoadTopStay.height' :angle='0' :x='calcRoadTopStay.left' :y='calcRoadTopStay.top' :defs='uuid' @on-stay-area-click='onCrossStayAreaClick($event, 0)' ></stay-pedestrian>",
                "<stay-pedestrian v-show='RoadRight.stayArea && RoadRight.pedestrian' :width='calcRoadRightStay.width' :height='calcRoadRightStay.height' :angle='90' :x='calcRoadRightStay.left' :y='calcRoadRightStay.top' :defs='uuid' @on-stay-area-click='onCrossStayAreaClick($event, 1)'></stay-pedestrian>",
                "<stay-pedestrian v-show='RoadBottom.stayArea && RoadBottom.pedestrian' :width='calcRoadBottomStay.width' :height='calcRoadBottomStay.height' :angle='180' :x='calcRoadBottomStay.left' :y='calcRoadBottomStay.top' :defs='uuid' @on-stay-area-click='onCrossStayAreaClick($event, 2)'></stay-pedestrian>",
                "<stay-pedestrian v-show='RoadLeft.stayArea && RoadLeft.pedestrian' :width='calcRoadLeftStay.width' :height='calcRoadLeftStay.height' :angle='-90' :x='calcRoadLeftStay.left' :y='calcRoadLeftStay.top' :defs='uuid'  @on-stay-area-click='onCrossStayAreaClick($event, 3)'></stay-pedestrian>",
                "<text :x='(1920 - RoadWidth) / 2 - 30' :y='(1080 - RoadWidth) / 2 - 200' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(-90 ' + ((1920 - RoadWidth) / 2 - 30) + ', ' + ((1080 - RoadWidth) / 2 - 200) + ')'\"> {{ RoadTop.name }} </text>",
                "<text :x='(1920 / 2) + (RoadWidth / 2) + 300' :y='(1080 - RoadWidth) / 2 - 30' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start'> {{ RoadRight.name }} </text>",
                "<text :x='(1920 / 2) + (RoadWidth / 2) + 30' :y='(1080 / 2) + (RoadWidth / 2) + 200' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(90 ' + ((1920 / 2) + (RoadWidth / 2) + 30) + ', ' + ((1080 / 2) + (RoadWidth / 2) + 200) + ')'\"> {{ RoadBottom.name }} </text>",
                "<text :x='(1920 - RoadWidth) / 2 - 300' :y='(1080 / 2) + (RoadWidth / 2) + 50' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='end' style='display: block; background-color: red;'> {{ RoadLeft.name }} </text>",
                "<rect v-show='Active == 0' :x='(1920 - RoadWidth) / 2 - 10' :y='-1420 + (1080 - RoadWidth) / 2' :width='RoadWidth + 20' :height='1420' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 1' :x='(1920 / 2) + (RoadWidth / 2)' :y='(1080 - RoadWidth) / 2 - 10' :width='1850' :height='RoadWidth + 20' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 2' :x='(1920 - RoadWidth) / 2 - 10' :y='(1080 / 2) + (RoadWidth / 2)' :width='RoadWidth + 20' :height='1420' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 3' :x='-1850 + (1920- RoadWidth) / 2' :y='(1080 - RoadWidth) / 2 - 10' :width='1850' :height='RoadWidth + 20' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
            "</g>"
        ];
        return template.join('');
    }

    var crossRoads = Vue.extend({
        template: crossRender.apply(this),
        props : {
            RoadTop : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane: { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadRight : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadBottom : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadLeft : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadWidth : {
                default: 500,
                type: Number
            },
            Active : {
                default: 0,
                type: Number
            }
        },
        data : function() {
            return {
                uuid : utils.uuid()
            }
        },
        components: {
            "StayPedestrian": StayPedestrian,
            "Lane" : Lane
        },
        computed: {
            caleRoadTopLeftNotch: function() {
                //计算十字路口底色缺口
                var me = this;
                var ox = (1920 - me.RoadWidth) / 2;
                var oy = (1080 - me.RoadWidth) / 2 + 1;
                var top = oy - 125;
                var left = ox - 125;
                return "M${ox},${top} V${oy} H${left} S${ox},${oy} ${ox},${top} z".replace(/(\$\{top\})/g, top).replace(/(\$\{left\})/g, left).replace(/(\$\{ox\})/g, ox).replace(/(\$\{oy\})/g, oy)
            },
            caleRoadTopRightNotch: function() {
                //计算十字路口底色缺口
                var me = this;
                var ox = (1920 / 2) + (me.RoadWidth / 2) - 1;
                var oy = (1080 - me.RoadWidth) / 2 + 1;
                var top = oy - 125;
                var right = ox + 125;
                return "M${ox},${top} V${oy} H${right} S${ox},${oy} ${ox},${top} z".replace(/(\$\{top\})/g, top).replace(/(\$\{right\})/g, right).replace(/(\$\{ox\})/g, ox).replace(/(\$\{oy\})/g, oy);
            },
            calcRoadBottomLeftNotch: function() {
                var me = this;
                var ox = (1920 - me.RoadWidth) / 2 + 1;
                var oy = (1080 / 2) + (me.RoadWidth / 2) - 1;
                var left = ox - 125;
                var bottom = oy + 125;
                return "M${left},${oy} H${ox} V${bottom} S${ox},${oy} ${left},${oy} z".replace(/(\$\{ox\})/g, ox).replace(/(\$\{oy\})/g, oy).replace(/(\$\{left\})/g, left).replace(/(\$\{bottom\})/g, bottom);
            },
            calcRoadBottomRightNotch: function() {
                var me = this;
                var ox = (1920 / 2) + (me.RoadWidth / 2) - 1;
                var oy = (1080 / 2) + (me.RoadWidth / 2) - 1;
                var right = ox + 125;
                var bottom = oy + 125;
                return "M${right},${oy} L${ox},${oy} V${bottom} S${ox},${oy} ${right},${oy} z".replace(/(\$\{ox\})/g, ox).replace(/(\$\{oy\})/g, oy).replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom);
            },
            calcRoadTopLeftBoundary : function() {
                //计算十字路口上方左侧边界线。
                var me = this;
                var left = (1920 - me.RoadWidth) / 2;
                var rx = left - 125;
                var ry = 1080 / 2 - me.RoadWidth / 2 - 125;
                var oy = 1080 / 2 - me.RoadWidth / 2;
                var out = 'M${left},-499999.5 V${ry} S${left},${oy} ${rx},${oy}'.replace(/(\$\{left\})/g, left).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry).replace(/(\$\{oy\})/g, oy);
                var inner = 'M${left},-499999.5 V${ry} S${left},${oy} ${rx},${oy}'.replace(/(\$\{left\})/g, left).replace(/(\$\{rx\})/g, rx - 2).replace(/(\$\{ry\})/g, ry).replace(/(\$\{oy\})/g, oy);
                if(!me.RoadTop.stayArea) {
                    out = 'M${left},-499999.5 V${oy}'.replace(/(\$\{left\})/g, left).replace(/(\$\{oy\})/g, oy);
                    inner = 'M${left},-499999.5 V${oy}'.replace(/(\$\{left\})/g, left).replace(/(\$\{oy\})/g, oy);
                }
                return { out: out, inner : inner }
            },
            calcRoadTopRightBoundary : function() {
                //计算十字路口上方右侧边界线。
                var me = this;
                var right = (1920 / 2) + (me.RoadWidth / 2);
                var rx = right + 125;
                var ry = 1080 / 2 - me.RoadWidth / 2 - 125;
                var oy = ((1080 / 2) - me.RoadWidth * 0.5);
                var out = 'M${right},-499999.5 V${ry} S${right},${oy} ${rx},${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry).replace(/(\$\{oy\})/g, oy);
                var inner = 'M${right},-499999.5 V${ry} S${right},${oy} ${rx},${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{rx\})/g, rx - 2).replace(/(\$\{ry\})/g, ry).replace(/(\$\{oy\})/g, oy);
                if(!me.RoadRight.stayArea) {
                    out = 'M${right},-499999.5 V${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{oy\})/g, oy);
                    inner = 'M${right},-499999.5 V${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{oy\})/g, oy);
                }
                return { out: out, inner: inner };
            },
            calcRoadRightTopBoundary: function() {
                //计算十字路口右方上侧边界线。
                var me = this;
                var right = 1920 / 2 + me.RoadWidth / 2;
                var top = 1080 / 2 - me.RoadWidth / 2;
                var rx = right + 125;
                var ry = top - 125;
                var out = 'M${right},${ry} S${right},${top} ${rx},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                var inner = 'M${right},${ry} S${right},${top} ${rx},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry - 3);
                if (!me.RoadRight.stayArea) {
                    out = 'M${right},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top);
                    inner = 'M${right},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top);
                }
                return { out: out, inner: inner };
            },
            calcRoadRightBottomBoundary: function() {
                //计算十字路口右方下侧边界线。
                var me = this;
                var right = 1920 / 2 + me.RoadWidth / 2;
                var bottom = 1080 / 2 + me.RoadWidth / 2;
                var rx = right + 125;
                var ry = bottom + 125;
                var out = "M${right},${ry} S${right},${bottom} ${rx},${bottom} h499999.5".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                var inner = "M${right},${ry} S${right},${bottom} ${rx},${bottom} h499999.5".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                if (!me.RoadBottom.stayArea) {
                    out = "M${right},${bottom} h499999.5".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom);
                    inner = "M${right},${bottom} h499999.5".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom);
                }
                return { out : out, inner : inner };
            },
            calcRoadBottomRightBoundary: function() {
                //计算十字路口下方右侧边界线。
                var me = this;
                var right = 1920 / 2 + me.RoadWidth / 2;
                var bottom = 1080 / 2 + me.RoadWidth / 2;
                var rx = right + 125;
                var ry = bottom + 125;
                var out = "M${right},501079.5 V${ry} S${right},${bottom} ${rx},${bottom}".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                var inner = "M${right},501079.5 V${ry} S${right},${bottom} ${rx},${bottom}".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom).replace(/(\$\{rx\})/g, rx + 3).replace(/(\$\{ry\})/g, ry);
                if (!me.RoadBottom.stayArea) {
                    out = "M${right},501079.5 V${bottom}".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom);
                    inner = "M${right},501079.5 V${bottom}".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom);
                }
                return { out : out, inner : inner}
            },
            calcRoadBottomLeftBoundary: function() {
                //计算十字路口下方左侧边界线。
                var me = this;
                var left = 1920 / 2 - me.RoadWidth / 2;
                var top = 1080 / 2 + me.RoadWidth / 2;
                var rx = left - 125;
                var ry = top + 125;
                var out = "M${left},501079.5 V${ry} S${left},${top} ${rx},${top}".replace(/(\$\{left\})/g, left).replace(/(\$\{top\})/g, top).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                var inner = "M${left},501079.5 V${ry} S${left},${top} ${rx},${top}".replace(/(\$\{left\})/g, left).replace(/(\$\{top\})/g, top).replace(/(\$\{rx\})/g, rx - 3).replace(/(\$\{ry\})/g, ry);
                if (!me.RoadLeft.stayArea) {
                    out = "M${left},501079.5 V${top}".replace(/(\$\{left\})/g, left).replace(/(\$\{top\})/g, top);
                    inner = "M${left},501079.5 V${top}".replace(/(\$\{left\})/g, left).replace(/(\$\{top\})/g, top);
                }
                return { out: out, inner: inner };
            },
            calcRoadLeftTopBoundary: function() {
                //计算十字路口左方上侧边界线。
                var me = this;
                var oy = 1080 / 2 - me.RoadWidth / 2;
                var ox = 1920 / 2 - me.RoadWidth / 2;
                var rx = ox - 125;
                var ry = oy - 125;
                var out = "M-501919.5,${oy} H${rx} S${ox},${oy} ${ox},${ry}".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                var inner = "M-501919.5,${oy} H${rx} S${ox},${oy} ${ox},${ry}".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry - 3);
                if (!me.RoadTop.stayArea) {
                    out = "M-501919.5,${oy} H${ox}".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox);
                    inner = "M-501919.5,${oy} H${ox}".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox);
                }
                return { out: out, inner: inner };
            },
            calcRoadLeftBottomBoundary: function() {
                //计算十字路口左方下侧边界线。
                var me = this;
                var oy = 1080 / 2 + me.RoadWidth / 2;
                var ox = 1920 / 2 - me.RoadWidth / 2;
                var rx = ox - 125;
                var ry = oy + 125;
                var out = "M${ox},${ry} S${ox},${oy} ${rx},${oy} h-499999.5".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                var inner = "M${ox},${ry} S${ox},${oy} ${rx},${oy} h-499999.5".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry + 3);
                if(!me.RoadLeft.stayArea) {
                    out = "M-501919.5,${oy} H${ox}".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox);
                    inner = "M-501919.5,${oy} H${ox}".replace(/(\$\{oy\})/g, oy).replace(/(\$\{ox\})/g, ox);
                }
                return { out: out, inner: inner };
            },
            calcPedestrianLength: function() {
                var me = this;
                var topLane = me.RoadTop.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var stayMap = [
                    me.RoadTop.stayArea ? (topLane - 2 <= 0 ? 50 : me.RoadWidth / topLane) : 0,
                    me.RoadRight.stayArea ? (topLane - 2 <= 0 ? 50 : me.RoadWidth / topLane) : 0,
                    me.RoadRight.stayArea ? (rightLane - 2 <= 0 ? 50 : me.RoadWidth / rightLane) : 0,
                    me.RoadBottom.stayArea ? (rightLane - 2 <= 0 ? 50 : me.RoadWidth / rightLane) : 0,
                    me.RoadLeft.stayArea ? (bottomLane - 2 <= 0 ? 50 : me.RoadWidth / bottomLane) : 0,
                    me.RoadBottom.stayArea ? (bottomLane - 2 <= 0 ? 50 : me.RoadWidth / bottomLane) : 0,
                    me.RoadTop.stayArea ? (leftLane - 2 <= 0 ? 50 : me.RoadWidth / leftLane) : 0,
                    me.RoadLeft.stayArea ? (leftLane - 2 <= 0 ? 50 : me.RoadWidth / leftLane) : 0
                ];
                return {
                    top : {
                        x1 : (1920 - me.RoadWidth) / 2 + stayMap[0],
                        x2 : 1920 / 2 + me.RoadWidth / 2 - stayMap[1]
                    },
                    right: {
                        y1 : (1080 - me.RoadWidth) / 2 + stayMap[2],
                        y2 : 1080 / 2 + me.RoadWidth / 2 - stayMap[3]
                    },
                    bottom : {
                        x1 : (1920 - me.RoadWidth) / 2 + stayMap[4],
                        x2 : 1920 / 2 + me.RoadWidth / 2 - stayMap[5]
                    },
                    left: {
                        y1 : (1080 - me.RoadWidth) / 2 + stayMap[6],
                        y2 : 1080 / 2 + me.RoadWidth / 2 - stayMap[7]
                    }
                }
            },
            calcPedestrianRoadTop: function() {
                var me = this;
                var topLane = me.RoadTop.Lane.length || 0;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var langW = topLane <= 2 ? 50 : me.RoadWidth / topLane; 
                var langH = leftLane <= 2 ? 50 : me.RoadWidth / leftLane;
                var s = Math.sqrt(langW * langW + langH * langH) / 2;
                var ox = (1920 - me.RoadWidth) / 2 - 125;
                var oy = (1080 - me.RoadWidth) / 2 - 125;
                var p = utils.calcRadiusAnyPoint(ox, oy, 130, 45);
                var p2 = utils.calcRadiusAnyPoint(ox, oy, 150 + s, 45);
                return { p1: p, p2: p2 };
            },
            calcPedestrianRoadRight: function() {
                var me = this;
                var rightLane = me.RoadRight.Lane.length || 0;
                var topLane = me.RoadTop.Lane.length || 0;
                var langW = topLane <= 2 ? 50 : me.RoadWidth / topLane; 
                var langH = rightLane <= 2 ? 50 : me.RoadWidth / rightLane;
                var s = Math.sqrt(langW * langW + langH * langH) / 2;
                var ox = (1920 / 2) + (me.RoadWidth / 2) + 125;
                var oy = (1080 / 2) - (me.RoadWidth / 2) - 125;
                var p = utils.calcRadiusAnyPoint(ox, oy, 130, 135);
                var p2 = utils.calcRadiusAnyPoint(ox, oy, 150 + s, 135);
                return { p1: p, p2: p2 };
            },
            calcPedestrianRoadBottom: function() {
                var me = this;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var langW = bottomLane <= 2 ? 50 : me.RoadWidth / bottomLane; 
                var langH = rightLane <= 2 ? 50 : me.RoadWidth / rightLane;
                var s = Math.sqrt(langW * langW + langH * langH) / 2;
                var ox = (1920 / 2) + (me.RoadWidth / 2) + 125;
                var oy = (1080 / 2) + (me.RoadWidth / 2) + 125;
                var p = utils.calcRadiusAnyPoint(ox, oy, 130, 225);
                var p2 = utils.calcRadiusAnyPoint(ox, oy, 150 + s, 225);
                return { p1: p, p2: p2 };
            },
            calcPedestrianRoadLeft: function() {
                var me = this;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var langW = bottomLane <= 2 ? 50 : me.RoadWidth / bottomLane; 
                var langH = leftLane <= 2 ? 50 : me.RoadWidth / leftLane;
                var s = Math.sqrt(langW * langW + langH * langH) / 2;
                var ox = (1920 - me.RoadWidth) / 2 - 125;
                var oy = (1080 / 2) + (me.RoadWidth / 2) + 125;
                var p = utils.calcRadiusAnyPoint(ox, oy, 130, 315);
                var p2 = utils.calcRadiusAnyPoint(ox, oy, 150 + s, 315);
                return { p1: p, p2: p2 };
            },
            calcRoadTopStopLine: function() {
                var me = this;
                var lane = me.RoadTop.Lane.length || 0;
                var before = !me.RoadTop.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var width = !lane ? me.RoadWidth - diff : ((me.RoadTop.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var x = (1920 - me.RoadWidth) / 2 + before;
                var y = 1080 / 2 - me.RoadWidth / 2;

                return { p1 : { x: x, y: y - 50 }, p2: { x: x + width, y: y - 50 }};
            },
            calcRoadRightStopLine: function() {
                var me = this;
                var lane = me.RoadRight.Lane.length || 0;
                var before = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var height = !lane ? me.RoadWidth - diff : ((me.RoadRight.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var x = 1920 / 2 + me.RoadWidth / 2 + 50;
                var y = (1080 - me.RoadWidth) / 2 + before;
                return { p1: { x : x, y : y }, p2: { x : x, y : y + height } };
            },
            calcRoadBottomStopLine: function() {
                var me = this;
                var lane = me.RoadBottom.Lane.length || 0;
                var before = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var width = !lane ? me.RoadWidth - diff : ((me.RoadBottom.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var x = 1920 / 2 + me.RoadWidth / 2 - width - before;
                var y = 1080 / 2 + me.RoadWidth / 2;
                return { p1 : { x: x, y: y + 50 }, p2: { x: x + width, y: y + 50 }};
            },
            calcRoadLeftStopLine: function() {
                var me = this;
                var lane = me.RoadLeft.Lane.length || 0;
                var before = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadTop.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var height = !lane ? me.RoadWidth - diff : ((me.RoadLeft.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var x = 1920 / 2 - me.RoadWidth / 2 - 50;
                var y = 1080 / 2 + me.RoadWidth / 2 - before;
                return { p1: { x : x, y : y - height }, p2: { x : x, y : y } };
            },
            calcRoadTopStay: function() {
                var me = this;
                var topLane = me.RoadTop.Lane.length || 0;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var layout = {};
                layout.width = topLane <= 2 ? 150 : ((me.RoadWidth / topLane) * 2);
                layout.height = leftLane <= 2 ? 150 : ((me.RoadWidth / leftLane) * 2);
                layout.left = topLane <= 2 ? ((1920 - me.RoadWidth) / 2 + 50 - layout.width) : (1920 - me.RoadWidth) / 2 + (me.RoadWidth / topLane) - layout.width - 1;
                layout.top = leftLane <= 2 ? (1080 / 2 - me.RoadWidth / 2 + 50 - layout.height) : (1080 - me.RoadWidth) / 2 + (me.RoadWidth / leftLane) - layout.height - 1;
                return layout;
            },
            calcRoadRightStay: function() {
                var me = this;
                var topLane = me.RoadTop.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var layout = {};
                layout.width = rightLane <= 2 ? 150 : ((me.RoadWidth / rightLane) * 2);
                layout.height = topLane <= 2 ? 150 : ((me.RoadWidth / topLane) * 2);

                layout.left = topLane <= 2 ? ((1920 /2 + me.RoadWidth / 2) - 50 + layout.height) : 1920 / 2 + me.RoadWidth / 2 + (me.RoadWidth / topLane) + 1;
                layout.top = rightLane <= 2 ? (1080 / 2 - me.RoadWidth / 2 + 50 - layout.width) : (1080 - me.RoadWidth) / 2 + (me.RoadWidth / rightLane) - layout.width - 1;
                return layout;
            },
            calcRoadBottomStay: function() {
                var me = this;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var layout = {};
                layout.width = bottomLane <= 2 ? 150 : ((me.RoadWidth / bottomLane) * 2);
                layout.height = rightLane <= 2 ? 150 : ((me.RoadWidth / rightLane) * 2);
                layout.left = bottomLane <= 2 ? ((1920 /2 + me.RoadWidth / 2) - 50 + layout.width) : 1920 / 2 + me.RoadWidth / 2 - (me.RoadWidth / bottomLane) + layout.width + 1;
                layout.top = rightLane <= 2 ? (1080 / 2 + me.RoadWidth / 2 - 50 + layout.height) : 1080 / 2 + me.RoadWidth / 2 - (me.RoadWidth / rightLane) + layout.height + 1;
                return layout;
            },
            calcRoadLeftStay: function() {
                var me = this;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var layout = {};
                layout.width = leftLane <= 2 ? 150 : ((me.RoadWidth / leftLane) * 2);
                layout.height = bottomLane <= 2 ? 150 : ((me.RoadWidth / bottomLane) * 2);
                layout.left = bottomLane <= 2 ? ((1920 - me.RoadWidth) / 2 + 50 - layout.height) : (1920 - me.RoadWidth) / 2 + (me.RoadWidth / bottomLane) - layout.height - 1;
                layout.top = leftLane <= 2 ? (1080 / 2 + me.RoadWidth / 2 - 50 + layout.width) : 1080 / 2 + me.RoadWidth / 2 - (me.RoadWidth / leftLane) + layout.width + 1;
                return layout;
            },
            calcRoadTopLaneWidth: function() {
                var me = this;
                if(me.RoadTop.Lane && me.RoadTop.Lane.length) {
                    return me.RoadWidth / me.RoadTop.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadRightWidth: function() {
                var me = this;
                if(me.RoadRight.Lane && me.RoadRight.Lane.length) {
                    return me.RoadWidth / me.RoadRight.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadBottomLaneWidth: function() {
                var me = this;
                if(me.RoadBottom.Lane && me.RoadBottom.Lane.length) {
                    return me.RoadWidth / me.RoadBottom.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadLeftLaneWidth: function() {
                var me = this;
                if(me.RoadLeft.Lane && me.RoadLeft.Lane.length) {
                    return me.RoadWidth / me.RoadLeft.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadTopForUpwardFlag: function () {
                var me = this;
                if (!me.RoadTop.flagList || !me.RoadTop.flagList.length) {
                    return [];
                }
                return me.RoadTop.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadTopForDownFlag: function () {
                var me = this;
                if (!me.RoadTop.flagList || !me.RoadTop.flagList.length) {
                    return [];
                }
                return me.RoadTop.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadRightForUpwardFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadRightForDownFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadBottomForUpwardFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadBottomForDownFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadLeftForUpwardFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadLeftForDownFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return !it.isUpward });
            }
        },
        methods: {
            calcRoadTopFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 - me.RoadWidth) / 2 - 200;
                    var left = (1920 - me.RoadWidth) / 2 - 150;
                    return { x: left - r * 90, y: top - i * 120 };
                }

                var top = (1080 - me.RoadWidth) / 2 - 200;
                var left = (1920 / 2) + (me.RoadWidth / 2) + 20;
                return { x: left + r * 90, y: top - i * 120 };
            },
            calcRoadRightFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 - me.RoadWidth) / 2 - 150;
                    var left = (1920 / 2) + (me.RoadWidth / 2) + 300;
                    return { x: left + i * 120, y: top - r * 90 };
                }

                var top = (1080 / 2 ) + (me.RoadWidth / 2) + 20;
                var left = (1920 / 2) + (me.RoadWidth / 2) + 300;
                return { x: left + i * 120, y: top + r * 90 };
            },
            calcRoadBottomFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 / 2 ) + (me.RoadWidth / 2) + 200;
                    var left = (1920 / 2) + (me.RoadWidth / 2) + 150;
                    return { x: left + r * 90, y : top + i * 120 }
                }

                var top = (1080 / 2 ) + (me.RoadWidth / 2) + 200;
                var left = (1920 - me.RoadWidth) / 2 - 20;
                return { x: left - r * 90, y : top + i * 120 }
            },
            calcRoadLeftFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 / 2 ) + (me.RoadWidth / 2) + 60;
                    var left = (1920 - me.RoadWidth) / 2 - 410;
                    return { x: left - i * 120, y : top + r * 90 }
                }

                var top = (1080 - me.RoadWidth) / 2 - 100;
                var left = (1920 - me.RoadWidth) / 2 - 410;
                return { x: left - i * 120, y : top - r * 90 }
            },
            crossTopMoveTo: function(n) {
                var me = this;
                var left = (1920 - me.RoadWidth) / 2;
                var top = (1080 - me.RoadWidth) / 2 - 60;
                var width = me.calcRoadTopLaneWidth;
                return { x : (n + 1) * width + left, y: top };
            },
            crossRightMoveTo: function(n) {
                var me = this;
                var top = (1080 - me.RoadWidth) / 2;
                var left = 1920 / 2 + me.RoadWidth / 2 + 60;
                var width = me.calcRoadRightWidth;
                return { x : left, y : (n + 1) * width + top };
            },
            crossBottomMoveTo: function(n) {
                var me = this;
                var top = 1080 / 2 + me.RoadWidth / 2 + 60;
                var left = 1920 / 2 + me.RoadWidth / 2;
                var width = me.calcRoadBottomLaneWidth;
                return { x : left - (n + 1) * width, y : top };
            },
            crossLeftMoveTo: function(n) {
                var me = this;
                var top = 1080 / 2 + me.RoadWidth / 2;
                var left = (1920 - me.RoadWidth) / 2 - 60;
                var width = me.calcRoadLeftLaneWidth;
                return { x: left, y: top - (n + 1) * width };
            },
            onCrossStayAreaClick: function(e, no) {
                //十字路口行人暂留区域点击事件
                this.$parent.$emit('cross-stay-click', e, no, 'right');
            },
            onRoadBoundaryClick: function(e, no, isRight) {
                //十字路口公路边界线的点击事件
                this.$parent.$emit('cross-road-boundary-click', e, no, isRight ? 'right' : 'left');
            },
            onRoadPedestrianClick: function(e, no, isStay) {
                //十字路口行人斑马线的点击事件
                this.$parent.$emit('cross-road-pedestrian-click', e, no, isStay);
            },
			onRoadFlagClick: function(e, no, flag) {
                this.$parent.$emit('cross-road-flag-click', e, no, flag);
			},
            onRoadStopLineClick: function(e, no) {
                //机动车停止线点击事件
                this.$parent.$emit("cross-road-stopline-click", e, no);
            },
            onRoadLanePavementClick: function(e, no, lane) {
                //机动车道路点击事件
                this.$parent.$emit("cross-road-pavement-click", e, no, lane);
            },
            onRoadLaneSolidLineClick: function(e, no, lane) {
                //机动车道路白色实线点击事件
                this.$parent.$emit("cross-solid-line-click", e, no, lane);
            },
            onRoadLaneDottedLineClick: function(e, no, lane) {
                //机动车道路白色虚线点击事件
                this.$parent.$emit("cross-dotted-line-click", e, no, lane);
            },
            onRoadParterreBoundaryClick: function(e, no, lane) {
                //花坛边界线点击事件
                this.$parent.$emit("cross-parterre-boundary-line-click", e, no, lane);
            },
            onRoadLaneYDottedLineClick: function() {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-dotted-line-click", e, no, lane);
            },
            onRoadLaneYSolidLineClick: function(e, no, lane) {
                //机动车黄色实线点击事件
                this.$parent.$emit("cross-y-solid-line-click", e, no, lane);
            },
            onRoadLaneYDoubleSolidLineClick: function(e, no, lane, side) {
                //机动车双黄色实线点击事件
                this.$parent.$emit("cross-y-double-solid-line-click", e, no, lane, side);
            },
            onRoadLaneYDoubleDottedLineClick: function(e, no, lane, side) {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-double-dashed-line-click", e, no, lane, side);
            },
            onRoadLaneYSolidAreaClick: function(e, no, lane) {
                //机动车黄色禁停区域点击事件
                this.$parent.$emit("cross-y-area-click", e, no, lane);
            },
            onRoadLaneParterreClick: function(e, no, lane) {
                //花坛绿色区域点击事件
                this.$parent.$emit("cross-parterre-click", e, no, lane);
            },
            onRoadLaneParterreLineClick: function(e, no, lane, side) {
                //花坛内部白线点击事件
                this.$parent.$emit("cross-parterre-line-click", e, no, lane, side);
            },
            onRoadLaneParterreSafeAreaClick: function(e, no, lane) {
                //安全岛点击事件
                this.$parent.$emit("cross-parterre-safearea-click", e, no, lane);
            },
            onRoadLaneMarkClick: function(e, no, lane, side) {
                //道路路标点击事件
                var me = this;
                var mark = {};
                if(no === 0) {
                    mark = me.RoadTop.Lane[lane].landmark
                }

                if(no === 1) {
                    mark = me.RoadRight.Lane[lane].landmark
                }

                if(no === 2) {
                    mark = me.RoadBottom.Lane[lane].landmark
                }

                if(no === 3) {
                    mark = me.RoadLeft.Lane[lane].landmark
                }

                this.$parent.$emit("cross-lane-mark-click", e, no, lane, side, mark[side].mark);
            },
			onCancelLaneMarkHighlight: function() {
				var me = this;
				me.RoadTop.Lane = me.RoadTop && me.RoadTop.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadRight.Lane = me.RoadRight && me.RoadRight.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadBottom.Lane = me.RoadBottom && me.RoadBottom.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadLeft.Lane = me.RoadLeft && me.RoadLeft.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.$emit("update:road-top", me.RoadTop);
				me.$emit("update:road-right", me.RoadRight);
				me.$emit("update:road-bottom", me.RoadBottom);
				me.$emit("update:road-left", me.RoadLeft);
			}
        }
    })

    //Y 字路口
    var YRender = function() {
        var template = [
            "<g class='y-road' clip-path='url(#clip)'>",
                "<g>",
                    "<rect :x='1920 / 2 - RoadWidth / 2' :y='1080 / 2' :width='RoadWidth' height='499999.5' fill='#333' style='transform:rotate(-120deg); transform-origin: center center;' />",
                    "<rect :x='1920 / 2 - RoadWidth / 2' :y='1080 / 2' :width='RoadWidth' height='499999.5' fill='#333' style='transform:rotate(120deg); transform-origin: center center;' />",
                    "<rect :x='1920 / 2 - RoadWidth / 2' :y='1080 / 2' :width='RoadWidth' height='499999.5' fill='#333' />",
                    "<circle :cx='1920 / 2' :cy='1080 / 2' r='15' fill='#fff' />",
                    "<path :d='caleRoadTopNotch' fill='#333' stroke='#333' stroke-width='1' />",
                    "<path :d='calcRoadLeftNotch' fill='#333' stroke='#333' stroke-width='1' />",
                    "<path :d='calcRoadRightNotch' fill='#333' stroke='#333' stroke-width='1' />",
                    "<path :d='calcTopRoadBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' transform='translate(0, -1.732050807568877)' />",
                    "<path :d='calcLeftRoadBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' transform='translate(-1.732050807568877, 1.732050807568877)' />",
                    "<path :d='calcRightRoadBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' transform='translate(1.732050807568877, 1.732050807568877)' />",
                "</g>",
                "<g>",
                    //行人斑马线
                    "<line v-show='RoadLeft.pedestrian' :x1='calcLeftPedestrian.p1.x' :x2='calcLeftPedestrian.p2.x' :y1='calcLeftPedestrian.p1.y' :y2='calcLeftPedestrian.p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, false)' />",
                    "<line v-show='RoadRight.pedestrian' :x1='calcRightPedestrian.p1.x' :x2='calcRightPedestrian.p2.x' :y1='calcRightPedestrian.p1.y' :y2='calcRightPedestrian.p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, false)' />",
                    "<line v-show='RoadBottom.pedestrian' :x1='calcBottomPedestrian.p1.x' :x2='calcBottomPedestrian.p2.x' :y1='calcBottomPedestrian.p1.y' :y2='calcBottomPedestrian.p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, false)' />",
                "</g>",
                "<g>",
                    //机动车停止线
                    "<line v-if='RoadLeft.stopLine' :x1='calcRoadLeftStopLine.p1.x' :x2='calcRoadLeftStopLine.p2.x' :y1='calcRoadLeftStopLine.p1.y' :y2='calcRoadLeftStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 0)'/>",
                    "<line v-if='RoadRight.stopLine' :x1='calcRoadRightStopLine.p1.x' :x2='calcRoadRightStopLine.p2.x' :y1='calcRoadRightStopLine.p1.y' :y2='calcRoadRightStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 1)'/>",
                    "<line v-if='RoadBottom.stopLine' :x1='calcRoadBottomStopLine.p1.x' :x2='calcRoadBottomStopLine.p2.x' :y1='calcRoadBottomStopLine.p1.y' :y2='calcRoadBottomStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 2)' />",
                "</g>",
                "<lane ",
                    "v-for='(item, n) in RoadLeft.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-240' ",
                    ":width='calcRoadLeftLaneWidth' ",
                    ":x='roadLeftMoveTo(n).x' ",
                    ":y='roadLeftMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 0, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 0, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 0, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 0, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 0, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 0, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 0, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 0, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 0, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 0, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 0, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 0, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 0, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadRight.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-120' ",
                    ":width='calcRoadRightLaneWidth' ",
                    ":x='roadRightMoveTo(n).x' ",
                    ":y='roadRightMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 1, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 1, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 1, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 1, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 1, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 1, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 1, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 1, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 1, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 1, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 1, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 1, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 1, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadBottom.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='0' ",
                    ":width='calcRoadBottomLaneWidth' ",
                    ":x='roadBottomMoveTo(n).x' ",
                    ":y='roadBottomMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 2, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 2, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 2, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 2, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 2, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 2, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 2, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 2, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 2, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 2, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 2, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 2, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 2, n, arguments[1])'",
                    "></lane>",
                "<image v-for='(flag, n) in calcRoadLeftForUpwardFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(30, '+ calcRoadLeftFlagPosition(flag, n).x +' '+ calcRoadLeftFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadLeftForDownFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon'  :transform=\"'rotate(30, '+ calcRoadLeftFlagPosition(flag, n).x +' '+ calcRoadLeftFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)'  />",
                "<image v-for='(flag, n) in calcRoadRightForUpwardFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(-30, '+ calcRoadRightFlagPosition(flag, n).x +' '+ calcRoadRightFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForDownFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(-30, '+ calcRoadRightFlagPosition(flag, n).x +' '+ calcRoadRightFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForUpwardFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForDownFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<g>",
                    //公路边界线
                    "<path v-show='RoadLeft.boundary.left.has' :d='calcTopRoadBoundary.left' fill='none' stroke='#fff' stroke-width='2' transform='translate(0,1.414213562373095)' @click.capture.stop='onRoadBoundaryClick($event, 0, false)' />",
                    "<path v-show='RoadLeft.boundary.right.has' :d='calcLeftRoadBoundary.right' fill='none' stroke='#fff' stroke-width='2' transform='translate(1.414213562373095,0)' @click.capture.stop='onRoadBoundaryClick($event, 0, true)' />",
                    "<path v-show='RoadRight.boundary.right.has' :d='calcTopRoadBoundary.right' fill='none' stroke='#fff' stroke-width='2' transform='translate(0,1.414213562373095)' @click.capture.stop='onRoadBoundaryClick($event, 1, true)' />",
                    "<path v-show='RoadRight.boundary.left.has' :d='calcRightRoadBoundary.left' fill='none' stroke='#fff' stroke-width='2' transform='translate(-1.414213562373095,0)' @click.capture.stop='onRoadBoundaryClick($event, 1, false)'/>",
                    "<path v-show='RoadBottom.boundary.left.has' :d='calcLeftRoadBoundary.left' fill='none' stroke='#fff' stroke-width='2' transform='translate(1.414213562373095,0)' @click.capture.stop='onRoadBoundaryClick($event, 2, false)'/>",
                    "<path v-show='RoadBottom.boundary.right.has' :d='calcRightRoadBoundary.right' fill='none' stroke='#fff' stroke-width='2' transform='translate(-1.414213562373095,0)' @click.capture.stop='onRoadBoundaryClick($event, 2, true)'/>",
                "</g>",
                "<g>",
                    //行人安全暂留区斑马线
                    "<line v-show='RoadLeft.pedestrian && RoadLeft.stayArea && RoadLeft.stayPedestrian' :x1='calcLeftPedestrian.p3.x' :x2='calcLeftPedestrian.p4.x' :y1='calcLeftPedestrian.p3.y' :y2='calcLeftPedestrian.p4.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, true)'/>",
                    "<line v-show='RoadRight.pedestrian && RoadRight.stayArea && RoadRight.stayPedestrian' :x1='calcRightPedestrian.p3.x' :x2='calcRightPedestrian.p4.x' :y1='calcRightPedestrian.p3.y' :y2='calcRightPedestrian.p4.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, true)'/>",
                    "<line v-show='RoadBottom.pedestrian && RoadBottom.stayArea && RoadBottom.stayPedestrian' :x1='calcBottomPedestrian.p3.x' :x2='calcBottomPedestrian.p4.x' :y1='calcBottomPedestrian.p3.y' :y2='calcBottomPedestrian.p4.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, true)'/>",
                "</g>",
                "<g>",
                    "<path v-show='RoadLeft.stayArea && RoadLeft.pedestrian' :d='calcRoadLeftStay' fill='#0075c5' stroke='#fff' stroke-width='2' style='pointer-events:visiblePainted;' @click='onCrossStayAreaClick($event, 0)' />",
                    "<path v-show='RoadRight.stayArea && RoadRight.pedestrian' :d='calcRoadRightStay' fill='#0075c5' stroke='#fff' stroke-width='2' style='pointer-events:visiblePainted;' @click='onCrossStayAreaClick($event, 1)' />",
                    "<path v-show='RoadBottom.stayArea && RoadBottom.pedestrian' :d='calcRoadBottomStay' fill='#0075c5' stroke='#fff' stroke-width='2' style='pointer-events:visiblePainted;' @click='onCrossStayAreaClick($event, 2)' />",
                "</g>",
                "<text :x='getLeftTextIntersection.x' :y='getLeftTextIntersection.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='end' :transform=\"'rotate(30 ' + getLeftTextIntersection.x + ', ' + getLeftTextIntersection.y + ')'\"> {{ RoadLeft.name }} </text>",
                "<text :x='getTopTextIntersection.x' :y='getTopTextIntersection.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(-30 ' + getTopTextIntersection.x + ', ' + getTopTextIntersection.y + ')'\"> {{ RoadRight.name }} </text>",
                "<text :x='getRightTextIntersection.x' :y='getRightTextIntersection.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(90 ' + getRightTextIntersection.x + ', ' + getRightTextIntersection.y + ')'\"> {{ RoadBottom.name }} </text>",
                "<rect v-show='Active == 0' :x='getLeftActiveRect.x' :y='getLeftActiveRect.y' :width='RoadWidth + 20' :transform=\"'rotate(-240 ' + getLeftActiveRect.x + ', ' + getLeftActiveRect.y + ')'\" :height='2180' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 1' :x='getRightActiveRect.x' :y='getRightActiveRect.y' :width='RoadWidth + 20' :transform=\"'rotate(-120 ' + getRightActiveRect.x + ', ' + getRightActiveRect.y + ')'\" :height='2180' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 2' :x='getBottomActiveRect.x' :y='getBottomActiveRect.y' :width='RoadWidth + 20' :transform=\"'rotate(0 ' + getBottomActiveRect.x + ', ' + getBottomActiveRect.y + ')'\" :height='1580' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
            "</g>"
        ];
        return template.join("");
    }

    var YRoads = Vue.extend({
        template: YRender.apply(this),
        props: {
            RoadLeft : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadRight : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadBottom : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadWidth : {
                default: 500,
                type: Number
            },
            Active : {
                default: 0,
                type: Number
            }
        },
        data: function() {
            return {
                uuid : utils.uuid()
            }
        },
        components: {
            "Lane" : Lane
        },
        computed: {
            getTopTextIntersection: function() {
                var me = this;
                var a = utils.calcRadiusAnyPoint(me.getTopIntersection.x, me.getTopIntersection.y, 20, -90);
                return utils.calcRadiusAnyPoint(a.x, a.y, 200, -30);
            },
            getLeftTextIntersection: function() {
                var me = this;
                var a = utils.calcRadiusAnyPoint(me.getLeftIntersection.x, me.getLeftIntersection.y, 50, 120);
                return utils.calcRadiusAnyPoint(a.x, a.y, 200, -150);
            },
            getRightTextIntersection: function() {
                var me = this;
                var a = utils.calcRadiusAnyPoint(me.getRightIntersection.x, me.getRightIntersection.y, 20, 0);
                return utils.calcRadiusAnyPoint(a.x, a.y, 200, 90);
            },
            getLeftActiveRect: function() {
                var me = this;
                return utils.calcRadiusAnyPoint(me.getTopIntersection.x, me.getTopIntersection.y, 10, -90);
            },
            getRightActiveRect: function() {
                var me = this;
                return utils.calcRadiusAnyPoint(me.getRightIntersection.x, me.getRightIntersection.y, 10, 60);
            },
            getBottomActiveRect: function() {
                var me = this;
                return utils.calcRadiusAnyPoint(me.getLeftIntersection.x, me.getLeftIntersection.y, 10, 180);
            },
            //Y字路口上交点
            getTopIntersection: function() {
                var me = this;
                var x = 1920 / 2;
                var y = 1080 / 2;
                var rp = utils.calcRadiusAnyPoint(x, y, me.RoadWidth / 2, -120);
                var rl = utils.calcRadiusAnyPoint(rp.x, rp.y, 499999.5, -30);
                var lp = utils.calcRadiusAnyPoint(x, y, me.RoadWidth / 2, -60);
                var ll = utils.calcRadiusAnyPoint(lp.x, lp.y, 499999.5, -150);
                var intersect = utils.calcLineIntersection(rp, rl, lp, ll);
                return intersect;
            },
            //Y字路口左交点
            getLeftIntersection: function() {
                var me = this;
                var x = 1920 / 2;
                var y = 1080 / 2;
                var lp = utils.calcRadiusAnyPoint(x, y, me.RoadWidth / 2, -240);
                var ll = utils.calcRadiusAnyPoint(lp.x, lp.y, 499999.5, -150);
                var bp = utils.calcRadiusAnyPoint(x, y, me.RoadWidth / 2, 180);
                var bl = utils.calcRadiusAnyPoint(bp.x, bp.y, 499999.5, 90);
                var intersect = utils.calcLineIntersection(lp, ll, bp, bl);
                return intersect;
            },
            //Y字路口右交点
            getRightIntersection: function() {
                var me = this;
                var x = 1920 / 2;
                var y = 1080 / 2;
                var rp = utils.calcRadiusAnyPoint(x, y, me.RoadWidth / 2, 60);
                var rl = utils.calcRadiusAnyPoint(rp.x, rp.y, 499999.5, -30);
                var bp = utils.calcRadiusAnyPoint(x, y, me.RoadWidth / 2, 0);
                var bl = utils.calcRadiusAnyPoint(bp.x, bp.y, 499999.5, 90);
                var intersect = utils.calcLineIntersection(rp, rl, bp, bl);
                return intersect;
            },
            //Y字路口 上方缺口修复
            caleRoadTopNotch: function() {
                var me = this;
                var v = me.getTopIntersection;
                var l = utils.calcRadiusAnyPoint(v.x, v.y, 200, -151);
                var r = utils.calcRadiusAnyPoint(v.x, v.y, 200, -29);
                return "M${lx},${ly} L${vx},${vy} ${rx},${ry} C${vx},${vy} ${vx},${vy} ${lx},${ly} z"
                    .replace(/(\$\{lx\})/g, l.x).replace(/(\$\{ly\})/g, l.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y)
                    .replace(/(\$\{rx\})/g, r.x).replace(/(\$\{ry\})/g, r.y);
            },
            //Y字路口 上方缺口修复
            calcRoadLeftNotch: function() {
                var me = this;
                var v = me.getLeftIntersection;
                var l = utils.calcRadiusAnyPoint(v.x, v.y, 200, 89);
                var r = utils.calcRadiusAnyPoint(v.x, v.y, 200, 211);
                return "M${lx},${ly} L${vx},${vy} ${rx},${ry} C${vx},${vy} ${vx},${vy} ${lx},${ly} z"
                    .replace(/(\$\{lx\})/g, l.x).replace(/(\$\{ly\})/g, l.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y)
                    .replace(/(\$\{rx\})/g, r.x).replace(/(\$\{ry\})/g, r.y);
            },
            calcRoadRightNotch: function() {
                var me = this;
                var v = me.getRightIntersection;
                var l = utils.calcRadiusAnyPoint(v.x, v.y, 200, -31);
                var r = utils.calcRadiusAnyPoint(v.x, v.y, 200, 91);
                return "M${lx},${ly} L${vx},${vy} ${rx},${ry} C${vx},${vy} ${vx},${vy} ${lx},${ly} z"
                    .replace(/(\$\{lx\})/g, l.x).replace(/(\$\{ly\})/g, l.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y)
                    .replace(/(\$\{rx\})/g, r.x).replace(/(\$\{ry\})/g, r.y);
            },
            //Y字路口 上侧路的边界线
            calcTopRoadBoundary: function() {
                var me = this;
                var v = me.getTopIntersection;
                var p1 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, -150);
                var p2 = utils.calcRadiusAnyPoint(v.x, v.y, 200, -150);
                var p3 = utils.calcRadiusAnyPoint(v.x, v.y, 200, -30);
                var p4 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, -30);
                var out = "M${p1x},${p1y} L${p2x},${p2y} C${vx},${vy} ${vx},${vy} ${p3x},${p3y} L${p4x},${p4y}"
                    .replace(/(\$\{p1x\})/g, p1.x).replace(/(\$\{p1y\})/g, p1.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y)
                    .replace(/(\$\{p4x\})/g, p4.x).replace(/(\$\{p4y\})/g, p4.y);
                var left = "M${p1x},${p1y} L${p2x},${p2y} C${vx},${vy} ${vx},${vy} ${p3x},${p3y}"
                    .replace(/(\$\{p1x\})/g, p1.x).replace(/(\$\{p1y\})/g, p1.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y);
                var right = "M${p4x},${p4y} L${p3x},${p3y} C${vx},${vy} ${vx},${vy} ${p2x},${p2y}"
                    .replace(/(\$\{p4x\})/g, p4.x).replace(/(\$\{p4y\})/g, p4.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y);
                return { out: out, left: left, right: right };
            },
            //Y字路口 左侧路的边界线
            calcLeftRoadBoundary: function() {
                var me = this;
                var v = me.getLeftIntersection;
                var p1 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, -150);
                var p2 = utils.calcRadiusAnyPoint(v.x, v.y, 200, -150);
                var p3 = utils.calcRadiusAnyPoint(v.x, v.y, 200, 90);
                var p4 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, 90);
                var out = "M${p1x},${p1y} L${p2x},${p2y} C${vx},${vy} ${vx},${vy} ${p3x},${p3y} L${p4x},${p4y}"
                    .replace(/(\$\{p1x\})/g, p1.x).replace(/(\$\{p1y\})/g, p1.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y)
                    .replace(/(\$\{p4x\})/g, p4.x).replace(/(\$\{p4y\})/g, p4.y);
                var left = "M${p4x},${p4y} L${p3x},${p3y} C${vx},${vy} ${vx},${vy} ${p2x},${p2y}"
                    .replace(/(\$\{p4x\})/g, p4.x).replace(/(\$\{p4y\})/g, p4.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y);
                var right = "M${p1x},${p1y} L${p2x},${p2y} C${vx},${vy} ${vx},${vy} ${p3x},${p3y}"
                    .replace(/(\$\{p1x\})/g, p1.x).replace(/(\$\{p1y\})/g, p1.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y);
                return { out: out, left: left, right: right };
            },
            //Y字路口 右侧路的边界线
            calcRightRoadBoundary: function() {
                var me = this;
                var v = me.getRightIntersection;
                var p1 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, -30);
                var p2 = utils.calcRadiusAnyPoint(v.x, v.y, 200, -30);
                var p3 = utils.calcRadiusAnyPoint(v.x, v.y, 200, 90);
                var p4 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, 90);
                var out = "M${p1x},${p1y} L${p2x},${p2y} C${vx},${vy} ${vx},${vy} ${p3x},${p3y} L${p4x},${p4y}"
                    .replace(/(\$\{p1x\})/g, p1.x).replace(/(\$\{p1y\})/g, p1.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y)
                    .replace(/(\$\{p4x\})/g, p4.x).replace(/(\$\{p4y\})/g, p4.y);
                var left = "M${p1x},${p1y} L${p2x},${p2y} C${vx},${vy} ${vx},${vy} ${p3x},${p3y}"
                    .replace(/(\$\{p1x\})/g, p1.x).replace(/(\$\{p1y\})/g, p1.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y);
                var right = "M${p4x},${p4y} L${p3x},${p3y} C${vx},${vy} ${vx},${vy} ${p2x},${p2y}"
                    .replace(/(\$\{p4x\})/g, p4.x).replace(/(\$\{p4y\})/g, p4.y).replace(/(\$\{p2x\})/g, p2.x).replace(/(\$\{p2y\})/g, p2.y)
                    .replace(/(\$\{p3x\})/g, p3.x).replace(/(\$\{p3y\})/g, p3.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y);
                return { out: out, left: left, right: right };
            },
            //计算Y字路口道路宽度
            calcRoadLeftLaneWidth: function() {
                var me = this;
                if(me.RoadLeft.Lane && me.RoadLeft.Lane.length) {
                    return me.RoadWidth / me.RoadLeft.Lane.length;
                }
                return me.RoadWidth;
            },
            //计算Y字路口道路宽度
            calcRoadRightLaneWidth: function() {
                var me = this;
                if(me.RoadRight.Lane && me.RoadRight.Lane.length) {
                    return me.RoadWidth / me.RoadRight.Lane.length;
                }
                return me.RoadWidth;
            },
            //计算Y字路口道路宽度
            calcRoadBottomLaneWidth: function() {
                var me = this;
                if(me.RoadBottom.Lane && me.RoadBottom.Lane.length) {
                    return me.RoadWidth / me.RoadBottom.Lane.length;
                }
                return me.RoadWidth;
            },
            //计算Y字路口左侧机动车停止线
            calcRoadLeftStopLine: function() {
                var me = this;
                var v1 = me.getLeftIntersection;
                var lane = me.RoadLeft.Lane && me.RoadLeft.Lane.length || 0;
                var before = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var width = !lane ? me.calcRoadLeftLaneWidth - diff : ((me.RoadLeft.Lane.filter(function (it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 80, -150);
                var p1 = utils.calcRadiusAnyPoint(r1.x, r1.y, before, -60);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, width, -60);
                return { p1 : p1, p2 : p2 };
            },
            //计算Y字路口右侧机动车停止线
            calcRoadRightStopLine: function() {
                var me = this;
                var v1 = me.getTopIntersection;
                var lane = me.RoadRight.Lane && me.RoadRight.Lane.length || 0;
                var before = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var width = !lane ? me.calcRoadRightLaneWidth - diff : ((me.RoadRight.Lane.filter(function (it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 80, -30);
                var p1 = utils.calcRadiusAnyPoint(r1.x, r1.y, before, 60);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, width, 60);
                return { p1 : p1, p2 : p2 };
            },
            //计算Y字路口下侧机动车停止线
            calcRoadBottomStopLine: function() {
                var me = this;
                var v1 = me.getRightIntersection;
                var lane = me.RoadBottom.Lane && me.RoadBottom.Lane.length || 0;
                var before = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var width = !lane ? me.calcRoadBottomLaneWidth - diff : ((me.RoadBottom.Lane.filter(function (it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 80, 90);
                var p1 = utils.calcRadiusAnyPoint(r1.x, r1.y, before, 180);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, width, 180);
                return { p1 : p1, p2 : p2 };
            },
            //计算Y字路口左侧行人安全暂留区
            calcRoadLeftStay: function() {
                var me = this;
                var v = me.getLeftIntersection;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var bw = bottomLane - 2 <= 0 ? 50 : me.RoadWidth / bottomLane;
                var lw = leftLane - 2 <= 0 ? 50 : me.RoadWidth  / leftLane;
                //求交点和顶点距离
                var r = utils.calcRadiusAnyPoint(v.x, v.y, 80, 90);
                var a = utils.calcRadiusAnyPoint(r.x, r.y, bw, 0);
                var b = utils.calcRadiusAnyPoint(a.x, a.y, 999999, -90);
                r = utils.calcRadiusAnyPoint(v.x, v.y, 80, -150);
                var c = utils.calcRadiusAnyPoint(r.x, r.y, lw, -60);
                var d = utils.calcRadiusAnyPoint(c.x, c.y, 999999, 30)
                var cross = utils.calcLineIntersection(a, b, c, d);
                //求人行安全区绘制坐标
                var r1 = utils.calcRadiusAnyPoint(v.x, v.y, 80, 90);
                var r2 = utils.calcRadiusAnyPoint(v.x, v.y, 80, -150);
                var c1 = utils.calcRadiusAnyPoint(r1.x, r1.y, bw, 0);
                var c2 = utils.calcRadiusAnyPoint(r2.x, r2.y, lw, -60);
                var dist = utils.calcPointDist(c1, cross) / 2;
                var d1 = utils.calcRadiusAnyPoint(cross.x, cross.y, dist, 90);
                dist = utils.calcPointDist(c2, cross) / 2;
                var d2 = utils.calcRadiusAnyPoint(cross.x, cross.y, dist, -150);
                var s1 = utils.calcRadiusAnyPoint(cross.x, cross.y, 10, 90);
                var s2 = utils.calcRadiusAnyPoint(cross.x, cross.y, 10, -150);
                
                return "M${c1x},${c1y} L${s1x},${s1y} C${cx},${cy} ${cx},${cy} ${s2x},${s2y} L${c2x},${c2y} C${d2x},${d2y} ${d1x},${d1y} ${c1x},${c1y} z"
                    .replace(/(\$\{c1x\})/g, c1.x).replace(/(\$\{c1y\})/g, c1.y).replace(/(\$\{cx\})/g, cross.x).replace(/(\$\{cy\})/g, cross.y)
                    .replace(/(\$\{s1x\})/g, s1.x).replace(/(\$\{s1y\})/g, s1.y).replace(/(\$\{s2x\})/g, s2.x).replace(/(\$\{s2y\})/g, s2.y)
                    .replace(/(\$\{c2x\})/g, c2.x).replace(/(\$\{c2y\})/g, c2.y).replace(/(\$\{d1x\})/g, d1.x).replace(/(\$\{d1y\})/g, d1.y)
                    .replace(/(\$\{d2x\})/g, d2.x).replace(/(\$\{d2y\})/g, d2.y);
            },
            //计算Y字路口右侧行人安全暂留区
            calcRoadRightStay: function() {
                var me = this;
                var v = me.getTopIntersection;
                var rightLane = me.RoadRight.Lane.length || 0;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var bw = leftLane - 2 <= 0 ? 50 : me.RoadWidth / leftLane;
                var rw = rightLane - 2 <= 0 ? 50 : me.RoadWidth  / rightLane;
                //求交点和顶点距离
                var r = utils.calcRadiusAnyPoint(v.x, v.y, 80, -150);
                var a = utils.calcRadiusAnyPoint(r.x, r.y, bw, 120);
                var b = utils.calcRadiusAnyPoint(a.x, a.y, 999999, 30);
                r = utils.calcRadiusAnyPoint(v.x, v.y, 80, -30);
                var c = utils.calcRadiusAnyPoint(r.x, r.y, rw, 60);
                var d = utils.calcRadiusAnyPoint(c.x, c.y, 999999, 150);
                var cross = utils.calcLineIntersection(a, b, c, d);
                //求人行安全区绘制坐标
                var r1 = utils.calcRadiusAnyPoint(v.x, v.y, 80, -150);
                var r2 = utils.calcRadiusAnyPoint(v.x, v.y, 80, -30);
                var c1 = utils.calcRadiusAnyPoint(r1.x, r1.y, bw, 120);
                var c2 = utils.calcRadiusAnyPoint(r2.x, r2.y, rw, 60);
                var dist = utils.calcPointDist(c1, cross) / 2;
                var d1 = utils.calcRadiusAnyPoint(cross.x, cross.y, dist, -150);
                dist = utils.calcPointDist(c2, cross) / 2;
                var d2 = utils.calcRadiusAnyPoint(cross.x, cross.y, dist, -30);
                var s1 = utils.calcRadiusAnyPoint(cross.x, cross.y, 10, -150);
                var s2 = utils.calcRadiusAnyPoint(cross.x, cross.y, 10, -30);
                
                return "M${c1x},${c1y} L${s1x},${s1y} C${cx},${cy} ${cx},${cy} ${s2x},${s2y} L${c2x},${c2y} C${d2x},${d2y} ${d1x},${d1y} ${c1x},${c1y} z"
                    .replace(/(\$\{c1x\})/g, c1.x).replace(/(\$\{c1y\})/g, c1.y).replace(/(\$\{cx\})/g, cross.x).replace(/(\$\{cy\})/g, cross.y)
                    .replace(/(\$\{s1x\})/g, s1.x).replace(/(\$\{s1y\})/g, s1.y).replace(/(\$\{s2x\})/g, s2.x).replace(/(\$\{s2y\})/g, s2.y)
                    .replace(/(\$\{c2x\})/g, c2.x).replace(/(\$\{c2y\})/g, c2.y).replace(/(\$\{d1x\})/g, d1.x).replace(/(\$\{d1y\})/g, d1.y)
                    .replace(/(\$\{d2x\})/g, d2.x).replace(/(\$\{d2y\})/g, d2.y);
            },
            //计算Y字路口左侧行人安全暂留区
            calcRoadBottomStay: function() {
                var me = this;
                var v = me.getRightIntersection;
                var rightLane = me.RoadRight.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var bw = rightLane - 2 <= 0 ? 50 : me.RoadWidth / rightLane;
                var lw = bottomLane - 2 <= 0 ? 50 : me.RoadWidth  / bottomLane;
                //求交点和顶点距离
                var r = utils.calcRadiusAnyPoint(v.x, v.y, 80, 90);
                var a = utils.calcRadiusAnyPoint(r.x, r.y, lw, 180);
                var b = utils.calcRadiusAnyPoint(a.x, a.y, 999999, -90);
                r = utils.calcRadiusAnyPoint(v.x, v.y, 80, -30);
                var c = utils.calcRadiusAnyPoint(r.x, r.y, bw, -120);
                var d = utils.calcRadiusAnyPoint(c.x, c.y, 999999, 150);
                var cross = utils.calcLineIntersection(a, b, c, d);
                //求人行安全区绘制坐标
                var r1 = utils.calcRadiusAnyPoint(v.x, v.y, 80, -30);
                var r2 = utils.calcRadiusAnyPoint(v.x, v.y, 80, 90);
                var c1 = utils.calcRadiusAnyPoint(r1.x, r1.y, bw, -120);
                var c2 = utils.calcRadiusAnyPoint(r2.x, r2.y, lw, 180);
                var dist = utils.calcPointDist(c1, cross) / 2;
                var d1 = utils.calcRadiusAnyPoint(cross.x, cross.y, dist, -30);
                dist = utils.calcPointDist(c2, cross) / 2;
                var d2 = utils.calcRadiusAnyPoint(cross.x, cross.y, dist, 90);
                var s1 = utils.calcRadiusAnyPoint(cross.x, cross.y, 10, -30);
                var s2 = utils.calcRadiusAnyPoint(cross.x, cross.y, 10, 90);
                
                return "M${c1x},${c1y} L${s1x},${s1y} C${cx},${cy} ${cx},${cy} ${s2x},${s2y} L${c2x},${c2y} C${d2x},${d2y} ${d1x},${d1y} ${c1x},${c1y} z"
                    .replace(/(\$\{c1x\})/g, c1.x).replace(/(\$\{c1y\})/g, c1.y).replace(/(\$\{cx\})/g, cross.x).replace(/(\$\{cy\})/g, cross.y)
                    .replace(/(\$\{s1x\})/g, s1.x).replace(/(\$\{s1y\})/g, s1.y).replace(/(\$\{s2x\})/g, s2.x).replace(/(\$\{s2y\})/g, s2.y)
                    .replace(/(\$\{c2x\})/g, c2.x).replace(/(\$\{c2y\})/g, c2.y).replace(/(\$\{d1x\})/g, d1.x).replace(/(\$\{d1y\})/g, d1.y)
                    .replace(/(\$\{d2x\})/g, d2.x).replace(/(\$\{d2y\})/g, d2.y);
            },
            //计算Y字路口左侧行人斑马线长度
            calcLeftPedestrian: function() {
                var me = this;
                var v1 = me.getLeftIntersection;
                var v2 = me.getTopIntersection;
                var lw = !me.RoadLeft.stayArea ? 0 : me.RoadLeft.Lane && me.RoadLeft.Lane.length <= 2 ? 50 : me.calcRoadLeftLaneWidth;
                var rw = !me.RoadRight.stayArea ? 0 : me.RoadLeft.Lane && me.RoadLeft.Lane.length <= 2 ? 50 : me.calcRoadLeftLaneWidth;
                var bw = !me.RoadBottom.stayArea && !me.RoadLeft.stayArea ? 0 : me.RoadBottom.Lane && me.RoadBottom.Lane.length <= 2 ? 50 : me.calcRoadBottomLaneWidth;
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 40, -150);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, 40, -150);
                var p1 = utils.calcRadiusAnyPoint(r1.x, r1.y, lw, -60);
                var p2 = utils.calcRadiusAnyPoint(r2.x, r2.y, rw, 120);
                var ah = utils.calcTriangleHeight(30, 90);
                var p3 = utils.calcRadiusAnyPoint(v1.x, v1.y, ah, 135);
                var p4 = utils.calcRadiusAnyPoint(p3.x, p3.y, Math.min(lw, bw), -30);
                return { p1 : p1, p2 : p2, p3 : p3, p4 : p4 };
            },
            //计算Y字路口右侧行人斑马线长度
            calcRightPedestrian: function() {
                var me = this;
                var v1 = me.getTopIntersection;
                var v2 = me.getRightIntersection;
                var rw = !me.RoadRight.stayArea ? 0 : me.RoadRight.Lane && me.RoadRight.Lane.length <= 2 ? 50 : me.calcRoadRightLaneWidth;
                var bw = !me.RoadBottom.stayArea ? 0 : me.RoadRight.Lane && me.RoadRight.Lane.length <= 2 ? 50 : me.calcRoadRightLaneWidth;
                var lw = !me.RoadLeft.stayArea && !me.RoadRight.stayArea ? 0 : me.RoadLeft.Lane && me.RoadLeft.Lane.length <= 2 ? 50 : me.calcRoadLeftLaneWidth;
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 40, -30);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, 40, -30);
                var p1 = utils.calcRadiusAnyPoint(r1.x, r1.y, rw, 60);
                var p2 = utils.calcRadiusAnyPoint(r2.x, r2.y, bw, -120);
                var ah = utils.calcTriangleHeight(30, 90);
                var p3 = utils.calcRadiusAnyPoint(v1.x, v1.y, ah, -90);
                var p4 = utils.calcRadiusAnyPoint(p3.x, p3.y, Math.min(rw, lw), 90);
                return { p1 : p1, p2 : p2, p3 : p3, p4 : p4 };
            },
            //计算Y字路口下侧行人斑马线长度
            calcBottomPedestrian: function() {
                var me = this;
                var v1 = me.getRightIntersection;
                var v2 = me.getLeftIntersection;
                var bw = !me.RoadBottom.stayArea ? 0 : me.RoadBottom.Lane && me.RoadBottom.Lane.length <= 2 ? 50 : me.calcRoadBottomLaneWidth;
                var lw = !me.RoadLeft.stayArea ? 0 : me.RoadBottom.Lane && me.RoadBottom.Lane.length <= 2 ? 50 : me.calcRoadBottomLaneWidth;
                var rw = !me.RoadRight.stayArea && !me.RoadBottom.stayArea ? 0 : me.RoadRight.Lane &&me.RoadRight.Lane.length <= 2 ? 50 : me.calcRoadRightLaneWidth;
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 40, 90);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, 40, 90);
                var p1 = utils.calcRadiusAnyPoint(r1.x, r1.y, bw, 180);
                var p2 = utils.calcRadiusAnyPoint(r2.x, r2.y, lw, 0);
                var ah = utils.calcTriangleHeight(30, 90);
                var p3 = utils.calcRadiusAnyPoint(v1.x, v1.y, ah, 30);
                var p4 = utils.calcRadiusAnyPoint(p3.x, p3.y, Math.min(bw, rw), -150);
                return { p1 : p1, p2 : p2, p3 : p3, p4 : p4 };
            },
            calcRoadLeftForUpwardFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadLeftForDownFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadRightForUpwardFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadRightForDownFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadBottomForUpwardFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadBottomForDownFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return !it.isUpward });
            }
        },
        methods: {
            calcRoadLeftFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                var v = me.getLeftIntersection;
                if (flag.isUpward) {
                    var d = utils.calcRadiusAnyPoint(v.x, v.y, 60 + r * 90, 120);
                    return utils.calcRadiusAnyPoint(d.x, d.y, 310 + 120 * i, 210);
                }

                var d = utils.calcRadiusAnyPoint(v.x, v.y, (me.RoadWidth + 100) + r * 90, -60);
                return utils.calcRadiusAnyPoint(d.x, d.y, 310 + 120 * i, -150);
            },
            calcRoadRightFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                var v = me.getTopIntersection;
                if (flag.isUpward) {
                    var d = utils.calcRadiusAnyPoint(v.x, v.y, 130 + 90 * r, -120);
                    return utils.calcRadiusAnyPoint(d.x, d.y, 200 + 120 * i, -30);
                }

                var d = utils.calcRadiusAnyPoint(v.x, v.y, (me.RoadWidth + 20) + r * 90, 60);
                return utils.calcRadiusAnyPoint(d.x, d.y, 100 + 120 * i, -30);
            },
            calcRoadBottomFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                var v = me.getRightIntersection;
                if (flag.isUpward) {
                    var d = utils.calcRadiusAnyPoint(v.x, v.y, 140 + 90 * r, 0);
                    return utils.calcRadiusAnyPoint(d.x, d.y, 200 + 120 * i, 90);
                }

                var d = utils.calcRadiusAnyPoint(v.x, v.y, (me.RoadWidth + 20) + r * 90, 180);
                return utils.calcRadiusAnyPoint(d.x, d.y, 200 + 120 * i, 90);
            },
            roadLeftMoveTo: function(n) {
                var me = this;
                var v = me.getLeftIntersection;
                var d = utils.calcRadiusAnyPoint(v.x, v.y, 80, -150);
                var width = me.calcRoadLeftLaneWidth;
                return utils.calcRadiusAnyPoint(d.x, d.y, ((n + 1) * width), -60);
            },
            roadRightMoveTo: function(n) {
                var me = this;
                var v = me.getTopIntersection;
                var d = utils.calcRadiusAnyPoint(v.x, v.y, 80, -30);
                var width = me.calcRoadRightLaneWidth;
                return utils.calcRadiusAnyPoint(d.x, d.y, (n + 1) * width, 60);
            },
            roadBottomMoveTo: function(n) {
                var me = this;
                var v = me.getRightIntersection;
                var d = utils.calcRadiusAnyPoint(v.x, v.y, 80, 90);
                var width = me.calcRoadBottomLaneWidth;
                return utils.calcRadiusAnyPoint(d.x, d.y, (n + 1) * width, 180);
            },
            onRoadPedestrianClick: function(e, no, isStay) {
                //十字路口行人斑马线的点击事件
                this.$parent.$emit('cross-road-pedestrian-click', e, no, isStay);
            },
			onRoadFlagClick: function(e, no, flag) {
                this.$parent.$emit('cross-road-flag-click', e, no, flag);
			},
            onRoadStopLineClick: function(e, no) {
                //机动车停止线点击事件
                this.$parent.$emit("cross-road-stopline-click", e, no);
            },
            onRoadBoundaryClick: function(e, no, isRight) {
                //十字路口公路边界线的点击事件
                this.$parent.$emit('cross-road-boundary-click', e, no, isRight ? 'right' : 'left');
            },
            onRoadLanePavementClick: function(e, no, lane) {
                //机动车道路点击事件
                this.$parent.$emit("cross-road-pavement-click", e, no, lane);
            },
            onRoadLaneSolidLineClick: function(e, no, lane) {
                //机动车道路白色实线点击事件
                this.$parent.$emit("cross-solid-line-click", e, no, lane);
            },
            onRoadLaneDottedLineClick: function(e, no, lane) {
                //机动车道路白色虚线点击事件
                this.$parent.$emit("cross-dotted-line-click", e, no, lane);
            },
            onRoadParterreBoundaryClick: function(e, no, lane) {
                //花坛边界线点击事件
                this.$parent.$emit("cross-parterre-boundary-line-click", e, no, lane);
            },
            onRoadLaneYDottedLineClick: function() {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-dotted-line-click", e, no, lane);
            },
            onRoadLaneYSolidLineClick: function(e, no, lane) {
                //机动车黄色实线点击事件
                this.$parent.$emit("cross-y-solid-line-click", e, no, lane);
            },
            onRoadLaneYDoubleSolidLineClick: function(e, no, lane, side) {
                //机动车双黄色实线点击事件
                this.$parent.$emit("cross-y-double-solid-line-click", e, no, lane, side);
            },
            onRoadLaneYDoubleDottedLineClick: function(e, no, lane, side) {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-double-dashed-line-click", e, no, lane, side);
            },
            onRoadLaneYSolidAreaClick: function(e, no, lane) {
                //机动车黄色禁停区域点击事件
                this.$parent.$emit("cross-y-area-click", e, no, lane);
            },
            onRoadLaneParterreClick: function(e, no, lane) {
                //花坛绿色区域点击事件
                this.$parent.$emit("cross-parterre-click", e, no, lane);
            },
            onRoadLaneParterreLineClick: function(e, no, lane, side) {
                //花坛内部白线点击事件
                this.$parent.$emit("cross-parterre-line-click", e, no, lane, side);
            },
            onRoadLaneParterreSafeAreaClick: function(e, no, lane) {
                //安全岛点击事件
                this.$parent.$emit("cross-parterre-safearea-click", e, no, lane);
            },
            onRoadLaneMarkClick: function(e, no, lane, side) {
                //道路路标点击事件
                var me = this;
                var mark = {};
                if(no === 0) {
                    mark = me.RoadLeft.Lane[lane].landmark
                }

                if(no === 1) {
                    mark = me.RoadRight.Lane[lane].landmark
                }

                if(no === 2) {
                    mark = me.RoadBottom.Lane[lane].landmark
                }

                this.$parent.$emit("cross-lane-mark-click", e, no, lane, side, mark[side].mark);
            },
            onCrossStayAreaClick: function(e, no) {
                //十字路口行人暂留区域点击事件
                this.$parent.$emit('cross-stay-click', e, no, 'right');
            },
			onCancelLaneMarkHighlight: function() {
				var me = this;
				me.RoadRight.Lane = me.RoadRight && me.RoadRight.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadBottom.Lane = me.RoadBottom && me.RoadBottom.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadLeft.Lane = me.RoadLeft && me.RoadLeft.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.$emit("update:road-right", me.RoadRight);
				me.$emit("update:road-bottom", me.RoadBottom);
				me.$emit("update:road-left", me.RoadLeft);
			}
        }
    })

    var TRender = function() {
        var template = [
            "<g class='t-road' clip-path='url(#clip)'>",
                "<defs>",
                    "<g :id=\"'stayArea_' + uuid \"><path d='M200,0 V180 C200,200 200,200 180,200 L0,200 C100,200 200,100 200,0 z' fill='#0075c5' stroke='#fff' stroke-width='3' /></g>",
                "</defs>",
                "<g>",
                    "<rect :x='(1920 / 2) - 499999.5' :y='(1080 - RoadWidth) / 2' width='999999' :height='RoadWidth' fill='#333' />",
                    "<rect :x='(1920 - RoadWidth) / 2' :y='1080 / 2 + RoadWidth / 2 - 1' :width='RoadWidth' :height='499999.5' fill='#333' />",
                    "<line :x1='(1920 / 2) - 499999.5' :x2='(1920 / 2) + 499999.5' :y1='(1080 - RoadWidth) / 2 - 2.5' :y2='(1080 - RoadWidth) / 2 - 2.5' stroke='#8e8e8e' stroke-width='5' />",
                    "<circle :cx='1920 / 2' :cy='1080 / 2' r='10' fill='#fff' />",
                    "<path v-show='RoadLeft.stayArea' :d='caleRoadLeftNotch' fill='#333' stroke='none' />",
                    "<path v-show='RoadBottom.stayArea' :d='calcRoadRightNotch' fill='#333' stroke='none' />",
                "</g>",
                "<g>",
                    "<path :d='calcRoadLeftBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadRightBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadBottomBoundary.outLeft' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadBottomBoundary.outRight' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                "</g>",
                "<g>",
                    //行人斑马线
                    "<line v-show='RoadLeft.pedestrian' :x1='(1920 - RoadWidth) / 2 - 20' :x2='(1920 - RoadWidth) / 2 - 20' :y1='calcPedestrianLength.left.y1' :y2='calcPedestrianLength.left.y2' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, false)' />",
                    "<line v-show='RoadRight.pedestrian' :x1='1920 / 2 + RoadWidth / 2 + 20' :x2='1920 / 2 + RoadWidth / 2 + 20' :y1='calcPedestrianLength.right.y1' :y2='calcPedestrianLength.right.y2' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, false)' />",
                    "<line v-show='RoadBottom.pedestrian' :x1='calcPedestrianLength.bottom.x1' :x2='calcPedestrianLength.bottom.x2' :y1='1080 / 2 + RoadWidth / 2 + 20' :y2='1080 / 2 + RoadWidth / 2 + 20 ' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, false)' />",
                "</g>",
                "<g>",
                    //机动车停止线
                    "<line v-if='RoadLeft.stopLine' :x1='calcRoadLeftStopLine.p1.x' :x2='calcRoadLeftStopLine.p2.x' :y1='calcRoadLeftStopLine.p1.y' :y2='calcRoadLeftStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 0)' />",
                    "<line v-if='RoadRight.stopLine' :x1='calcRoadRightStopLine.p1.x' :x2='calcRoadRightStopLine.p2.x' :y1='calcRoadRightStopLine.p1.y' :y2='calcRoadRightStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 1)'/>",
                    "<line v-if='RoadBottom.stopLine' :x1='calcRoadBottomStopLine.p1.x' :x2='calcRoadBottomStopLine.p2.x' :y1='calcRoadBottomStopLine.p1.y' :y2='calcRoadBottomStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 2)' />",
                "</g>",
                "<lane ",
                    "v-for='(item, n) in RoadLeft.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='90' ",
                    ":width='calcRoadLeftLaneWidth' ",
                    ":x='roadLeftMoveTo(n).x' ",
                    ":y='roadLeftMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 0, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 0, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 0, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 0, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 0, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 0, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 0, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 0, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 0, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 0, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 0, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 0, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 0, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadRight.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-90' ",
                    ":width='calcRoadRightLaneWidth' ",
                    ":x='roadRightMoveTo(n).x' ",
                    ":y='roadRightMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 1, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 1, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 1, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 1, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 1, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 1, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 1, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 1, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 1, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 1, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 1, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 1, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 1, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadBottom.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='0' ",
                    ":width='calcRoadBottomLaneWidth' ",
                    ":x='roadBottomMoveTo(n).x' ",
                    ":y='roadBottomMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 2, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 2, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 2, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 2, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 2, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 2, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 2, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 2, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 2, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 2, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 2, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 2, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 2, n, arguments[1])'",
                    "></lane>",
                "<image v-for='(flag, n) in calcRoadLeftForUpwardFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadLeftForDownFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForUpwardFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForDownFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForUpwardFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForDownFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<g>",
                    //公路边界线
                    "<path v-show='RoadLeft.boundary.left.has' :d='calcRoadLeftBoundary.innterLeft' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 0, false)'/>",
                    "<path v-show='RoadLeft.boundary.right.has' :d='calcRoadLeftBoundary.innterRight' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 0, true)'/>",
                    "<path v-show='RoadRight.boundary.left.has' :d='calcRoadRightBoundary.innerLeft' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 1, false)'/>",
                    "<path v-show='RoadRight.boundary.right.has' :d='calcRoadRightBoundary.innerRight' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 1, true)' />",
                    "<path v-show='RoadBottom.boundary.left.has' :d='calcRoadBottomBoundary.innerLeft' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 2, false)'/>",
                    "<path v-show='RoadBottom.boundary.right.has' :d='calcRoadBottomBoundary.innerRight' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 2, true)'/>",
                "</g>",
                "<g>",
                    //行人安全暂留区斑马线
                    "<line v-show='RoadLeft.pedestrian && RoadLeft.stayArea && RoadLeft.stayPedestrian' :x1='calcPedestrianRoadLeft.p1.x' :x2='calcPedestrianRoadLeft.p2.x' :y1='calcPedestrianRoadLeft.p1.y' :y2='calcPedestrianRoadLeft.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, true)'/>",
                    "<line v-show='RoadBottom.pedestrian && RoadBottom.stayArea && RoadBottom.stayPedestrian' :x1='calcPedestrianRoadBottom.p1.x' :x2='calcPedestrianRoadBottom.p2.x' :y1='calcPedestrianRoadBottom.p1.y' :y2='calcPedestrianRoadBottom.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, true)'/>",
                "</g>",
                "<stay-pedestrian v-show='RoadLeft.stayArea && RoadLeft.pedestrian' :width='calcRoadLeftStay.width' :height='calcRoadLeftStay.height' :angle='-90' :x='calcRoadLeftStay.left' :y='calcRoadLeftStay.top' :defs='uuid'  @on-stay-area-click='onCrossStayAreaClick($event, 0)'></stay-pedestrian>",
                "<stay-pedestrian v-show='RoadBottom.stayArea && RoadBottom.pedestrian' :width='calcRoadBottomStay.width' :height='calcRoadBottomStay.height' :angle='180' :x='calcRoadBottomStay.left' :y='calcRoadBottomStay.top' :defs='uuid' @on-stay-area-click='onCrossStayAreaClick($event, 2)'></stay-pedestrian>",
                "<text :x='(1920 / 2) + (RoadWidth / 2) + 300' :y='(1080 - RoadWidth) / 2 - 30' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start'> {{ RoadRight.name }} </text>",
                "<text :x='(1920 / 2) + (RoadWidth / 2) + 30' :y='(1080 / 2) + (RoadWidth / 2) + 300' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(90 ' + ((1920 / 2) + (RoadWidth / 2) + 30) + ', ' + ((1080 / 2) + (RoadWidth / 2) + 300) + ')'\"> {{ RoadBottom.name }} </text>",
                "<text :x='(1920 - RoadWidth) / 2 - 300' :y='(1080 / 2) + (RoadWidth / 2) + 50' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='end' style='display: block; background-color: red;'> {{ RoadLeft.name }} </text>",
                "<rect v-show='Active == 0' :x='-1900 + (1920- RoadWidth) / 2' :y='(1080 - RoadWidth) / 2 - 10' :width='1900' :height='RoadWidth + 20' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 1' :x='(1920 / 2) + (RoadWidth / 2)' :y='(1080 - RoadWidth) / 2 - 10' :width='1900' :height='RoadWidth + 20' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 2' :x='(1920 - RoadWidth) / 2 - 10' :y='(1080 / 2) + (RoadWidth / 2)' :width='RoadWidth + 20' :height='1480' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
            "</g>"
        ]
        return template.join("");
    }

    var TRoads = Vue.extend({
        template: TRender.apply(this),
        props: {
            RoadLeft : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadRight : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadBottom : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadWidth : {
                default: 500,
                type: Number
            },
            Active : {
                default: 0,
                type: Number
            }
        },
        data: function() {
            return {
                uuid : utils.uuid()
            }
        },
        components: {
            "StayPedestrian": StayPedestrian,
            "Lane" : Lane
        },
        computed: {
            caleRoadLeftNotch: function() {
                var me = this;
                var v = { x : (1920 - me.RoadWidth) / 2 + 1, y : (1080 / 2) + me.RoadWidth / 2 - 1 };
                var l = { x: v.x - 200, y : v.y };
                var b = { x: v.x, y : v.y + 200 };
                return "M${lx},${ly} L${vx},${vy} ${bx},${by} C${vx},${vy} ${vx},${vy} ${lx},${ly} z"
                    .replace(/(\$\{lx\})/g, l.x).replace(/(\$\{ly\})/g, l.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y)
                    .replace(/(\$\{bx\})/g, b.x).replace(/(\$\{by\})/g, b.y);
            },
            calcRoadRightNotch: function() {
                var me = this;
                var v = { x : 1920 / 2 + me.RoadWidth / 2 - 1, y : (1080 / 2) + me.RoadWidth / 2 - 1 };
                var r =  { x: v.x + 200, y : v.y };
                var b = { x: v.x, y : v.y + 200 };
                return "M${rx},${ry} L${vx},${vy} ${bx},${by} C${vx},${vy} ${vx},${vy} ${rx},${ry} z"
                    .replace(/(\$\{rx\})/g, r.x).replace(/(\$\{ry\})/g, r.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y)
                    .replace(/(\$\{bx\})/g, b.x).replace(/(\$\{by\})/g, b.y);
            },
            calcRoadLeftBoundary: function() {
                var me = this;
                var v = { x : (1920 - me.RoadWidth) / 2, y : (1080 / 2) + me.RoadWidth / 2 };
                var t = { x : 1920 / 2, y : (1080 - me.RoadWidth) / 2 };
                var r = { x: v.x, y : v.y + 200 };
                var l = { x: v.x - 200, y: v.y };
                var len = 499999.5 - (me.RoadWidth / 2 + 200);
                var inner_left = "M${tx},${ty} H-499999.5".replace(/(\$\{tx\})/g, t.x).replace(/(\$\{ty\})/g, t.y);
                var inner_right = "M${rx},${ry} C${vx},${vy} ${vx},${vy} ${lx},${ly} H-${len}".replace(/(\$\{rx\})/g, r.x).replace(/(\$\{ry\})/g, r.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{lx\})/g, l.x).replace(/(\$\{ly\})/g, l.y).replace(/(\$\{len\})/g, len);
                var out = "M${rx},${ry} C${vx},${vy} ${vx},${vy} ${lx},${ly} H-${len}".replace(/(\$\{rx\})/g, r.x - 2.5).replace(/(\$\{ry\})/g, r.y).replace(/(\$\{vx\})/g, v.x - 2.5).replace(/(\$\{vy\})/g, v.y + 2.5).replace(/(\$\{lx\})/g, l.x).replace(/(\$\{ly\})/g, l.y + 2.5).replace(/(\$\{len\})/g, len);;
                if (!me.RoadLeft.stayArea) {
                    inner_right = "M${vx},${vy} H-${len}".replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{len\})/g, len);
                    out = "M${vx},${vy} H-${len}".replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y + 2.5).replace(/(\$\{len\})/g, len);
                }
                return { innterLeft: inner_left, innterRight: inner_right, out: out };
            },
            calcRoadRightBoundary: function() {
                var me = this;
                var v = { x : 1920 / 2 + me.RoadWidth / 2, y : (1080 / 2) + me.RoadWidth / 2 };
                var t = { x : 1920 / 2, y : (1080 - me.RoadWidth) / 2 };
                var l = { x : v.x, y : v.y + 200 };
                var len = 499999.5 - (me.RoadWidth / 2 + 200);
                var r = { x : v.x + 200, y : v.y}
                var inner_right = "M${tx},${ty} H499999.5".replace(/(\$\{tx\})/g, t.x).replace(/(\$\{ty\})/g, t.y);
                var inner_left = "M${lx},${ly} C${vx},${vy} ${vx},${vy} ${rx},${ry} H${len}".replace(/(\$\{rx\})/g, r.x).replace(/(\$\{ry\})/g, r.y).replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{lx\})/g, l.x).replace(/(\$\{ly\})/g, l.y).replace(/(\$\{len\})/g, len);
                var out = "M${lx},${ly} C${vx},${vy} ${vx},${vy} ${rx},${ry} H${len}".replace(/(\$\{rx\})/g, r.x).replace(/(\$\{ry\})/g, r.y + 2.5).replace(/(\$\{vx\})/g, v.x + 2.5).replace(/(\$\{vy\})/g, v.y + 2.5).replace(/(\$\{lx\})/g, l.x + 2.5).replace(/(\$\{ly\})/g, l.y).replace(/(\$\{len\})/g, len);
                
                if (!me.RoadBottom.stayArea) {
                    inner_left = "M${vx},${vy} H${len}".replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{len\})/g, len);
                    out = "M${vx},${vy} H${len}".replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y + 2.5).replace(/(\$\{len\})/g, len);
                }
                return { innerLeft: inner_left, innerRight: inner_right, out: out }
            },
            calcRoadBottomBoundary: function() {
                var me = this;
                var v1 = { x : (1920 - me.RoadWidth) / 2, y : (1080 / 2) + me.RoadWidth / 2 };
                var v2 = { x : 1920 / 2 + me.RoadWidth / 2, y : (1080 / 2) + me.RoadWidth / 2 };
                var v3 = { x : v1.x - 200, y : v1.y + 200 };
                var v4 = { x: v2.x + 200, y: v2.y + 200 };
                
                var l = "M${v3x},${v1y} C${v1x},${v1y} ${v1x},${v1y} ${v1x},${v3y} V499999.5".replace(/(\$\{v1x\})/g, v1.x).replace(/(\$\{v1y\})/g, v1.y).replace(/(\$\{v3x\})/g, v3.x).replace(/(\$\{v3y\})/g, v3.y);
                var lo = "M${v3x},${v1y} C${v1x},${v1y} ${v1x},${v1y} ${v1x},${v3y} V499999.5".replace(/(\$\{v1x\})/g, v1.x - 2.5).replace(/(\$\{v1y\})/g, v1.y + 2.5).replace(/(\$\{v3x\})/g, v3.x - 2.5).replace(/(\$\{v3y\})/g, v3.y + 2.5);
                var r = "M${v4x},${v2y} C${v2x},${v2y} ${v2x},${v2y} ${v2x},${v4y} V499999.5".replace(/(\$\{v2x\})/g, v2.x).replace(/(\$\{v2y\})/g, v2.y).replace(/(\$\{v4x\})/g, v4.x).replace(/(\$\{v4y\})/g, v4.y);
                var ro = "M${v4x},${v2y} C${v2x},${v2y} ${v2x},${v2y} ${v2x},${v4y} V499999.5".replace(/(\$\{v2x\})/g, v2.x + 2.5).replace(/(\$\{v2y\})/g, v2.y + 2.5).replace(/(\$\{v4x\})/g, v4.x + 2.5).replace(/(\$\{v4y\})/g, v4.y + 2.5);
                if (!me.RoadBottom.stayArea) {
                    r = "M${v2x},${v2y} V499999.5".replace(/(\$\{v2x\})/g, v2.x).replace(/(\$\{v2y\})/g, v2.y);
                    ro = "M${v2x},${v2y} V499999.5".replace(/(\$\{v2x\})/g, v2.x + 2.5).replace(/(\$\{v2y\})/g, v2.y);
                }

                if (!me.RoadLeft.stayArea) {
                    l = "M${v1x},${v1y} V499999.5".replace(/(\$\{v1x\})/g, v1.x).replace(/(\$\{v1y\})/g, v1.y);
                    lo = "M${v1x},${v1y} V499999.5".replace(/(\$\{v1x\})/g, v1.x - 2.5).replace(/(\$\{v1y\})/g, v1.y);
                }
                return { innerLeft: l, innerRight: r, outLeft: lo, outRight: ro }
            },
            //计算T字路口道路宽度
            calcRoadLeftLaneWidth: function() {
                var me = this;
                if(me.RoadLeft.Lane && me.RoadLeft.Lane.length) {
                    return me.RoadWidth / me.RoadLeft.Lane.length;
                }
                return me.RoadWidth;
            },
            //计算T字路口道路宽度
            calcRoadRightLaneWidth: function() {
                var me = this;
                if(me.RoadRight.Lane && me.RoadRight.Lane.length) {
                    return me.RoadWidth / me.RoadRight.Lane.length;
                }
                return me.RoadWidth;
            },
            //计算T字路口道路宽度
            calcRoadBottomLaneWidth: function() {
                var me = this;
                if(me.RoadBottom.Lane && me.RoadBottom.Lane.length) {
                    return me.RoadWidth / me.RoadBottom.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadLeftStopLine: function() {
                var me = this;
                var lane = me.RoadLeft.Lane.length || 0;
                var diff = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var height = !lane ? me.RoadWidth - diff : ((me.RoadLeft.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - diff;
                var x = 1920 / 2 - me.RoadWidth / 2 - 50;
                var y = 1080 / 2 + me.RoadWidth / 2 - diff;
                return { p1: { x : x, y : y - height }, p2: { x : x, y : y } };
            },
            calcRoadRightStopLine: function() {
                var me = this;
                var lane = me.RoadRight.Lane.length || 0;
                var diff = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var height = !lane ? me.RoadWidth - diff : ((me.RoadRight.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane));
                var x = 1920 / 2 + me.RoadWidth / 2 + 50;
                var y = (1080 - me.RoadWidth) / 2;
                return { p1: { x : x, y : y }, p2: { x : x, y : y + height } };
            },
            calcRoadBottomStopLine: function() {
                var me = this;
                var lane = me.RoadBottom.Lane.length || 0;
                var before = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var after = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var width = !lane ? me.RoadWidth - diff : ((me.RoadBottom.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var x = 1920 / 2 + me.RoadWidth / 2 - before;
                var y = 1080 / 2 + me.RoadWidth / 2;
                return { p1 : { x: x, y: y + 50 }, p2: { x: x - width, y: y + 50 }};
            },
            calcPedestrianLength: function() {
                var me = this;
                var rightLane = me.RoadRight.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var stayMap = [
                    0,
                    me.RoadBottom.stayArea ? (rightLane - 2 <= 0 ? 50 : me.RoadWidth / rightLane) : 0,
                    me.RoadLeft.stayArea ? (bottomLane - 2 <= 0 ? 50 : me.RoadWidth / bottomLane) : 0,
                    me.RoadBottom.stayArea ? (bottomLane - 2 <= 0 ? 50 : me.RoadWidth / bottomLane) : 0,
                    0,
                    me.RoadLeft.stayArea ? (leftLane - 2 <= 0 ? 50 : me.RoadWidth / leftLane) : 0
                ];
                return {
                    right: {
                        y1 : (1080 - me.RoadWidth) / 2 + stayMap[0],
                        y2 : 1080 / 2 + me.RoadWidth / 2 - stayMap[1]
                    },
                    bottom : {
                        x1 : (1920 - me.RoadWidth) / 2 + stayMap[2],
                        x2 : 1920 / 2 + me.RoadWidth / 2 - stayMap[3]
                    },
                    left: {
                        y1 : (1080 - me.RoadWidth) / 2 + stayMap[4],
                        y2 : 1080 / 2 + me.RoadWidth / 2 - stayMap[5]
                    }
                }
            },
            calcRoadLeftStay: function() {
                var me = this;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var layout = {};
                layout.width = leftLane <= 2 ? 150 : ((me.RoadWidth / leftLane) * 2);
                layout.height = bottomLane <= 2 ? 150 : ((me.RoadWidth / bottomLane) * 2);
                layout.left = bottomLane <= 2 ? ((1920 - me.RoadWidth) / 2 + 50 - layout.height) : (1920 - me.RoadWidth) / 2 + (me.RoadWidth / bottomLane) - layout.height - 1;
                layout.top = leftLane <= 2 ? (1080 / 2 + me.RoadWidth / 2 - 50 + layout.width) : 1080 / 2 + me.RoadWidth / 2 - (me.RoadWidth / leftLane) + layout.width + 1;
                return layout;
            },
            calcRoadBottomStay: function() {
                var me = this;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var layout = {};
                layout.width = bottomLane <= 2 ? 150 : ((me.RoadWidth / bottomLane) * 2);
                layout.height = rightLane <= 2 ? 150 : ((me.RoadWidth / rightLane) * 2);
                layout.left = bottomLane <= 2 ? ((1920 /2 + me.RoadWidth / 2) - 50 + layout.width) : 1920 / 2 + me.RoadWidth / 2 - (me.RoadWidth / bottomLane) + layout.width + 1;
                layout.top = rightLane <= 2 ? (1080 / 2 + me.RoadWidth / 2 - 50 + layout.height) : 1080 / 2 + me.RoadWidth / 2 - (me.RoadWidth / rightLane) + layout.height + 1;
                return layout;
            },
            calcPedestrianRoadBottom: function() {
                var me = this;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var langW = bottomLane <= 2 ? 50 : me.RoadWidth / bottomLane; 
                var langH = rightLane <= 2 ? 50 : me.RoadWidth / rightLane;
                var s = Math.sqrt(langW * langW + langH * langH) / 2;
                var ox = (1920 / 2) + (me.RoadWidth / 2) + 125;
                var oy = (1080 / 2) + (me.RoadWidth / 2) + 125;
                var p = utils.calcRadiusAnyPoint(ox, oy, 150, 225);
                var p2 = utils.calcRadiusAnyPoint(ox, oy, 160 + s, 225);
                return { p1: p, p2: p2 };
            },
            calcPedestrianRoadLeft: function() {
                var me = this;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var langW = bottomLane <= 2 ? 50 : me.RoadWidth / bottomLane; 
                var langH = leftLane <= 2 ? 50 : me.RoadWidth / leftLane;
                var s = Math.sqrt(langW * langW + langH * langH) / 2;
                var ox = (1920 - me.RoadWidth) / 2 - 125;
                var oy = (1080 / 2) + (me.RoadWidth / 2) + 125;
                var p = utils.calcRadiusAnyPoint(ox, oy, 150, 315);
                var p2 = utils.calcRadiusAnyPoint(ox, oy, 160 + s, 315);
                return { p1: p, p2: p2 };
            },
            calcRoadRightForUpwardFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadRightForDownFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadBottomForUpwardFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadBottomForDownFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadLeftForUpwardFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadLeftForDownFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return !it.isUpward });
            }
        },
        methods: {
            calcRoadRightFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 - me.RoadWidth) / 2 - 150;
                    var left = (1920 / 2) + (me.RoadWidth / 2) + 300;
                    return { x: left + i * 120, y: top - r * 90 };
                }

                var top = (1080 / 2 ) + (me.RoadWidth / 2) + 20;
                var left = (1920 / 2) + (me.RoadWidth / 2) + 300;
                return { x: left + i * 120, y: top + r * 90 };
            },
            calcRoadBottomFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 / 2 ) + (me.RoadWidth / 2) + 300;
                    var left = (1920 / 2) + (me.RoadWidth / 2) + 150;
                    return { x: left + r * 90, y : top + i * 120 }
                }

                var top = (1080 / 2 ) + (me.RoadWidth / 2) + 300;
                var left = (1920 - me.RoadWidth) / 2 - 20;
                return { x: left - r * 90, y : top + i * 120 }
            },
            calcRoadLeftFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 / 2 ) + (me.RoadWidth / 2) + 60;
                    var left = (1920 - me.RoadWidth) / 2 - 410;
                    return { x: left - i * 120, y : top + r * 90 }
                }

                var top = (1080 - me.RoadWidth) / 2 - 100;
                var left = (1920 - me.RoadWidth) / 2 - 410;
                return { x: left - i * 120, y : top - r * 90 }
            },
            roadLeftMoveTo: function(n) {
                var me = this;
                var v = { x : (1920 - me.RoadWidth) / 2, y : 1080 / 2 + me.RoadWidth / 2 };
                var width = me.calcRoadLeftLaneWidth;
                return { x : v.x - 60, y :  v.y - ((n + 1) * width)}
            },
            roadRightMoveTo: function(n) {
                var me = this;
                var v = { x : 1920 / 2 + me.RoadWidth / 2, y : 1080 / 2 - me.RoadWidth / 2 };
                var width = me.calcRoadRightLaneWidth;
                return { x : v.x + 60, y: v.y + ((n + 1) * width) }
            },
            roadBottomMoveTo: function(n) {
                var me = this;
                var v = { x : 1920 / 2 + me.RoadWidth / 2, y : 1080 / 2 + me.RoadWidth / 2 };
                var width = me.calcRoadBottomLaneWidth;
                return { x : v.x - ((n + 1) * width), y: v.y + 60 }
            },
            onRoadPedestrianClick: function(e, no, isStay) {
                //十字路口行人斑马线的点击事件
                this.$parent.$emit('cross-road-pedestrian-click', e, no, isStay);
            },
			onRoadFlagClick: function(e, no, flag) {
                this.$parent.$emit('cross-road-flag-click', e, no, flag);
			},
            onRoadStopLineClick: function(e, no) {
                //机动车停止线点击事件
                this.$parent.$emit("cross-road-stopline-click", e, no);
            },
            onRoadBoundaryClick: function(e, no, isRight) {
                //十字路口公路边界线的点击事件
                this.$parent.$emit('cross-road-boundary-click', e, no, isRight ? 'right' : 'left');
            },
            onRoadLanePavementClick: function(e, no, lane) {
                //机动车道路点击事件
                this.$parent.$emit("cross-road-pavement-click", e, no, lane);
            },
            onRoadLaneSolidLineClick: function(e, no, lane) {
                //机动车道路白色实线点击事件
                this.$parent.$emit("cross-solid-line-click", e, no, lane);
            },
            onRoadLaneDottedLineClick: function(e, no, lane) {
                //机动车道路白色虚线点击事件
                this.$parent.$emit("cross-dotted-line-click", e, no, lane);
            },
            onRoadParterreBoundaryClick: function(e, no, lane) {
                //花坛边界线点击事件
                this.$parent.$emit("cross-parterre-boundary-line-click", e, no, lane);
            },
            onRoadLaneYDottedLineClick: function() {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-dotted-line-click", e, no, lane);
            },
            onRoadLaneYSolidLineClick: function(e, no, lane) {
                //机动车黄色实线点击事件
                this.$parent.$emit("cross-y-solid-line-click", e, no, lane);
            },
            onRoadLaneYDoubleSolidLineClick: function(e, no, lane, side) {
                //机动车双黄色实线点击事件
                this.$parent.$emit("cross-y-double-solid-line-click", e, no, lane, side);
            },
            onRoadLaneYDoubleDottedLineClick: function(e, no, lane, side) {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-double-dashed-line-click", e, no, lane, side);
            },
            onRoadLaneYSolidAreaClick: function(e, no, lane) {
                //机动车黄色禁停区域点击事件
                this.$parent.$emit("cross-y-area-click", e, no, lane);
            },
            onRoadLaneParterreClick: function(e, no, lane) {
                //花坛绿色区域点击事件
                this.$parent.$emit("cross-parterre-click", e, no, lane);
            },
            onRoadLaneParterreLineClick: function(e, no, lane, side) {
                //花坛内部白线点击事件
                this.$parent.$emit("cross-parterre-line-click", e, no, lane, side);
            },
            onRoadLaneParterreSafeAreaClick: function(e, no, lane) {
                //安全岛点击事件
                this.$parent.$emit("cross-parterre-safearea-click", e, no, lane);
            },
            onRoadLaneMarkClick: function(e, no, lane, side) {
                //道路路标点击事件
                var me = this;
                var mark = {};
                if(no === 0) {
                    mark = me.RoadLeft.Lane[lane].landmark
                }

                if(no === 1) {
                    mark = me.RoadRight.Lane[lane].landmark
                }

                if(no === 2) {
                    mark = me.RoadBottom.Lane[lane].landmark
                }

                this.$parent.$emit("cross-lane-mark-click", e, no, lane, side, mark[side].mark);
            },
            onCrossStayAreaClick: function(e, no) {
                //十字路口行人暂留区域点击事件
                this.$parent.$emit('cross-stay-click', e, no, 'right');
            },
			onCancelLaneMarkHighlight: function() {
				var me = this;
				
				me.RoadRight.Lane = me.RoadRight && me.RoadRight.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadBottom.Lane = me.RoadBottom && me.RoadBottom.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadLeft.Lane = me.RoadLeft && me.RoadLeft.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.$emit("update:road-right", me.RoadRight);
				me.$emit("update:road-bottom", me.RoadBottom);
				me.$emit("update:road-left", me.RoadLeft);
			}
        }
    })
    
    var LRender = function() {
        var template = [
            "<g class='l-road' clip-path='url(#clip)'>",
                "<defs>",
                    "<g :id=\"'stayArea_' + uuid \"><path d='M200,0 V180 C200,200 200,200 180,200 L0,200 C100,200 200,100 200,0 z' fill='#0075c5' stroke='#fff' stroke-width='3' /></g>",
                "</defs>",
                "<g class='ivsom-road-shading'>",
                    "<path v-show='RoadRight.stayArea' :d='caleRoadTopRightNotch' fill='#333' stroke-width='0' />",
                    "<rect :x='1920 / 2 - RoadWidth / 2' :y='(1080 - RoadWidth) / 2' :width='499999.5' :height='RoadWidth' fill='#333' />",
                    "<rect :x='(1920 - RoadWidth) / 2' :y='-499999.5 + (1080 / 2) + (RoadWidth / 2)' :width='RoadWidth' :height='499999.5' fill='#333' />",
                    "<circle :cx='1920 / 2' :cy='1080 / 2' r='15' fill='#fff'>",
                "</g>",
                "<g>",
                    "<path :d='calcRoadTopLeftBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadTopRightBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadRightTopBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRoadRightBottomBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                "</g>",
                "<g>",
                    //行人斑马线
                    "<line v-show='RoadTop.pedestrian' :x1='calcPedestrianLength.top.x1' :x2='calcPedestrianLength.top.x2' :y1='(1080 - RoadWidth) / 2 - 20' :y2='(1080 - RoadWidth) / 2 - 20' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, false)' />",
                    "<line v-show='RoadRight.pedestrian' :x1='1920 / 2 + RoadWidth / 2 + 20' :x2='1920 / 2 + RoadWidth / 2 + 20' :y1='calcPedestrianLength.right.y1' :y2='calcPedestrianLength.right.y2' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, false)' />",
                "</g>",
                "<g>",
                    //机动车停止线
                    "<line v-if='RoadTop.stopLine' :x1='calcRoadTopStopLine.p1.x' :x2='calcRoadTopStopLine.p2.x' :y1='calcRoadTopStopLine.p1.y' :y2='calcRoadTopStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 0)'/>",
                    "<line v-if='RoadRight.stopLine' :x1='calcRoadRightStopLine.p1.x' :x2='calcRoadRightStopLine.p2.x' :y1='calcRoadRightStopLine.p1.y' :y2='calcRoadRightStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 1)'/>",
                "</g>",
                "<lane ",
                    "v-for='(item, n) in RoadTop.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='180' ",
                    ":width='calcRoadTopLaneWidth' ",
                    ":x='crossTopMoveTo(n).x' ",
                    ":y='crossTopMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 0, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 0, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 0, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 0, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 0, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 0, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 0, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 0, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 0, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 0, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 0, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 0, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 0, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadRight.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-90' ",
                    ":width='calcRoadRightWidth' ",
                    ":x='crossRightMoveTo(n).x' ",
                    ":y='crossRightMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 1, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 1, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 1, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 1, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 1, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 1, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 1, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 1, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 1, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 1, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 1, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 1, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 1, n, arguments[1])'",
                    "></lane>",
                "<image v-for='(flag, n) in calcRoadTopForUpwardFlag' :x='calcRoadTopFlagPosition(flag, n).x' :y='calcRoadTopFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(-90, '+ calcRoadTopFlagPosition(flag, n).x +' '+ calcRoadTopFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadTopForDownFlag' :x='calcRoadTopFlagPosition(flag, n).x' :y='calcRoadTopFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon'  :transform=\"'rotate(-90, '+ calcRoadTopFlagPosition(flag, n).x +' '+ calcRoadTopFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForUpwardFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForDownFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<g>",
                    //公路边界线
                    "<path v-show='RoadTop.boundary.right.has' :d='calcRoadTopLeftBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(2, 2)' @click.capture.stop='onRoadBoundaryClick($event, 0, true)' />",
                    "<path v-show='RoadTop.boundary.left.has' :d='calcRoadTopRightBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(-2, 2)'  @click.capture.stop='onRoadBoundaryClick($event, 0, false)' />",
                    "<path v-show='RoadRight.boundary.right.has' :d='calcRoadRightTopBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(-2, 2)' @click.capture.stop='onRoadBoundaryClick($event, 1, true)' />",
                    "<path v-show='RoadRight.boundary.left.has' :d='calcRoadRightBottomBoundary.inner' fill='none' stroke='#fff' stroke-width='2' transform='translate(-2, -2)' @click.capture.stop='onRoadBoundaryClick($event, 1, false)'/>",
                "</g>",
                "<g>",
                    //行人安全暂留区斑马线
                    "<line v-show='RoadRight.pedestrian && RoadRight.stayArea && RoadRight.stayPedestrian' :x1='calcPedestrianRoadRight.p1.x' :x2='calcPedestrianRoadRight.p2.x' :y1='calcPedestrianRoadRight.p1.y' :y2='calcPedestrianRoadRight.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, true)'/>",
                "</g>",
                "<stay-pedestrian v-show='RoadRight.stayArea && RoadRight.pedestrian' :width='calcRoadRightStay.width' :height='calcRoadRightStay.height' :angle='90' :x='calcRoadRightStay.left' :y='calcRoadRightStay.top' :defs='uuid' @on-stay-area-click='onCrossStayAreaClick($event, 1)'></stay-pedestrian>",
                "<text :x='(1920 - RoadWidth) / 2 - 30' :y='(1080 - RoadWidth) / 2 - 200' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(-90 ' + ((1920 - RoadWidth) / 2 - 30) + ', ' + ((1080 - RoadWidth) / 2 - 200) + ')'\"> {{ RoadTop.name }} </text>",
                "<text :x='(1920 / 2) + (RoadWidth / 2) + 300' :y='(1080 - RoadWidth) / 2 - 30' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start'> {{ RoadRight.name }} </text>",
                "<rect v-show='Active == 0' :x='(1920 - RoadWidth) / 2 - 10' :y='-1420 + (1080 - RoadWidth) / 2' :width='RoadWidth + 20' :height='1420' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 1' :x='(1920 / 2) + (RoadWidth / 2)' :y='(1080 - RoadWidth) / 2 - 10' :width='1850' :height='RoadWidth + 20' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
            "</g>"
        ];
        return template.join('');
    }

    var LRoads = Vue.extend({
        template: LRender.apply(this),
        props: {
            RoadTop : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadRight : {
                //路口名称
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadWidth : {
                default: 500,
                type: Number
            },
            Active : {
                default: 0,
                type: Number
            }
        },
        data: function() {
            return {
                uuid : utils.uuid()
            }
        },
        components: {
            "StayPedestrian": StayPedestrian,
            "Lane" : Lane
        },
        computed: {
            calcRoadTopLaneWidth: function() {
                var me = this;
                if(me.RoadTop.Lane && me.RoadTop.Lane.length) {
                    return me.RoadWidth / me.RoadTop.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadRightWidth: function() {
                var me = this;
                if(me.RoadRight.Lane && me.RoadRight.Lane.length) {
                    return me.RoadWidth / me.RoadRight.Lane.length;
                }
                return me.RoadWidth;
            },
            caleRoadTopRightNotch: function() {
                //计算L字路口底色缺口
                var me = this;
                var ox = (1920 / 2) + (me.RoadWidth / 2) - 1;
                var oy = (1080 - me.RoadWidth) / 2 + 1;
                var top = oy - 125;
                var right = ox + 125;
                return "M${ox},${top} V${oy} H${right} S${ox},${oy} ${ox},${top} z".replace(/(\$\{top\})/g, top).replace(/(\$\{right\})/g, right).replace(/(\$\{ox\})/g, ox).replace(/(\$\{oy\})/g, oy);
            },
            calcRoadTopLeftBoundary : function() {
                //计算L字路口上方左侧边界线。
                var me = this;
                var left = (1920 - me.RoadWidth) / 2;
                var ry = 1080 / 2 + me.RoadWidth / 2;
                var out = 'M${left},-499999.5 V${ry}'.replace(/(\$\{left\})/g, left).replace(/(\$\{ry\})/g, ry);
                var inner = 'M${left},-499999.5 V${ry}'.replace(/(\$\{left\})/g, left).replace(/(\$\{ry\})/g, ry);
                return { out: out, inner : inner }
            },
            calcRoadTopRightBoundary : function() {
                //计算L字路口上方右侧边界线。
                var me = this;
                var right = (1920 / 2) + (me.RoadWidth / 2);
                var rx = right + 125;
                var ry = 1080 / 2 - me.RoadWidth / 2 - 125;
                var oy = ((1080 / 2) - me.RoadWidth * 0.5);
                var out = 'M${right},-499999.5 V${ry} S${right},${oy} ${rx},${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry).replace(/(\$\{oy\})/g, oy);
                var inner = 'M${right},-499999.5 V${ry} S${right},${oy} ${rx},${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{rx\})/g, rx - 2).replace(/(\$\{ry\})/g, ry).replace(/(\$\{oy\})/g, oy);
                if(!me.RoadRight.stayArea) {
                    out = 'M${right},-499999.5 V${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{oy\})/g, oy);
                    inner = 'M${right},-499999.5 V${oy}'.replace(/(\$\{right\})/g, right).replace(/(\$\{oy\})/g, oy);
                }
                return { out: out, inner: inner };
            },
            calcRoadRightTopBoundary: function() {
                //计算L字路口右方上侧边界线。
                var me = this;
                var right = 1920 / 2 + me.RoadWidth / 2;
                var top = 1080 / 2 - me.RoadWidth / 2;
                var rx = right + 125;
                var ry = top - 125;
                var out = 'M${right},${ry} S${right},${top} ${rx},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry);
                var inner = 'M${right},${ry} S${right},${top} ${rx},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top).replace(/(\$\{rx\})/g, rx).replace(/(\$\{ry\})/g, ry - 3);
                if (!me.RoadRight.stayArea) {
                    out = 'M${right},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top);
                    inner = 'M${right},${top} h499999.5'.replace(/(\$\{right\})/g, right).replace(/(\$\{top\})/g, top);
                }
                return { out: out, inner: inner };
            },
            calcRoadRightBottomBoundary: function() {
                //计算L字路口右方下侧边界线。
                var me = this;
                var right = 1920 / 2 - me.RoadWidth / 2;
                var bottom = 1080 / 2 + me.RoadWidth / 2;
                var out = "M${right},${bottom} h499999.5".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom);
                var inner = "M${right},${bottom} h499999.5".replace(/(\$\{right\})/g, right).replace(/(\$\{bottom\})/g, bottom);
                return { out : out, inner : inner };
            },
            calcPedestrianRoadRight: function() {
                var me = this;
                var rightLane = me.RoadRight.Lane.length || 0;
                var topLane = me.RoadTop.Lane.length || 0;
                var langW = topLane <= 2 ? 50 : me.RoadWidth / topLane; 
                var langH = rightLane <= 2 ? 50 : me.RoadWidth / rightLane;
                var s = Math.sqrt(langW * langW + langH * langH) / 2;
                var ox = (1920 / 2) + (me.RoadWidth / 2) + 125;
                var oy = (1080 / 2) - (me.RoadWidth / 2) - 125;
                var p = utils.calcRadiusAnyPoint(ox, oy, 130, 135);
                var p2 = utils.calcRadiusAnyPoint(ox, oy, 150 + s, 135);
                return { p1: p, p2: p2 };
            },
            calcPedestrianLength: function() {
                var me = this;
                var topLane = me.RoadTop.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var stayMap = [
                    0,
                    me.RoadRight.stayArea ? (topLane - 2 <= 0 ? 50 : me.RoadWidth / topLane) : 0,
                    me.RoadRight.stayArea ? (rightLane - 2 <= 0 ? 50 : me.RoadWidth / rightLane) : 0,
                    0
                ];
                return {
                    top : {
                        x1 : (1920 - me.RoadWidth) / 2 + stayMap[0],
                        x2 : (1920 / 2) + (me.RoadWidth / 2) - stayMap[1]
                    },
                    right: {
                        y1 : (1080 - me.RoadWidth) / 2 + stayMap[2],
                        y2 : (1080 / 2) + (me.RoadWidth / 2) + stayMap[3]
                    }
                }
            },
            calcRoadTopStopLine: function() {
                var me = this;
                var lane = me.RoadTop.Lane.length || 0;
                var before = 0;
                var after = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var diff = before + after;
                var width = !lane ? me.RoadWidth - diff : ((me.RoadTop.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var x = (1920 - me.RoadWidth) / 2 + before;
                var y = 1080 / 2 - me.RoadWidth / 2;
                return { p1 : { x: x, y: y - 50 }, p2: { x: x + width, y: y - 50 }};
            },
            calcRoadRightStopLine: function() {
                var me = this;
                var lane = me.RoadRight.Lane.length || 0;
                var before = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : me.RoadWidth / lane;
                var height = !lane ? me.RoadWidth - before : ((me.RoadRight.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var x = 1920 / 2 + me.RoadWidth / 2 + 50;
                var y = (1080 - me.RoadWidth) / 2 + before;
                return { p1: { x : x, y : y }, p2: { x : x, y : y + height } };
            },
            calcRoadTopLaneWidth: function() {
                var me = this;
                if(me.RoadTop.Lane && me.RoadTop.Lane.length) {
                    return me.RoadWidth / me.RoadTop.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadTopForUpwardFlag: function () {
                var me = this;
                if (!me.RoadTop.flagList || !me.RoadTop.flagList.length) {
                    return [];
                }
                return me.RoadTop.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadTopForDownFlag: function () {
                var me = this;
                if (!me.RoadTop.flagList || !me.RoadTop.flagList.length) {
                    return [];
                }
                return me.RoadTop.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadRightForUpwardFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadRightForDownFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadRightStay: function() {
                var me = this;
                var topLane = me.RoadTop.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var layout = {};
                layout.width = rightLane <= 2 ? 150 : ((me.RoadWidth / rightLane) * 2);
                layout.height = topLane <= 2 ? 150 : ((me.RoadWidth / topLane) * 2);

                layout.left = topLane <= 2 ? ((1920 /2 + me.RoadWidth / 2) - 50 + layout.height) : 1920 / 2 + me.RoadWidth / 2 + (me.RoadWidth / topLane) + 1;
                layout.top = rightLane <= 2 ? (1080 / 2 - me.RoadWidth / 2 + 50 - layout.width) : (1080 - me.RoadWidth) / 2 + (me.RoadWidth / rightLane) - layout.width - 1;
                return layout;
            },
        },
        methods: {
            crossTopMoveTo: function(n) {
                var me = this;
                var left = (1920 - me.RoadWidth) / 2;
                var top = (1080 - me.RoadWidth) / 2 - 60;
                var width = me.calcRoadTopLaneWidth;
                return { x : (n + 1) * width + left, y: top };
            },
            crossRightMoveTo: function(n) {
                var me = this;
                var top = (1080 - me.RoadWidth) / 2;
                var left = 1920 / 2 + me.RoadWidth / 2 + 60;
                var width = me.calcRoadRightWidth;
                return { x : left, y : (n + 1) * width + top };
            },
            onRoadPedestrianClick: function(e, no, isStay) {
                //L字路口行人斑马线的点击事件
                this.$parent.$emit('cross-road-pedestrian-click', e, no, isStay);
            },
			onRoadFlagClick: function(e, no, flag) {
                this.$parent.$emit('cross-road-flag-click', e, no, flag);
			},
            onRoadStopLineClick: function(e, no) {
                //机动车停止线点击事件
                this.$parent.$emit("cross-road-stopline-click", e, no);
            },
            onRoadLanePavementClick: function(e, no, lane) {
                //机动车道路点击事件
                this.$parent.$emit("cross-road-pavement-click", e, no, lane);
            },
            onRoadLaneSolidLineClick: function(e, no, lane) {
                //机动车道路白色实线点击事件
                this.$parent.$emit("cross-solid-line-click", e, no, lane);
            },
            onRoadLaneDottedLineClick: function(e, no, lane) {
                //机动车道路白色虚线点击事件
                this.$parent.$emit("cross-dotted-line-click", e, no, lane);
            },
            onRoadParterreBoundaryClick: function(e, no, lane) {
                //花坛边界线点击事件
                this.$parent.$emit("cross-parterre-boundary-line-click", e, no, lane);
            },
            onRoadLaneYDottedLineClick: function() {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-dotted-line-click", e, no, lane);
            },
            onRoadLaneYSolidLineClick: function(e, no, lane) {
                //机动车黄色实线点击事件
                this.$parent.$emit("cross-y-solid-line-click", e, no, lane);
            },
            onRoadLaneYDoubleSolidLineClick: function(e, no, lane, side) {
                //机动车双黄色实线点击事件
                this.$parent.$emit("cross-y-double-solid-line-click", e, no, lane, side);
            },
            onRoadLaneYDoubleDottedLineClick: function(e, no, lane, side) {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-double-dashed-line-click", e, no, lane, side);
            },
            onRoadLaneYSolidAreaClick: function(e, no, lane) {
                //机动车黄色禁停区域点击事件
                this.$parent.$emit("cross-y-area-click", e, no, lane);
            },
            onRoadLaneParterreClick: function(e, no, lane) {
                //花坛绿色区域点击事件
                this.$parent.$emit("cross-parterre-click", e, no, lane);
            },
            onRoadLaneParterreLineClick: function(e, no, lane, side) {
                //花坛内部白线点击事件
                this.$parent.$emit("cross-parterre-line-click", e, no, lane, side);
            },
            onRoadLaneParterreSafeAreaClick: function(e, no, lane) {
                //安全岛点击事件
                this.$parent.$emit("cross-parterre-safearea-click", e, no, lane);
            },
            onRoadLaneMarkClick: function(e, no, lane, side) {
                //道路路标点击事件
                var me = this;
                var mark = {};
                if(no === 0) {
                    mark = me.RoadTop.Lane[lane].landmark
                }

                if(no === 1) {
                    mark = me.RoadRight.Lane[lane].landmark
                }

                if(no === 2) {
                    mark = me.RoadBottom.Lane[lane].landmark
                }

                if(no === 3) {
                    mark = me.RoadLeft.Lane[lane].landmark
                }

                this.$parent.$emit("cross-lane-mark-click", e, no, lane, side, mark[side].mark);
            },
            onRoadBoundaryClick: function(e, no, isRight) {
                //L字路口公路边界线的点击事件
                this.$parent.$emit('cross-road-boundary-click', e, no, isRight ? 'right' : 'left');
            },
            onCrossStayAreaClick: function(e, no) {
                //L字路口行人暂留区域点击事件
                this.$parent.$emit('cross-stay-click', e, no, 'right');
            },
            onCancelLaneMarkHighlight: function () {
				var me = this;
				me.RoadTop.Lane = me.RoadTop && me.RoadTop.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadRight.Lane = me.RoadRight && me.RoadRight.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary,
                        hasSafeArea: it.hasSafeArea, 
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.$emit("update:road-top", me.RoadTop);
				me.$emit("update:road-right", me.RoadRight);
			},
            calcRoadTopFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 - me.RoadWidth) / 2 - 200;
                    var left = (1920 - me.RoadWidth) / 2 - 150;
                    return { x: left - r * 90, y: top - i * 120 };
                }

                var top = (1080 - me.RoadWidth) / 2 - 200;
                var left = (1920 / 2) + (me.RoadWidth / 2) + 20;
                return { x: left + r * 90, y: top - i * 120 };
            },
            calcRoadRightFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                if (flag.isUpward) {
                    var top = (1080 - me.RoadWidth) / 2 - 150;
                    var left = (1920 / 2) + (me.RoadWidth / 2) + 300;
                    return { x: left + i * 120, y: top - r * 90 };
                }

                var top = (1080 / 2 ) + (me.RoadWidth / 2) + 20;
                var left = (1920 / 2) + (me.RoadWidth / 2) + 300;
                return { x: left + i * 120, y: top + r * 90 };
            },
        }
    })

    var ORender = function () {
        var template = [
            "<g class='o-road' clip-path='url(#max-clip)'>",
                "<g>",
                    "<path v-for='(item, i) in getRoadMap' :key='i' :d='handlerPavementAngle(i)' fill='#333' />",
                    "<circle :cx='1920 / 2' :cy='1080 / 2' :r='calcCircumscribeRadius' fill='#333' />",
                    "<circle :cx='1920 / 2' :cy='1080 / 2' :r='calcCircumscribeRadius / 3' fill='rgb(53, 159, 64)' stroke-dasharray='10,10' stroke='#fff' stroke-width='3' />",
                    "<g v-for='(item, i) in getRoadMap' :key='i'>",
                        "<path v-show='item.stayArea' :d='hanlderNotch(i)' fill='#333' stroke='#333' stroke-width='2' />",
                        "<path :d='handlerLeftBoundary(i, 2.23606797749979)' fill='none' stroke-linecap='round' stroke='#8e8e8e' stroke-width='5' />",
                        "<path :d='handlerRightBoundary(i, 2.23606797749979)' fill='none' stroke-linecap='round' stroke='#8e8e8e' stroke-width='5' />",
                    "</g>",
                "</g>",
                "<g v-for='(item, i) in getRoadMap' :key='i'>",
                    //行人斑马线
                    "<line v-show='item.pedestrian' :x1='handlerPedestrian(i).p1.x' :x2='handlerPedestrian(i).p2.x' :y1='handlerPedestrian(i).p1.y' :y2='handlerPedestrian(i).p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, i, false)' />",
                    //机动车停止线
                    "<line v-if='item.stopLine' :x1='handlerStopLine(i).p1.x' :x2='handlerStopLine(i).p2.x' :y1='handlerStopLine(i).p1.y' :y2='handlerStopLine(i).p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, i)'/>",
                    "<lane ",
                        "v-for='(it, n) in item.Lane' ",
                        ":type='it.type' ",
                        ":assist='it.assist' ",
                        ":reverse='it.reverse' ",
                        ":markright='it.markright' ",
                        ":has-boundary='it.hasBoundary' ",
                        ":has-safe-area='it.hasSafeArea' ",
                        ":landmark='it.landmark' ",
                        ":angle='handlerLanePosition(i, n).angle' ",
                        ":width='handlerRoadWidth(i)' ",
                        ":x='handlerLanePosition(i, n).vertex.x' ",
                        ":y='handlerLanePosition(i, n).vertex.y' ",
                        "@on-pavement-click='onRoadLanePavementClick($event, i, n)' ",
                        "@on-solid-line-click='onRoadLaneSolidLineClick($event, i, n)' ",
                        "@on-dotted-line-click='onRoadLaneDottedLineClick($event, i, n)' ",
                        "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, i, n)' ",
                        "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, i, n)' ",
                        "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, i, n)' ",
                        "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, i, n, arguments[1])' ",
                        "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, i, n, arguments[1])' ",
                        "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, i, n)' ",
                        "@on-parterre-click='onRoadLaneParterreClick($event, i, n)' ",
                        "@on-parterre-line-click='onRoadLaneParterreLineClick($event, i, n, arguments[1])' ",
                        "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, i, n)' ",
                        "@on-lane-mark-click='onRoadLaneMarkClick($event, i, n, arguments[1])' ",
                        "></lane>",
                    "<image v-for='(flag, n) in handlerForUpwardFlag(item)' :x='handlerFlagPosition(flag, i, n).vertex.x' :y='handlerFlagPosition(flag, i, n).vertex.y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate('+ handlerFlagPosition(flag, i, n).angle +', '+ handlerFlagPosition(flag, i, n).vertex.x +' '+ handlerFlagPosition(flag, i, n).vertex.y +')'\" @click.capture.stop='onRoadFlagClick($event, i, flag)' />",
                    "<image v-for='(flag, n) in handlerForDownFlag(item)' :x='handlerFlagPosition(flag, i, n).vertex.x' :y='handlerFlagPosition(flag, i, n).vertex.y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate('+ handlerFlagPosition(flag, i, n).angle +', '+ handlerFlagPosition(flag, i, n).vertex.x +' '+ handlerFlagPosition(flag, i, n).vertex.y +')'\" @click.capture.stop='onRoadFlagClick($event, i, flag)' />",
                    //公路边界线
                    "<path v-show='item.boundary.left.has' :d='handlerLeftBoundary(i, -1.414213562373095)' stroke-linecap='round' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, i, false)' />",
                    "<path v-show='item.boundary.right.has' :d='handlerRightBoundary(i, -1.414213562373095)' stroke-linecap='round' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, i, true)' />",
                    //行人安全暂留区斑马线
                    "<line v-show='item.pedestrian && item.stayArea && item.stayPedestrian' :x1='handlerSafeAreaPedestrian(i).p1.x' :x2='handlerSafeAreaPedestrian(i).p2.x' :y1='handlerSafeAreaPedestrian(i).p1.y' :y2='handlerSafeAreaPedestrian(i).p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, i, true)'/>",
                    "<path v-show='item.stayArea && item.pedestrian' :d='handlerSafeAreaStay(i)' fill='#0075c5' stroke='#fff' stroke-width='2' style='pointer-events:visiblePainted;' @click='onCrossStayAreaClick($event, i)' />",
                    "<text :x='handlerTextIntersection(i).vertex.x' :y='handlerTextIntersection(i).vertex.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate('+ handlerTextIntersection(i).angle +' ' + handlerTextIntersection(i).vertex.x + ', ' + handlerTextIntersection(i).vertex.y + ')' + ' translate(0,-20)'\"> {{ item.name }} </text>",
                    "<rect v-show='Active == i' :x='handlerActiveRect(i).vertex.x' :y='handlerActiveRect(i).vertex.y' :width='2380' :height='RoadWidth + 20' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10' :transform=\"'rotate('+ handlerActiveRect(i).angle +' ' + handlerActiveRect(i).vertex.x + ', ' + handlerActiveRect(i).vertex.y + ')' + 'translate(0,-10)'\" >",
                        "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                    "</rect>",
                "</g>",
            "</g>"
        ]
        return template.join("")
    }
    var ORoads = Vue.extend({
        template: ORender.apply(this),
        props: {
            Roads: {
                default: [],
                type: Array
            },
            RoadWidth : {
                default: 500,
                type: Number
            },
            Active : {
                default: 0,
                type: Number
            }
        },
        data: function() {
            return {
                uuid : utils.uuid()
            }
        },
        computed: {
            getRoadMap: function () {
                var me = this;
                if (me.Roads && me.Roads.length <= 2) {
                    return [];
                }
                return me.Roads && me.Roads.filter(function (it, i) { return !!it }) || [];
            },
            //多边形的外切圆半径
            calcCircumscribeRadius: function () {
                var me = this;
                var w = me.RoadWidth;
                var a = me.getRoadMap && me.getRoadMap.length || 3;
                return Number((w / (2 * Math.sin(Math.PI / a))).toFixed(7));
            },
            //多边形的内切圆半径
            calcInsideRadius: function () {
                var me = this;
                var w = me.RoadWidth;
                var a = me.getRoadMap && me.getRoadMap.length || 3;
                return w / 2 * Math.cos(Math.PI / a);
            }
        },
        components: {
            "StayPedestrian": StayPedestrian,
            "Lane" : Lane
        },
        methods: {
            handlerPavementAngle: function (i) {
                var me = this;
                var r = me.calcCircumscribeRadius;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((i * (360 / count)) - ((360 / count) / 2));
                var a2 = a + (360 / count);
                var c = { x: 1920 / 2, y: 1080 / 2 };
                //外切圆顶点计算
                var v1 = utils.calcRadiusAnyPoint(c.x, c.y, r, a);
                var v2 = utils.calcRadiusAnyPoint(c.x, c.y, r, a2);
                var v3 = utils.calcRadiusAnyPoint(v2.x, v2.y, 499999.5, -90 + (i * (360 / count)));
                var v4 = utils.calcRadiusAnyPoint(v1.x, v1.y, 499999.5, -90 + (i * (360 / count)));
                //内切圆顶点计算
                // var v = utils.calcRadiusAnyPoint(c.x, c.y, r, -90 + a);
                // var v1 = utils.calcRadiusAnyPoint(v.x, v.y, r, -180 + a);
                return "M${v1x},${v1y} L${v2x},${v2y} ${v3x},${v3y} ${v4x},${v4y} ${v1x},${v1y} z".replace(/\$\{v1x\}/g, v1.x).replace(/\$\{v1y\}/g, v1.y)
                    .replace(/\$\{v2x\}/g, v2.x).replace(/\$\{v2y\}/g, v2.y).replace(/\$\{v3x\}/g, v3.x).replace(/\$\{v3y\}/g, v3.y)
                    .replace(/\$\{v4x\}/g, v4.x).replace(/\$\{v4y\}/g, v4.y);
            },
            handlerLeftBoundary: function (i, offset) {
                var me = this;
                var r = me.calcCircumscribeRadius;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((i * (360 / count)) + ((360 / count) / 2));
                var ar = a + ((360 / count) / 2);
                var al = a - ((360 / count) / 2);
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var index = me.getRoadMap.length > i + 1 ? i + 1 : 0;
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r + offset, a);
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, ar);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, 120, al);
                var r1 = utils.calcRadiusAnyPoint(v.x, v.y, 60, a);
                var v3 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, al);

                var out = "M${v1x},${v1y} S${r1x},${r1y} ${v2x},${v2y} L${v3x},${v3y}".replace(/\$\{v1x\}/g, v1.x).replace(/\$\{v1y\}/g, v1.y)
                    .replace(/\$\{v2x\}/g, v2.x).replace(/\$\{v2y\}/g, v2.y).replace(/\$\{r1x\}/g, r1.x).replace(/\$\{r1y\}/g, r1.y)
                    .replace(/\$\{v3x\}/g, v3.x).replace(/\$\{v3y\}/g, v3.y);
                if(!me.getRoadMap[index].stayArea) {
                    out = "M${vx},${vy} L${v3x},${v3y}".replace(/\$\{vx\}/g, v.x).replace(/\$\{vy\}/g, v.y).replace(/\$\{v3x\}/g, v3.x).replace(/\$\{v3y\}/g, v3.y);
                }
                return out;
            },
            handlerRightBoundary: function (i, offset) {
                var me = this;
                var r = me.calcCircumscribeRadius;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((i * (360 / count)) - ((360 / count) / 2));
                var al = a - ((360 / count) / 2);
                var ar = a + ((360 / count) / 2);
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r + offset, a);
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, al);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, 120, ar);
                var r1 = utils.calcRadiusAnyPoint(v.x, v.y, 60, a);
                var v3 = utils.calcRadiusAnyPoint(v.x, v.y, 499999.5, ar);

                var out = "M${v1x},${v1y} S${r1x},${r1y} ${v2x},${v2y} L${v3x},${v3y}".replace(/\$\{v1x\}/g, v1.x).replace(/\$\{v1y\}/g, v1.y)
                    .replace(/\$\{v2x\}/g, v2.x).replace(/\$\{v2y\}/g, v2.y).replace(/\$\{r1x\}/g, r1.x).replace(/\$\{r1y\}/g, r1.y)
                    .replace(/\$\{v3x\}/g, v3.x).replace(/\$\{v3y\}/g, v3.y);
                if(!me.getRoadMap[i].stayArea) {
                    out = "M${vx},${vy} L${v3x},${v3y}".replace(/\$\{vx\}/g, v.x).replace(/\$\{vy\}/g, v.y).replace(/\$\{v3x\}/g, v3.x).replace(/\$\{v3y\}/g, v3.y);
                }
                return out;
            },
            hanlderNotch: function (i) {
                var me = this;
                var r = me.calcCircumscribeRadius;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((i * (360 / count)) - ((360 / count) / 2));
                var al = a - ((360 / count) / 2);
                var ar = a + ((360 / count) / 2);
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r, a);
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, al);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, 120, ar);
                var r1 = utils.calcRadiusAnyPoint(v.x, v.y, 60, a);
                return "M${v1x},${v1y} L${vx},${vy} ${v2x},${v2y} S${rx},${ry} ${v1x},${v1y} z"
                    .replace(/\$\{v1x\}/g, v1.x).replace(/\$\{v1y\}/g, v1.y).replace(/\$\{v2x\}/g, v2.x).replace(/\$\{v2y\}/g, v2.y)
                    .replace(/\$\{rx\}/g, r1.x).replace(/\$\{ry\}/g, r1.y).replace(/\$\{vx\}/g, v.x).replace(/\$\{vy\}/g, v.y);
            },
            handlerRoadWidth: function(i) {
                var me = this;
                if(me.getRoadMap[i].Lane && me.getRoadMap[i].Lane.length) {
                    return Number((me.RoadWidth / me.getRoadMap[i].Lane.length).toFixed(5));
                }
                return me.RoadWidth;
            },
            handlerPedestrian: function (i) {
                var me = this;
                var diff = me.getRoadMap[i].Lane && me.getRoadMap[i].Lane.length <= 2 ? 50 : me.handlerRoadWidth(i);
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + (i * (360 / count));
                var r = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r + 20, a);
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, me.RoadWidth / 2 - diff, a - 90);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, me.RoadWidth / 2 - diff, a + 90);
                return { p1: v1, p2: v2 };
            },
            handlerSafeAreaPedestrian: function (i) {
                var me = this;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((i * (360 / count)) - ((360 / count) / 2));
                var r = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var p1 = utils.calcRadiusAnyPoint(c.x, c.y, r, a);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, 60, a);
                return { p1: p1, p2: p2 };
            },
            handlerSafeAreaStay: function (i) {
                var me = this;
                var prevIndex = i - 1 < 0 ? me.getRoadMap.length - 1 : i - 1;
                var prevLane = me.getRoadMap[prevIndex] && me.getRoadMap[prevIndex].Lane.length || 0;
                var curLane = me.getRoadMap[i] && me.getRoadMap[i].Lane.length || 0;
                var prevDiff = prevLane <= 2 ? 50 : Number((me.RoadWidth / prevLane).toFixed(5));
                var curDiff = curLane <= 2 ? 50 : Number((me.RoadWidth / curLane).toFixed(5));
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((i * (360 / count)) - ((360 / count) / 2));
                var al = a - ((360 / count) / 2);
                var ar = a + ((360 / count) / 2);
                var r = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r, a);
                //计算人行暂留区域的左侧参考绘制点
                var r1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, al);
                var v1 = utils.calcRadiusAnyPoint(r1.x, r1.y, prevDiff, -90 + al);
                var r2 = utils.calcRadiusAnyPoint(v1.x, v1.y, 9999, -180 + al);
                //计算人行暂留区域的右侧参考绘制点
                var r3 = utils.calcRadiusAnyPoint(v.x, v.y, 120, ar);
                var v2 = utils.calcRadiusAnyPoint(r3.x, r3.y, curDiff, 90 + ar);
                var r4 = utils.calcRadiusAnyPoint(v2.x, v2.y, 9999, ar + 180);
                //计算人行暂留区域的顶角圆
                var r5 = utils.calcLineIntersection(v1, r2, v2, r4);
                var v3 = utils.calcRadiusAnyPoint(r5.x, r5.y, 50, al);
                var v4 = utils.calcRadiusAnyPoint(r5.x, r5.y, 50, ar);
                var s1 = utils.calcRadiusAnyPoint(v.x, v.y, -60, a);

                return "M${v1x},${v1y} L${v3x},${v3y} C${r5x},${r5y} ${r5x},${r5y} ${v4x},${v4y} L${v2x},${v2y} S${s1x},${s1y} ${v1x},${v1y} z"
                    .replace(/\$\{v1x\}/g, v1.x).replace(/\$\{v1y\}/g, v1.y).replace(/\$\{v3x\}/g, v3.x).replace(/\$\{v3y\}/g, v3.y)
                    .replace(/\$\{r5x\}/g, r5.x).replace(/\$\{r5y\}/g, r5.y).replace(/\$\{v4x\}/g, v4.x).replace(/\$\{v4y\}/g, v4.y)
                    .replace(/\$\{v2x\}/g, v2.x).replace(/\$\{v2y\}/g, v2.y).replace(/\$\{s1x\}/g, s1.x).replace(/\$\{s1y\}/g, s1.y);
            },
            handlerTextIntersection: function(i) {
                var me = this;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((i * (360 / count)) - ((360 / count) / 2));
                var ar = a + ((360 / count) / 2);
                var r = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r, a);
                return { vertex: utils.calcRadiusAnyPoint(v.x, v.y, 300, ar), angle : ar };
            },
            handlerStopLine: function (i) { 
                var me = this;
                var lane = me.getRoadMap[i] && me.getRoadMap[i].Lane.length || 0;
                var diff = !me.getRoadMap[i].stayArea ? 0 : lane <= 2 ? 50 : Number((me.RoadWidth / lane).toFixed(5));
                var len = !lane ? me.RoadWidth - (diff * 2) : ((me.getRoadMap[i].Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane));
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + (i * (360 / count));
                var r = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r + 50, a);
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, me.RoadWidth / 2 - diff, a - 90);
                var v2 = utils.calcRadiusAnyPoint(v1.x, v1.y, me.getRoadMap[i].stayArea ? (len - diff) : len, a + 90);
                return { p1: v1, p2: v2 };
            },
            handlerLanePosition: function (i, k) {
                var me = this;
                var lane = me.getRoadMap[i] && me.getRoadMap[i].Lane.length || 0;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var w = Number((me.RoadWidth / lane).toFixed(5));
                var a = -90 + (i * (360 / count));
                var r = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, r + 60, a);
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, me.RoadWidth / 2, a - 90);
                var v2 = utils.calcRadiusAnyPoint(v1.x, v1.y, (k + 1) * w, a + 90);
                return { vertex : v2, angle: -90 + a }
            },
            handlerForUpwardFlag: function (item) {
                if (!item.flagList || !item.flagList.length) {
                    return [];
                }
                return item.flagList.filter(function (it) { return it.isUpward });
            },
            handlerForDownFlag: function (item) {
                if (!item.flagList || !item.flagList.length) {
                    return [];
                }
                return item.flagList.filter(function (it) { return !it.isUpward });
            },
            handlerFlagPosition: function (flag, lane, n) {
                var me = this;
                var i = n % 16;
                var r = Math.floor(n / 16);
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((lane * (360 / count)) - ((360 / count) / 2));
                var ar = a + ((360 / count) / 2);
                var radius = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, radius, a);
                if (flag.isUpward) {
                    var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 300 + i * 120, ar);
                    var v2 = utils.calcRadiusAnyPoint(v1.x, v1.y, 130 + r * 90, -90 + ar);
                    return { vertex: v2, angle: ar };
                }

                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 300 + i * 120, ar);
                var v2 = utils.calcRadiusAnyPoint(v1.x, v1.y, -(me.RoadWidth + 20) - r * 90, -90 + ar);
                return { vertex: v2, angle: ar };
            },
            handlerActiveRect: function (lane) {
                var me = this;
                var count = me.getRoadMap && me.getRoadMap.length || 3;
                var a = -90 + ((lane * (360 / count)) - ((360 / count) / 2));
                var ar = a + ((360 / count) / 2);
                var radius = me.calcCircumscribeRadius;
                var c = { x: 1920 / 2, y: 1080 / 2 };
                var v = utils.calcRadiusAnyPoint(c.x, c.y, radius, a);
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 60, ar);
                return { vertex : v1, angle: ar }
            },
            onRoadPedestrianClick: function(e, no, isStay) {
                //转盘路口行人斑马线的点击事件
                this.$parent.$emit('cross-road-pedestrian-click', e, no, isStay);
            },
            onRoadStopLineClick: function(e, no) {
                //机动车停止线点击事件
                this.$parent.$emit("cross-road-stopline-click", e, no);
            },
			onRoadFlagClick: function(e, no, flag) {
                this.$parent.$emit('cross-road-flag-click', e, no, flag);
			},
            onRoadLanePavementClick: function(e, no, lane) {
                //机动车道路点击事件
                this.$parent.$emit("cross-road-pavement-click", e, no, lane);
            },
            onRoadLaneSolidLineClick: function(e, no, lane) {
                //机动车道路白色实线点击事件
                this.$parent.$emit("cross-solid-line-click", e, no, lane);
            },
            onRoadLaneDottedLineClick: function(e, no, lane) {
                //机动车道路白色虚线点击事件
                this.$parent.$emit("cross-dotted-line-click", e, no, lane);
            },
            onRoadParterreBoundaryClick: function(e, no, lane) {
                //花坛边界线点击事件
                this.$parent.$emit("cross-parterre-boundary-line-click", e, no, lane);
            },
            onRoadLaneYDottedLineClick: function() {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-dotted-line-click", e, no, lane);
            },
            onRoadLaneYSolidLineClick: function(e, no, lane) {
                //机动车黄色实线点击事件
                this.$parent.$emit("cross-y-solid-line-click", e, no, lane);
            },
            onRoadLaneYDoubleSolidLineClick: function(e, no, lane, side) {
                //机动车双黄色实线点击事件
                this.$parent.$emit("cross-y-double-solid-line-click", e, no, lane, side);
            },
            onRoadLaneYDoubleDottedLineClick: function(e, no, lane, side) {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-double-dashed-line-click", e, no, lane, side);
            },
            onRoadLaneYSolidAreaClick: function(e, no, lane) {
                //机动车黄色禁停区域点击事件
                this.$parent.$emit("cross-y-area-click", e, no, lane);
            },
            onRoadLaneParterreClick: function(e, no, lane) {
                //花坛绿色区域点击事件
                this.$parent.$emit("cross-parterre-click", e, no, lane);
            },
            onRoadLaneParterreLineClick: function(e, no, lane, side) {
                //花坛内部白线点击事件
                this.$parent.$emit("cross-parterre-line-click", e, no, lane, side);
            },
            onRoadLaneParterreSafeAreaClick: function(e, no, lane) {
                //安全岛点击事件
                this.$parent.$emit("cross-parterre-safearea-click", e, no, lane);
            },
            onRoadLaneMarkClick: function(e, no, lane, side) {
                //道路路标点击事件
                var me = this;
                var mark = {};
                var mark = me.getRoadMap[no] && me.getRoadMap[no].Lane[lane].landmark;
                this.$parent.$emit("cross-lane-mark-click", e, no, lane, side, mark[side].mark);
            },
            onRoadBoundaryClick: function(e, no, isRight) {
                //O字路口公路边界线的点击事件
                this.$parent.$emit('cross-road-boundary-click', e, no, isRight ? 'right' : 'left');
            },
            onRoadPedestrianClick: function(e, no, isStay) {
                //O字路口行人斑马线的点击事件
                this.$parent.$emit('cross-road-pedestrian-click', e, no, isStay);
            },
            onCrossStayAreaClick: function(e, no) {
                //O字路口行人暂留区域点击事件
                this.$parent.$emit('cross-stay-click', e, no, 'right');
            },
			onCancelLaneMarkHighlight: function() {
                var me = this;
                var modify = me.Roads.concat([]);
                var modify = modify.map(function (it) {
                    it.Lane = it.Lane.map(function (lane) {
                        return { 
                            type: lane.type, 
                            assist: lane.assist, 
                            reverse: lane.reverse, 
                            markright: lane.markright, 
                            hasBoundary: lane.hasBoundary,
                            hasSafeArea: lane.hasSafeArea,
                            landmark: lane.landmark.map(function(mark) { 
                                return { seq: mark.seq , mark: mark.mark, highlight: false } 
                            })
                        }
                    })
                    return it;
                })
				
				me.$emit("update:roads", modify);
			}
        }
    })

    var KRender = function() {
        var template = [
            "<g class='k-road' clip-path='url(#clip)'>",
                "<g>",
                    "<rect :x='getCenterIntersection.x - RoadWidth' y='-499999.5' :width='RoadWidth' height='999999' fill='#333' />",
                    "<rect :x='getCenterIntersection.x' :y='getCenterIntersection.y - RoadWidth / 2' width='499999.5' :height='RoadWidth' style='transform:rotate(-45deg); transform-origin: center center;' fill='#333' />",
                    "<rect :x='getCenterIntersection.x' :y='getCenterIntersection.y - RoadWidth / 2' width='499999.5' :height='RoadWidth' style='transform:rotate(45deg); transform-origin: center center;' fill='#333' />",
                    "<path :d='calcRoadTopNotch' fill='#333' stroke='#333' stroke-width='1'/>",
                    "<path :d='calcRoadRightNotch' fill='#333' stroke='#333' stroke-width='1'/>",
                    "<path :d='calcRoadBottomNotch' fill='#333' stroke='#333' stroke-width='1'/>",
                    "<line :x1='getCenterIntersection.x - RoadWidth - 2.5' y1='-499999.5' :x2='getCenterIntersection.x - RoadWidth' :y2='-499999.5 + 999999' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcTopRoadBoundary.out' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRightRoadBoundary.outRight' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcRightRoadBoundary.outLeft' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcLeftRoadBoudary.outRight' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcLeftRoadBoudary.outLeft' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<path :d='calcBottomRoadBoudary.outRight' fill='none' stroke='#8e8e8e' stroke-width='5' />",
                    "<circle :cx='getCenterIntersection.x' :cy='getCenterIntersection.y' r='15' fill='#fff' />",
                "</g>",
                "<g>",
                    //行人斑马线
                    "<line v-show='RoadTop.pedestrian' :x1='calcPedestrianLength.top.p1.x' :x2='calcPedestrianLength.top.p2.x' :y1='calcPedestrianLength.top.p1.y' :y2='calcPedestrianLength.top.p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 0, false)' />",
                    "<line v-show='RoadRight.pedestrian' :x1='calcPedestrianLength.right.p1.x' :x2='calcPedestrianLength.right.p2.x' :y1='calcPedestrianLength.right.p1.y' :y2='calcPedestrianLength.right.p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, false)' />",
                    "<line v-show='RoadLeft.pedestrian' :x1='calcPedestrianLength.left.p1.x' :x2='calcPedestrianLength.left.p2.x' :y1='calcPedestrianLength.left.p1.y' :y2='calcPedestrianLength.left.p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, false)' />",
                    "<line v-show='RoadBottom.pedestrian' :x1='calcPedestrianLength.bottom.p1.x' :x2='calcPedestrianLength.bottom.p2.x' :y1='calcPedestrianLength.bottom.p1.y' :y2='calcPedestrianLength.bottom.p2.y' stroke='#fff' stroke-width='40' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 3, false)' />",
                "</g>",
                "<g>",
                    //机动车停止线
                    "<line v-if='RoadTop.stopLine' :x1='calcRoadTopStopLine.p1.x' :x2='calcRoadTopStopLine.p2.x' :y1='calcRoadTopStopLine.p1.y' :y2='calcRoadTopStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 0)'/>",
                    "<line v-if='RoadRight.stopLine' :x1='calcRoadRightStopLine.p1.x' :x2='calcRoadRightStopLine.p2.x' :y1='calcRoadRightStopLine.p1.y' :y2='calcRoadRightStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 1)'/>",
                    "<line v-if='RoadLeft.stopLine' :x1='calcRoadLeftStopLine.p1.x' :x2='calcRoadLeftStopLine.p2.x' :y1='calcRoadLeftStopLine.p1.y' :y2='calcRoadLeftStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 2)' />",
                    "<line v-if='RoadBottom.stopLine' :x1='calcRoadBottomStopLine.p1.x' :x2='calcRoadBottomStopLine.p2.x' :y1='calcRoadBottomStopLine.p1.y' :y2='calcRoadBottomStopLine.p2.y' stroke='#fff' stroke-width='5' @click.capture.stop='onRoadStopLineClick($event, 3)' />",
                "</g>",
                "<lane ",
                    "v-for='(item, n) in RoadTop.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-180' ",
                    ":width='calcRoadTopLaneWidth' ",
                    ":x='crossTopMoveTo(n).x' ",
                    ":y='crossTopMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 0, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 0, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 0, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 0, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 0, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 0, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 0, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 0, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 0, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 0, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 0, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 0, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 0, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadRight.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-135' ",
                    ":width='calcRoadRightLaneWidth' ",
                    ":x='crossRightMoveTo(n).x' ",
                    ":y='crossRightMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 1, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 1, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 1, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 1, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 1, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 1, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 1, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 1, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 1, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 1, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 1, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 1, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 1, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadLeft.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='-45' ",
                    ":width='calcRoadLeftLaneWidth' ",
                    ":x='crossLeftMoveTo(n).x' ",
                    ":y='crossLeftMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 2, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 2, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 2, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 2, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 2, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 2, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 2, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 2, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 2, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 2, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 2, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 2, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 2, n, arguments[1])'",
                    "></lane>",
                "<lane ",
                    "v-for='(item, n) in RoadBottom.Lane' ",
                    ":type='item.type' ",
                    ":assist='item.assist' ",
                    ":reverse='item.reverse' ",
                    ":markright='item.markright' ",
                    ":has-boundary='item.hasBoundary' ",
                    ":has-safe-area='item.hasSafeArea' ",
                    ":landmark='item.landmark' ",
                    ":angle='0' ",
                    ":width='calcRoadBottomLaneWidth' ",
                    ":x='crossBottomMoveTo(n).x' ",
                    ":y='crossBottomMoveTo(n).y' ",
                    "@on-pavement-click='onRoadLanePavementClick($event, 3, n)'",
                    "@on-solid-line-click='onRoadLaneSolidLineClick($event, 3, n)'",
                    "@on-dotted-line-click='onRoadLaneDottedLineClick($event, 3, n)'",
                    "@on-parterre-boundary-line-click='onRoadParterreBoundaryClick($event, 3, n)'",
                    "@on-y-dotted-line-click='onRoadLaneYDottedLineClick($event, 3, n)'",
                    "@on-y-solid-line-click='onRoadLaneYSolidLineClick($event, 3, n)'",
                    "@on-double-y-solid-click='onRoadLaneYDoubleSolidLineClick($event, 3, n, arguments[1])'",
                    "@on-double-y-dashed-click='onRoadLaneYDoubleDottedLineClick($event, 3, n, arguments[1])'",
                    "@on-y-solid-area-click='onRoadLaneYSolidAreaClick($event, 3, n)'",
                    "@on-parterre-click='onRoadLaneParterreClick($event, 3, n)'",
                    "@on-parterre-line-click='onRoadLaneParterreLineClick($event, 3, n, arguments[1])'",
                    "@on-parterre-safe-area-click='onRoadLaneParterreSafeAreaClick($event, 3, n)'",
                    "@on-lane-mark-click='onRoadLaneMarkClick($event, 3, n, arguments[1])'",
                    "></lane>",
                "<image v-for='(flag, n) in calcRoadTopForUpwardFlag' :x='calcRoadTopFlagPosition(flag, n).x' :y='calcRoadTopFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(-90, '+ calcRoadTopFlagPosition(flag, n).x +' '+ calcRoadTopFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadTopForDownFlag' :x='calcRoadTopFlagPosition(flag, n).x' :y='calcRoadTopFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon'  :transform=\"'rotate(-90, '+ calcRoadTopFlagPosition(flag, n).x +' '+ calcRoadTopFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 0, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForUpwardFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(-45, '+ calcRoadRightFlagPosition(flag, n).x +' '+ calcRoadRightFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadRightForDownFlag' :x='calcRoadRightFlagPosition(flag, n).x' :y='calcRoadRightFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(-45, '+ calcRoadRightFlagPosition(flag, n).x +' '+ calcRoadRightFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 1, flag)' />",
                "<image v-for='(flag, n) in calcRoadLeftForUpwardFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(45, '+ calcRoadLeftFlagPosition(flag, n).x +' '+ calcRoadLeftFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<image v-for='(flag, n) in calcRoadLeftForDownFlag' :x='calcRoadLeftFlagPosition(flag, n).x' :y='calcRoadLeftFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(45, '+ calcRoadLeftFlagPosition(flag, n).x +' '+ calcRoadLeftFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 2, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForUpwardFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 3, flag)' />",
                "<image v-for='(flag, n) in calcRoadBottomForDownFlag' :x='calcRoadBottomFlagPosition(flag, n).x' :y='calcRoadBottomFlagPosition(flag, n).y' width='110' height='80' style='cursor: pointer;' :xlink:href='flag.icon' :transform=\"'rotate(90, '+ calcRoadBottomFlagPosition(flag, n).x +' '+ calcRoadBottomFlagPosition(flag, n).y +')'\" @click.capture.stop='onRoadFlagClick($event, 3, flag)' />",
                "<g>",
                    //公路边界线
                    "<path v-show='RoadTop.boundary.left.has' :d='calcTopRoadBoundary.left' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 0, false)'/>",
                    "<path v-show='RoadTop.boundary.right.has' :d='calcTopRoadBoundary.right' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 0, true)' />",
                    "<path v-show='RoadRight.boundary.left.has' :d='calcRightRoadBoundary.left' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 1, false)'/>",
                    "<path v-show='RoadRight.boundary.right.has' :d='calcRightRoadBoundary.right' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 1, true)' />",
                    "<path v-show='RoadLeft.boundary.left.has' :d='calcLeftRoadBoudary.left' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 2, false)' />",
                    "<path v-show='RoadLeft.boundary.right.has' :d='calcLeftRoadBoudary.right' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 2, true)' />",
                    "<path v-show='RoadBottom.boundary.left.has' :d='calcBottomRoadBoudary.left' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 3, false)'/>",
                    "<path v-show='RoadBottom.boundary.right.has' :d='calcBottomRoadBoudary.right' fill='none' stroke='#fff' stroke-width='2' @click.capture.stop='onRoadBoundaryClick($event, 3, true)'/>",
                "</g>",
                "<g>",
                    //行人安全暂留区斑马线
                    "<line v-show='RoadRight.pedestrian && RoadRight.stayArea && RoadRight.stayPedestrian' :x1='calcRightPedestrian.p1.x' :x2='calcRightPedestrian.p2.x' :y1='calcRightPedestrian.p1.y' :y2='calcRightPedestrian.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 1, true)'/>",
                    "<line v-show='RoadLeft.pedestrian && RoadLeft.stayArea && RoadLeft.stayPedestrian' :x1='calcLeftPedestrian.p1.x' :x2='calcLeftPedestrian.p2.x' :y1='calcLeftPedestrian.p1.y' :y2='calcLeftPedestrian.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 2, true)'/>",
                    "<line v-show='RoadBottom.pedestrian && RoadBottom.stayArea && RoadBottom.stayPedestrian' :x1='calcBottomPedestrian.p1.x' :x2='calcBottomPedestrian.p2.x' :y1='calcBottomPedestrian.p1.y' :y2='calcBottomPedestrian.p2.y' stroke='#fff' stroke-width='40' stroke='#fff' stroke-dasharray='5,5' style='pointer-events:visibleStroke;' @click.capture.stop='onRoadPedestrianClick($event, 3, true)'/>",
                "</g>",
                "<g>",
                    "<path v-show='RoadRight.stayArea && RoadRight.pedestrian' :d='calcRoadTopStay' fill='#0075c5' stroke='#fff' stroke-width='2' style='pointer-events:visiblePainted;' @click='onCrossStayAreaClick($event, 1)' />",
                    "<path v-show='RoadLeft.stayArea && RoadLeft.pedestrian' :d='calcRoadRightStay' fill='#0075c5' stroke='#fff' stroke-width='2' style='pointer-events:visiblePainted;' @click='onCrossStayAreaClick($event, 2)' />",
                    "<path v-show='RoadBottom.stayArea && RoadBottom.pedestrian' :d='calcRoadLeftStay' fill='#0075c5' stroke='#fff' stroke-width='2' style='pointer-events:visiblePainted;' @click='onCrossStayAreaClick($event, 3)' />",
                "</g>",
                "<text :x='getTopTextIntersection.x' :y='getTopTextIntersection.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(-90 ' + getTopTextIntersection.x + ', ' + getTopTextIntersection.y + ')'\"> {{ RoadTop.name }} </text>",
                "<text :x='getRightTextIntersection.x' :y='getRightTextIntersection.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(-45 ' + getRightTextIntersection.x + ', ' + getRightTextIntersection.y + ')'\"> {{ RoadRight.name }} </text>",
                "<text :x='getLeftTextIntersection.x' :y='getLeftTextIntersection.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(45 ' + getLeftTextIntersection.x + ', ' + getLeftTextIntersection.y + ')'\"> {{ RoadLeft.name }} </text>",
                "<text :x='getBottomTextIntersection.x' :y='getBottomTextIntersection.y' font-family='Verdana, Helvetica, Arial, sans-serif' font-size='35' fill='#fff' text-anchor='start' :transform=\"'rotate(90 ' + getBottomTextIntersection.x + ', ' + getBottomTextIntersection.y + ')'\"> {{ RoadBottom.name }} </text>",
                "<rect v-show='Active == 0' :x='getTopActiveRect.x - 10' :y='getTopActiveRect.y' :width='RoadWidth + 20' :transform=\"'rotate(-180 ' + getTopActiveRect.x + ', ' + getTopActiveRect.y + ')'\" :height='1350' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 1' :x='getLeftActiveRect.x' :y='getLeftActiveRect.y' :width='RoadWidth + 20' :transform=\"'rotate(-135 ' + getLeftActiveRect.x + ', ' + getLeftActiveRect.y + ')'\" :height='1900' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 2' :x='getRightActiveRect.x' :y='getRightActiveRect.y' :width='RoadWidth + 20' :transform=\"'rotate(-45 ' + getRightActiveRect.x + ', ' + getRightActiveRect.y + ')'\" :height='1900' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
                "<rect v-show='Active == 3' :x='getBottomActiveRect.x' :y='getBottomActiveRect.y' :width='RoadWidth + 20' :transform=\"'rotate(0 ' + getBottomActiveRect.x + ', ' + getBottomActiveRect.y + ')'\" :height='1350' stroke='red' stroke-width='3' fill='none' stroke-dasharray='10 10'>",
                    "<animate attributeType='css' attributeName='opacity' from='0' to='1' dur='1s' repeatCount='indefinite' />",
                "</rect>",
            "</g>"
        ]
        return template.join("")
    }

    var KRoads = Vue.extend({
        template: KRender.apply(this),
        props : {
            RoadTop : {
                //路口名称，前端支持此属性，但无UI表现,仅限数据交互使用。
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadRight : {
                //路口名称，前端支持此属性，但无UI表现,仅限数据交互使用。
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadBottom : {
                //路口名称，前端支持此属性，但无UI表现,仅限数据交互使用。
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadLeft : {
                //路口名称，前端支持此属性，但无UI表现,仅限数据交互使用。
                name : { default: '', type: String },
                //边界白线控制
                boundary: { 
                    left : { 
                        //deafult: 0 左侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有左侧边界白线,
                        has: { default: true, type: Boolean } 
                    },
                    right: {
                        //deafult: 0 右侧边界白线的长度，前端支持此属性，但无UI表现,仅限数据交互使用。
                        length: { defualt: 0, type: Number },
                        //deafult: true 是否具有右侧边界白线
                        has: { default: true, type: Boolean } 
                    }
                },
                //deafult: true 是否具有人行班马线
                pedestrian: { default: true, type: Boolean },
                //default: true 是否具有人行暂留区
                stayArea: { default: true, type: Boolean },
                //default: true, 是否具有暂留区斑马线
                stayPedestrian: { default: true, type: Boolean },
                //default: true 是否具有机动车停止线
                stopLine: { default: true, type: Boolean },
                //车道,自右向左绘制(顺时针)
                Lane : { default: [], type: Array },
                //车道中的标牌
                flagList: { default: [], type: Array },
                type: Object
            },
            RoadWidth : {
                default: 500,
                type: Number
            },
            Active : {
                default: 0,
                type: Number
            }
        },
        data : function() {
            return {
                uuid : utils.uuid()
            }
        },
        components: {
            "Lane" : Lane
        },
        computed: {
            getTopTextIntersection: function() {
                var me = this;
                var a = utils.calcRadiusAnyPoint(me.getTopIntersection.x, me.getTopIntersection.y, me.RoadWidth + 20, -180);
                return utils.calcRadiusAnyPoint(a.x, a.y, 180, -90);
            },
            getRightTextIntersection: function() {
                var me = this;
                var a = utils.calcRadiusAnyPoint(me.getTopIntersection.x, me.getTopIntersection.y, 500, -45);
                return utils.calcRadiusAnyPoint(a.x, a.y, 20, -135);
            },
            getLeftTextIntersection: function() {
                var me = this;
                var a = utils.calcRadiusAnyPoint(me.getCrossIntersection.x, me.getCrossIntersection.y, 500, 45);
                return utils.calcRadiusAnyPoint(a.x, a.y, 20, -45);
            },
            getBottomTextIntersection: function() {
                var me = this;
                var a = utils.calcRadiusAnyPoint(me.getBottomIntersection.x, me.getBottomIntersection.y, me.RoadWidth + 40, 180);
                return utils.calcRadiusAnyPoint(a.x, a.y, 180, 90);
            },
            getCenterIntersection: function() {
                var me = this;
                return { x : 1920 / 2, y : 1080 / 2 };
            },
            getTopActiveRect: function() {
                var me = this;
                return utils.calcRadiusAnyPoint(me.getTopIntersection.x, me.getTopIntersection.y, 0, 0);
            },
            getLeftActiveRect: function() {
                var me = this;
                return utils.calcRadiusAnyPoint(me.getCrossIntersection.x, me.getCrossIntersection.y, 10, 45);
            },
            getRightActiveRect: function() {
                var me = this;
                return utils.calcRadiusAnyPoint(me.getBottomIntersection.x, me.getBottomIntersection.y, 10, 135);
            },
            getBottomActiveRect: function() {
                var me = this;
                return utils.calcRadiusAnyPoint(me.getBottomIntersection.x, me.getBottomIntersection.y, me.RoadWidth + 10, 180);
            },
            getCrossIntersection: function() {
                var me = this;
                var len = utils.calcTriangleSubtenseLen(me.RoadWidth / 2, 90);
                return { x : 1920 / 2 + len, y : 1080 / 2 };
            },
            getTopIntersection: function() {
                var me = this;
                var v = me.getCrossIntersection;
                return utils.calcRadiusAnyPoint(v.x, v.y, me.RoadWidth, -135);
            },
            getBottomIntersection: function() {
                var me = this;
                var v = me.getCrossIntersection;
                return utils.calcRadiusAnyPoint(v.x, v.y, me.RoadWidth, 135);
            },
            calcRoadTopNotch: function() {
                var me = this;
                var v = me.getTopIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 100, -44.5);
                var cv = utils.calcRadiusAnyPoint(v.x, v.y, 50, -67.5);
                return "M${v1x},${v1y} S${cvx},${cvy} ${v2x},${v2y} L${vx},${vy} ${v1x},${v1y} z"
                    .replace(/(\$\{v1x\})/g, v.x).replace(/(\$\{v1y\})/g, v.y - 100).replace(/(\$\{v2x\})/g, v1.x).replace(/(\$\{v2y\})/g, v1.y)
                    .replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{cvx\})/g, cv.x).replace(/(\$\{cvy\})/g, cv.y);
            },
            calcRoadRightNotch: function() {
                var me = this;
                var v = me.getCrossIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 100, -45);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, 100, 45);
                var cv = utils.calcRadiusAnyPoint(v.x, v.y, 50, 0);
                return "M${v1x},${v1y} S${cvx},${cvy} ${v2x},${v2y} L${vx},${vy} ${v1x},${v1y} z"
                    .replace(/(\$\{v1x\})/g, v1.x).replace(/(\$\{v1y\})/g, v1.y).replace(/(\$\{v2x\})/g, v2.x).replace(/(\$\{v2y\})/g, v2.y)
                    .replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{cvx\})/g, cv.x).replace(/(\$\{cvy\})/g, cv.y);
            },
            calcRoadBottomNotch: function() {
                var me = this;
                var v = me.getBottomIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 100, 44.5);
                var cv = utils.calcRadiusAnyPoint(v.x, v.y, 50, 67.5);
                return "M${v1x},${v1y} S${cvx},${cvy} ${v2x},${v2y} L${vx},${vy} ${v1x},${v1y} z"
                    .replace(/(\$\{v1x\})/g, v1.x).replace(/(\$\{v1y\})/g, v1.y).replace(/(\$\{v2x\})/g, v.x).replace(/(\$\{v2y\})/g, v.y + 100)
                    .replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y).replace(/(\$\{cvx\})/g, cv.x).replace(/(\$\{cvy\})/g, cv.y);
            },
            calcTopRoadBoundary: function() {
                var me = this;
                var v = me.getTopIntersection;
                var v1 = me.getCenterIntersection;
                var d1 = utils.calcRadiusAnyPoint(v.x, v.y, 100, -45);
                var cv = utils.calcRadiusAnyPoint(v.x, v.y, 50, -67.5);
                var r = "M${vx},${vy} V-499999.5".replace(/(\$\{vx\})/g, v1.x - me.RoadWidth).replace(/(\$\{vy\})/g, v1.y)
                var l = "M${d1x},${d1y} S${cvx},${cvy} ${vx},${vy} L${ex},${ey}"
                    .replace(/(\$\{d1x\})/g, d1.x).replace(/(\$\{d1y\})/g, d1.y).replace(/(\$\{cvx\})/g, cv.x).replace(/(\$\{cvy\})/g, cv.y)
                    .replace(/(\$\{vx\})/g, v.x).replace(/(\$\{vy\})/g, v.y - 100).replace(/(\$\{ex\})/g, v.x).replace(/(\$\{ey\})/g, -499999.5);
                
                var ov = utils.calcRadiusAnyPoint(v.x, v.y, 2.5, -67.5);
                var od1 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, -45);
                var ocv = utils.calcRadiusAnyPoint(ov.x, ov.y, 50, -67.5);
                var out = "M${d1x},${d1y} S${cvx},${cvy} ${vx},${vy} L${ex},${ey}"
                    .replace(/(\$\{d1x\})/g, od1.x).replace(/(\$\{d1y\})/g, od1.y).replace(/(\$\{cvx\})/g, ocv.x).replace(/(\$\{cvy\})/g, ocv.y)
                    .replace(/(\$\{vx\})/g, ov.x + 2.5).replace(/(\$\{vy\})/g, ov.y - 100).replace(/(\$\{ex\})/g, ov.x).replace(/(\$\{ey\})/g, -499999.5);
                return { right: r, left: l, out: out };
            },
            calcRightRoadBoundary: function() {
                var me = this;
                var v1 = me.getTopIntersection;
                var v2 = me.getCrossIntersection;
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 50, -67.5);
                var d1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 100, -45);
                var d2 = utils.calcRadiusAnyPoint(v1.x, v1.y, 499999.5, -45);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, 50, 0);
                var d3 = utils.calcRadiusAnyPoint(v2.x, v2.y, 100, 45);
                var d4 = utils.calcRadiusAnyPoint(v2.x, v2.y, 100, -45);
                var d5 = utils.calcRadiusAnyPoint(v2.x, v2.y, 499999.5, -45);

                var r = "M${vx},${vy} S${cvx},${cvy} ${d1x},${d1y} L${d2x},${d2y}"
                    .replace(/(\$\{vx\})/g, v1.x).replace(/(\$\{vy\})/g, v1.y - 100).replace(/(\$\{cvx\})/g, r1.x).replace(/(\$\{cvy\})/g, r1.y)
                    .replace(/(\$\{d1x\})/g, d1.x).replace(/(\$\{d1y\})/g, d1.y).replace(/(\$\{d2x\})/g, d2.x).replace(/(\$\{d2y\})/g, d2.y);
                var l = "M${d1x},${d1y} S${cvx},${cvy} ${d2x},${d2y} L${d3x},${d3y}"
                    .replace(/(\$\{d1x\})/g, d3.x).replace(/(\$\{d1y\})/g, d3.y).replace(/(\$\{d2x\})/g, d4.x).replace(/(\$\{d2y\})/g, d4.y)
                    .replace(/(\$\{d3x\})/g, d5.x).replace(/(\$\{d3y\})/g, d5.y).replace(/(\$\{cvx\})/g, r2.x).replace(/(\$\{cvy\})/g, r2.y);
                
                var ov = utils.calcRadiusAnyPoint(v1.x, v1.y, 2.5, -67.5);
                var or1 = utils.calcRadiusAnyPoint(ov.x, ov.y, 50, -67.5);
                var od1 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, -45);
                var od2 = utils.calcRadiusAnyPoint(ov.x, ov.y, 499999.5, -45);
                var or = "M${vx},${vy} S${cvx},${cvy} ${d1x},${d1y} L${d2x},${d2y}"
                    .replace(/(\$\{vx\})/g, ov.x).replace(/(\$\{vy\})/g, ov.y - 100).replace(/(\$\{cvx\})/g, or1.x).replace(/(\$\{cvy\})/g, or1.y)
                    .replace(/(\$\{d1x\})/g, od1.x).replace(/(\$\{d1y\})/g, od1.y).replace(/(\$\{d2x\})/g, od2.x).replace(/(\$\{d2y\})/g, od2.y);

                ov = utils.calcRadiusAnyPoint(v2.x, v2.y, 2.5, 0);
                var or2 = utils.calcRadiusAnyPoint(ov.x, ov.y, 50, 0);
                var od3 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, 45);
                var od4 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, -45);
                var od5 = utils.calcRadiusAnyPoint(ov.x, ov.y, 499999.5, -45);
                var ol = "M${d1x},${d1y} S${cvx},${cvy} ${d2x},${d2y} L${d3x},${d3y}"
                .replace(/(\$\{d1x\})/g, od3.x).replace(/(\$\{d1y\})/g, od3.y).replace(/(\$\{d2x\})/g, od4.x).replace(/(\$\{d2y\})/g, od4.y)
                .replace(/(\$\{d3x\})/g, od5.x).replace(/(\$\{d3y\})/g, od5.y).replace(/(\$\{cvx\})/g, or2.x).replace(/(\$\{cvy\})/g, or2.y);
                
                return { right: r, left: l, outRight: or, outLeft: ol };
            },
            calcLeftRoadBoudary: function() {
                var me = this;
                var v1 = me.getCrossIntersection;
                var v2 = me.getBottomIntersection;

                var d1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 100, -45);
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, 50, 0);
                var d2 = utils.calcRadiusAnyPoint(v1.x, v1.y, 100, 45);
                var d3 = utils.calcRadiusAnyPoint(v1.x, v1.y, 499999.5, 45);
                var r = "M${d1x},${d1y} S${cvx},${cvy} ${d2x},${d2y} L${d3x},${d3y}"
                    .replace(/(\$\{d1x\})/g, d1.x).replace(/(\$\{d1y\})/g, d1.y).replace(/(\$\{d2x\})/g, d2.x).replace(/(\$\{d2y\})/g, d2.y)
                    .replace(/(\$\{d3x\})/g, d3.x).replace(/(\$\{d3y\})/g, d3.y).replace(/(\$\{cvx\})/g, r1.x).replace(/(\$\{cvy\})/g, r1.y);

                var ov = utils.calcRadiusAnyPoint(v1.x, v1.y, 2.5, 0);
                var od1 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, -45);
                var or1 = utils.calcRadiusAnyPoint(ov.x, ov.y, 50, 0);
                var od2 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, 45);
                var od3 = utils.calcRadiusAnyPoint(ov.x, ov.y, 499999.5, 45);
                var or = "M${d1x},${d1y} S${cvx},${cvy} ${d2x},${d2y} L${d3x},${d3y}"
                    .replace(/(\$\{d1x\})/g, od1.x).replace(/(\$\{d1y\})/g, od1.y).replace(/(\$\{d2x\})/g, od2.x).replace(/(\$\{d2y\})/g, od2.y)
                    .replace(/(\$\{d3x\})/g, od3.x).replace(/(\$\{d3y\})/g, od3.y).replace(/(\$\{cvx\})/g, or1.x).replace(/(\$\{cvy\})/g, or1.y);

                var d4 = utils.calcRadiusAnyPoint(v2.x, v2.y, 100, 90);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, 50, 67.5);
                var d5 = utils.calcRadiusAnyPoint(v2.x, v2.y, 100, 45);
                var d6 = utils.calcRadiusAnyPoint(v2.x, v2.y, 499999.5, 45);
                var l = "M${d4x},${d4y} S${cvx},${cvy} ${d5x},${d5y} L${d6x},${d6y}"
                    .replace(/(\$\{d4x\})/g, d4.x).replace(/(\$\{d4y\})/g, d4.y).replace(/(\$\{d5x\})/g, d5.x).replace(/(\$\{d5y\})/g, d5.y)
                    .replace(/(\$\{d6x\})/g, d6.x).replace(/(\$\{d6y\})/g, d6.y).replace(/(\$\{cvx\})/g, r2.x).replace(/(\$\{cvy\})/g, r2.y);

                ov = utils.calcRadiusAnyPoint(v2.x, v2.y, 2.5, 67.5);
                var od4 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, 90);
                var or2 = utils.calcRadiusAnyPoint(ov.x, ov.y, 50, 67.5);
                var od5 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, 45);
                var od6 = utils.calcRadiusAnyPoint(ov.x, ov.y, 499999.5, 45);
                var ol = "M${d4x},${d4y} S${cvx},${cvy} ${d5x},${d5y} L${d6x},${d6y}"
                    .replace(/(\$\{d4x\})/g, od4.x + 2.5).replace(/(\$\{d4y\})/g, od4.y).replace(/(\$\{d5x\})/g, od5.x).replace(/(\$\{d5y\})/g, od5.y)
                    .replace(/(\$\{d6x\})/g, od6.x).replace(/(\$\{d6y\})/g, od6.y).replace(/(\$\{cvx\})/g, or2.x).replace(/(\$\{cvy\})/g, or2.y);

                return { left: l, right : r, outRight: or, outLeft: ol };
            },
            calcBottomRoadBoudary: function() {
                var me = this;
                var v1 = me.getCenterIntersection;
                var v2 = me.getBottomIntersection;

                var l = "M${vx},${vy} V499999.5".replace(/(\$\{vx\})/g, v1.x - me.RoadWidth).replace(/(\$\{vy\})/g, v1.y);
                var d1 = utils.calcRadiusAnyPoint(v2.x, v2.y, 100, 45);
                var r1 = utils.calcRadiusAnyPoint(v2.x, v2.y, 50, 67.5);
                var d2 = utils.calcRadiusAnyPoint(v2.x, v2.y, 100, 90);
                var d3 = utils.calcRadiusAnyPoint(v2.x, v2.y, 499999.5, 90);
                var r = "M${d1x},${d1y} S${cvx},${cvy} ${d2x},${d2y} L${d3x},${d3y}"
                    .replace(/(\$\{d1x\})/g, d1.x).replace(/(\$\{d1y\})/g, d1.y).replace(/(\$\{d2x\})/g, d2.x).replace(/(\$\{d2y\})/g, d2.y)
                    .replace(/(\$\{d3x\})/g, d3.x).replace(/(\$\{d3y\})/g, d3.y).replace(/(\$\{cvx\})/g, r1.x).replace(/(\$\{cvy\})/g, r1.y);
                
                var ov = utils.calcRadiusAnyPoint(v2.x, v2.y, 2.5, 67.5);
                var od1 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, 45);
                var or1 = utils.calcRadiusAnyPoint(ov.x, ov.y, 50, 67.5);
                var od2 = utils.calcRadiusAnyPoint(ov.x, ov.y, 100, 90);
                var od3 = utils.calcRadiusAnyPoint(ov.x, ov.y, 499999.5, 90);
                var or = "M${d1x},${d1y} S${cvx},${cvy} ${d2x},${d2y} L${d3x},${d3y}"
                    .replace(/(\$\{d1x\})/g, od1.x).replace(/(\$\{d1y\})/g, od1.y).replace(/(\$\{d2x\})/g, od2.x +3).replace(/(\$\{d2y\})/g, od2.y)
                    .replace(/(\$\{d3x\})/g, od3.x + 3).replace(/(\$\{d3y\})/g, od3.y).replace(/(\$\{cvx\})/g, or1.x).replace(/(\$\{cvy\})/g, or1.y);
                return { left: l, right: r, outRight: or }
            },
            calcRoadTopLaneWidth: function() {
                var me = this;
                if(me.RoadTop.Lane && me.RoadTop.Lane.length) {
                    return me.RoadWidth / me.RoadTop.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadRightLaneWidth: function() {
                var me = this;
                if(me.RoadRight.Lane && me.RoadRight.Lane.length) {
                    return me.RoadWidth / me.RoadRight.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadBottomLaneWidth: function() {
                var me = this;
                if(me.RoadBottom.Lane && me.RoadBottom.Lane.length) {
                    return me.RoadWidth / me.RoadBottom.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadLeftLaneWidth: function() {
                var me = this;
                if(me.RoadLeft.Lane && me.RoadLeft.Lane.length) {
                    return me.RoadWidth / me.RoadLeft.Lane.length;
                }
                return me.RoadWidth;
            },
            calcRoadTopStopLine: function() {
                var me = this;
                var v = me.getTopIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, -90);
                var v2 = { x : v1.x - me.RoadWidth, y : v1.y };
                var lane = me.RoadTop.Lane && me.RoadTop.Lane.length || 0;
                var after = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : 0;
                var w = lane <= 2 ? me.RoadWidth - after : ((me.RoadTop.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - after;
                return { p1: v2, p2 : { x: v2.x + w, y : v2.y } };
            },
            calcRoadRightStopLine: function() {
                var me = this;
                var v = me.getTopIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, -45);
                var lane = me.RoadRight.Lane && me.RoadRight.Lane.length || 0;
                var before = !me.RoadRight.stayArea ? 0 : lane <= 2 ? 50 : me.calcRoadRightLaneWidth;
                var after = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.calcRoadRightLaneWidth;
                var w = lane <= 2 ? me.RoadWidth - before - after : ((me.RoadRight.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var p1 = utils.calcRadiusAnyPoint(v1.x, v1.y, before, 45);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, w, 45);
                return { p1: p1, p2: p2 }
            },
            calcRoadLeftStopLine: function() {
                var me = this;
                var v = me.getCrossIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, 45);
                var lane = me.RoadLeft.Lane && me.RoadLeft.Lane.length || 0;
                var before = !me.RoadLeft.stayArea ? 0 : lane <= 2 ? 50 : me.calcRoadLeftLaneWidth;
                var after = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.calcRoadLeftLaneWidth;
                var w = lane <= 2 ? me.RoadWidth - before - after : ((me.RoadLeft.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                var p1 = utils.calcRadiusAnyPoint(v1.x, v1.y, before, 135);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, w, 135);
                return { p1: p1, p2: p2 }
            },
            calcRoadBottomStopLine: function() {
                var me = this;
                var v = me.getBottomIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, 90);
                var lane = me.RoadBottom.Lane && me.RoadBottom.Lane.length || 0;
                var before = !me.RoadBottom.stayArea ? 0 : lane <= 2 ? 50 : me.calcRoadBottomLaneWidth;
                var w = lane <= 2 ? me.RoadWidth - before : ((me.RoadBottom.Lane.filter(function(it) { return !it.reverse }).length || 0) * (me.RoadWidth / lane)) - before;
                return { p1: { x : v1.x - before, y: v1.y }, p2 : { x : v1.x - before - w, y : v1.y } }
            },
            calcPedestrianLength: function() {
                var me = this;
                var topLane = me.RoadTop.Lane.length || 0;
                var rightLane = me.RoadRight.Lane.length || 0;
                var leftLane = me.RoadLeft.Lane.length || 0;
                var bottomLane = me.RoadBottom.Lane.length || 0;
                var v = me.getTopIntersection;
                var v1 = me.getCrossIntersection;
                var v2 = me.getBottomIntersection;
                var vt = utils.calcRadiusAnyPoint(v.x, v.y, 80, -90);
                var vr = utils.calcRadiusAnyPoint(v.x, v.y, 80, -45);
                var vl = utils.calcRadiusAnyPoint(v1.x, v1.y, 80, 45);
                var vb = utils.calcRadiusAnyPoint(v2.x, v2.y, 80, 90);
                var before_td = !me.RoadRight.stayArea ? 0 : topLane - 2 <= 0 ? 50 : (me.RoadWidth / topLane);
                var before_rd = !me.RoadRight.stayArea ? 0 : rightLane - 2 <= 0 ? 50 : me.RoadWidth / rightLane;
                var after_rd = !me.RoadLeft.stayArea ? 0 : rightLane - 2 <= 0 ? 50 : me.RoadWidth / rightLane;
                var before_ld = !me.RoadLeft.stayArea ? 0 : leftLane - 2 <= 0 ? 50 : me.RoadWidth / leftLane;
                var after_ld = !me.RoadBottom.stayArea ? 0 : leftLane - 2 <= 0 ? 50 : me.RoadWidth / leftLane;
                var before_bd = !me.RoadBottom.stayArea ? 0 : bottomLane - 2 <= 0 ? 50 : (me.RoadWidth / bottomLane);
                return {
                    top : {
                        p1 : { x : vt.x - before_td, y : vt.y },
                        p2 : { x : topLane - 2 <= 0 ? vt.x - me.RoadWidth : vt.x - me.RoadWidth, y : vt.y }
                    },
                    right: {
                        p1 : utils.calcRadiusAnyPoint(vr.x, vr.y, before_rd, 45),
                        p2 : utils.calcRadiusAnyPoint(vr.x, vr.y, me.RoadWidth - after_rd, 45)
                    },
                    left : {
                        p1 : utils.calcRadiusAnyPoint(vl.x, vl.y, before_ld, 135),
                        p2 : utils.calcRadiusAnyPoint(vl.x, vl.y, me.RoadWidth - after_ld, 135)
                    },
                    bottom: {
                        p1 : { x : vb.x - before_bd, y : vb.y },
                        p2 : { x : bottomLane - 2 <= 0 ? vb.x - me.RoadWidth : vb.x - me.RoadWidth, y : vb.y }
                    }
                }
            },
            calcRoadTopStay: function() {
                var me = this;
                var v = me.getTopIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, -90);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, 120, -45);
                var left_lane = me.RoadTop.Lane && me.RoadTop.Lane.length || 0;
                var right_lane = me.RoadRight.Lane && me.RoadRight.Lane.length || 0;
                var ld = left_lane <= 2 ? 50 : me.RoadWidth / left_lane;
                var rd = right_lane <= 2 ? 50 : me.RoadWidth / right_lane;
                
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, ld, 180);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, rd, 45);
                var e1 = utils.calcRadiusAnyPoint(r1.x, r1.y, 9999, 90);
                var e2 = utils.calcRadiusAnyPoint(r2.x, r2.y, 9999, 135);
                var c = utils.calcLineIntersection(r1, e1, r2, e2);
                var dd = utils.calcPointDist(r1, c);
                var cd = utils.calcRadiusAnyPoint(c.x, c.y, dd / 1.5, -45);
                var d = utils.calcPointDist(r1, c);
                var s = utils.calcRadiusAnyPoint(c.x, c.y, d / 5, -67.5);
                return "M${d1x},${d1y} L${q1x},${q1y} S${vx},${vy} ${cdx},${cdy} L${d2x},${d2y} S${sx},${sy} ${d1x},${d1y} z"
                    .replace(/(\$\{d1x\})/g, r1.x).replace(/(\$\{d1y\})/g, r1.y).replace(/(\$\{q1x\})/g, r1.x).replace(/(\$\{q1y\})/g, c.y - dd / 1.5)
                    .replace(/(\$\{vx\})/g, c.x).replace(/(\$\{vy\})/g, c.y).replace(/(\$\{cdx\})/g, cd.x).replace(/(\$\{cdy\})/g, cd.y)
                    .replace(/(\$\{d2x\})/g, r2.x).replace(/(\$\{d2y\})/g, r2.y).replace(/(\$\{sx\})/g, s.x).replace(/(\$\{sy\})/g, s.y);
            },
            calcRoadRightStay: function() {
                var me = this;
                var v = me.getCrossIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, -45);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, 120, 45);
                var left_lane = me.RoadRight.Lane && me.RoadRight.Lane.length || 0;
                var right_lane = me.RoadLeft.Lane && me.RoadLeft.Lane.length || 0;
                var ld = left_lane <= 2 ? 50 : me.RoadWidth / left_lane;
                var rd = right_lane <= 2 ? 50 : me.RoadWidth / right_lane;

                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, ld, -135);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, rd, 135);
                var e1 = utils.calcRadiusAnyPoint(r1.x, r1.y, 9999, 135);
                var e2 = utils.calcRadiusAnyPoint(r2.x, r2.y, 9999, -135);
                var c = utils.calcLineIntersection(r1, e1, r2, e2);
                var rc = utils.calcRadiusAnyPoint(c.x, c.y, 10, -45);
                var lc = utils.calcRadiusAnyPoint(c.x, c.y, 10, 45);
                var s = utils.calcRadiusAnyPoint(c.x, c.y, 30, 0);
                return "M${d1x},${d1y} L${q1x},${q1y} S${vx},${vy} ${q2x},${q2y} L${d2x},${d2y} S${sx},${sy} ${d1x},${d1y} z"
                    .replace(/(\$\{d1x\})/g, r1.x).replace(/(\$\{d1y\})/g, r1.y).replace(/(\$\{q1x\})/g, rc.x).replace(/(\$\{q1y\})/g, rc.y)
                    .replace(/(\$\{vx\})/g, c.x).replace(/(\$\{vy\})/g, c.y).replace(/(\$\{q2x\})/g, lc.x).replace(/(\$\{q2y\})/g, lc.y)
                    .replace(/(\$\{d2x\})/g, r2.x).replace(/(\$\{d2y\})/g, r2.y).replace(/(\$\{sx\})/g, s.x).replace(/(\$\{sy\})/g, s.y);
            },
            calcRoadLeftStay: function() {
                var me = this;
                var v = me.getBottomIntersection;
                var v1 = utils.calcRadiusAnyPoint(v.x, v.y, 120, 45);
                var v2 = utils.calcRadiusAnyPoint(v.x, v.y, 120, 90);
                var left_lane = me.RoadLeft.Lane && me.RoadLeft.Lane.length || 0;
                var right_lane = me.RoadBottom.Lane && me.RoadBottom.Lane.length || 0;
                var ld = left_lane <= 2 ? 50 : me.RoadWidth / left_lane;
                var rd = right_lane <= 2 ? 50 : me.RoadWidth / right_lane;
                
                var r1 = utils.calcRadiusAnyPoint(v1.x, v1.y, ld, -45);
                var r2 = utils.calcRadiusAnyPoint(v2.x, v2.y, rd, 180);
                var e1 = utils.calcRadiusAnyPoint(r1.x, r1.y, 9999, -135);
                var e2 = utils.calcRadiusAnyPoint(r2.x, r2.y, 9999, -90);
                var c = utils.calcLineIntersection(r1, e1, r2, e2);
                var dd = utils.calcPointDist(r1, c);
                var cd = utils.calcRadiusAnyPoint(c.x, c.y, dd / 1.5, 45);
                var d = utils.calcPointDist(r1, c);
                var s = utils.calcRadiusAnyPoint(c.x, c.y, d / 5, 67.5);
                return "M${d1x},${d1y} L${cdx},${cdy} S${vx},${vy} ${q1x},${q1y} L${d2x},${d2y} S${sx},${sy} ${d1x},${d1y} z"
                    .replace(/(\$\{d1x\})/g, r1.x).replace(/(\$\{d1y\})/g, r1.y).replace(/(\$\{q1x\})/g, c.x).replace(/(\$\{q1y\})/g, c.y + dd / 1.5)
                    .replace(/(\$\{vx\})/g, c.x).replace(/(\$\{vy\})/g, c.y).replace(/(\$\{cdx\})/g, cd.x).replace(/(\$\{cdy\})/g, cd.y)
                    .replace(/(\$\{d2x\})/g, r2.x).replace(/(\$\{d2y\})/g, r2.y).replace(/(\$\{sx\})/g, s.x).replace(/(\$\{sy\})/g, s.y);
            },
            calcRightPedestrian: function() {
                var me = this;
                var v = me.getTopIntersection;
                var tLane = me.RoadTop.Lane && me.RoadTop.Lane.length || 0;
                var rLane = me.RoadTop.Lane && me.RoadRight.Lane.length || 0;
                var td = tLane <= 2 ? 50 : me.RoadWidth / tLane;
                var rd = rLane <= 2 ? 50 : me.RoadWidth / rLane;
                var w = Math.sqrt(td * td + rd * rd);
                var p1 = utils.calcRadiusAnyPoint(v.x, v.y, 75, -67.5);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, w ,112.5);

                return { p1 : p1, p2 : p2 };
            },
            calcLeftPedestrian: function() {
                var me = this;
                var v = me.getCrossIntersection;
                var rLane = me.RoadRight.Lane && me.RoadRight.Lane.length || 0;
                var lLane = me.RoadLeft.Lane && me.RoadLeft.Lane.length || 0;
                var rd = rLane <= 2 ? 50 : me.RoadWidth / rLane;
                var ld = lLane <= 2 ? 50 : me.RoadWidth / lLane;
                var w = Math.sqrt(ld * ld + rd * rd);
                var p1 = utils.calcRadiusAnyPoint(v.x, v.y, 60, 0);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, w ,180);

                return { p1 : p1, p2 : p2 };
            },
            calcBottomPedestrian: function() {
                var me = this;
                var v = me.getBottomIntersection;
                var lLane = me.RoadLeft.Lane && me.RoadLeft.Lane.length || 0;
                var bLane = me.RoadBottom.Lane && me.RoadBottom.Lane.length || 0;
                var ld = lLane <= 2 ? 50 : me.RoadWidth / lLane;
                var bd = bLane <= 2 ? 50 : me.RoadWidth / bLane;
                var w = Math.sqrt(ld * ld + bd * bd);
                var p1 = utils.calcRadiusAnyPoint(v.x, v.y, 75, 67.5);
                var p2 = utils.calcRadiusAnyPoint(p1.x, p1.y, w, 247.5);

                return { p1 : p1, p2 : p2 };
            },
            calcRoadTopForUpwardFlag: function () {
                var me = this;
                if (!me.RoadTop.flagList || !me.RoadTop.flagList.length) {
                    return [];
                }
                return me.RoadTop.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadTopForDownFlag: function () {
                var me = this;
                if (!me.RoadTop.flagList || !me.RoadTop.flagList.length) {
                    return [];
                }
                return me.RoadTop.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadRightForUpwardFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadRightForDownFlag: function () {
                var me = this;
                if (!me.RoadRight.flagList || !me.RoadRight.flagList.length) {
                    return [];
                }
                return me.RoadRight.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadBottomForUpwardFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadBottomForDownFlag: function () {
                var me = this;
                if (!me.RoadBottom.flagList || !me.RoadBottom.flagList.length) {
                    return [];
                }
                return me.RoadBottom.flagList.filter(function (it) { return !it.isUpward });
            },
            calcRoadLeftForUpwardFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return it.isUpward });
            },
            calcRoadLeftForDownFlag: function () {
                var me = this;
                if (!me.RoadLeft.flagList || !me.RoadLeft.flagList.length) {
                    return [];
                }
                return me.RoadLeft.flagList.filter(function (it) { return !it.isUpward });
            }
        },
        methods: {
            calcRoadTopFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                var v = me.getTopIntersection;
                if (flag.isUpward) {
                    var d = utils.calcRadiusAnyPoint(v.x, v.y,  me.RoadWidth + 140 + r * 90, 180);
                    return utils.calcRadiusAnyPoint(d.x, d.y, 180 + i * 120, -90);
                }

                var d = utils.calcRadiusAnyPoint(v.x, v.y,  20 + r * 90, 0);
                return utils.calcRadiusAnyPoint(d.x, d.y, 180 + i * 120, -90);
            },
            calcRoadRightFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                var v = me.getCrossIntersection;
                if (flag.isUpward) {
                    var d = utils.calcRadiusAnyPoint(v.x, v.y,  me.RoadWidth + 140 + r * 90, -135);
                    return utils.calcRadiusAnyPoint(d.x, d.y, 500 + i * 120, -45);
                }

                var d = utils.calcRadiusAnyPoint(v.x, v.y,  20 + r * 90, 45);
                return utils.calcRadiusAnyPoint(d.x, d.y, 500 + i * 120, -45);
            },
            calcRoadLeftFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                var v = me.getCrossIntersection;
                if (flag.isUpward) {
                    var d = utils.calcRadiusAnyPoint(v.x, v.y,  140 + r * 90, -45);
                    return utils.calcRadiusAnyPoint(d.x, d.y, 500 + i * 120, 45);
                }
                
                var d = utils.calcRadiusAnyPoint(v.x, v.y,  me.RoadWidth + 20 + r * 90, 135);
                return utils.calcRadiusAnyPoint(d.x, d.y, 500 + i * 120, 45);
            },
            calcRoadBottomFlagPosition: function (flag, n) {
                var me = this;
                var i = n % 10;
                var r = Math.floor(n / 10);
                var v = me.getBottomIntersection;
                if (flag.isUpward) {
                    var d = utils.calcRadiusAnyPoint(v.x, v.y,  100 + r * 90, 0);
                    return utils.calcRadiusAnyPoint(d.x, d.y, 180 + i * 120, 90);
                }
                
                var d = utils.calcRadiusAnyPoint(v.x, v.y,  me.RoadWidth + 60 + r * 90, 180);
                return utils.calcRadiusAnyPoint(d.x, d.y, 180 + i * 120, 90);
            },
            crossTopMoveTo: function(n) {
                var me = this;
                var v = me.getTopIntersection;
                var left = v.x - me.RoadWidth;
                var top = v.y - 120;
                var width = me.calcRoadTopLaneWidth;
                return { x : (n + 1) * width + left, y: top };
            },
            crossRightMoveTo: function(n) {
                var me = this;
                var v1 = me.getTopIntersection;
                var v = utils.calcRadiusAnyPoint(v1.x, v1.y, 120, -45);
                var diff = (n + 1) * me.calcRoadRightLaneWidth;
                return utils.calcRadiusAnyPoint(v.x, v.y, diff, 45);
            },
            crossLeftMoveTo: function(n) {
                var me = this;
                var v1 = me.getCrossIntersection;
                var v = utils.calcRadiusAnyPoint(v1.x, v1.y, 120, 45);
                var diff = (n + 1) * me.calcRoadLeftLaneWidth;
                return utils.calcRadiusAnyPoint(v.x, v.y, diff, 135);
            },
            crossBottomMoveTo: function(n) {
                var me = this;
                var v1 = me.getBottomIntersection;
                var v = utils.calcRadiusAnyPoint(v1.x, v1.y, 120, 90);
                var diff = (n + 1) * me.calcRoadBottomLaneWidth;
                return utils.calcRadiusAnyPoint(v.x, v.y, diff, 180);
            },
            onRoadPedestrianClick: function(e, no, isStay) {
                //十字路口行人斑马线的点击事件
                this.$parent.$emit('cross-road-pedestrian-click', e, no, isStay);
            },
			onRoadFlagClick: function(e, no, flag) {
                this.$parent.$emit('cross-road-flag-click', e, no, flag);
			},
            onRoadStopLineClick: function(e, no) {
                //机动车停止线点击事件
                this.$parent.$emit("cross-road-stopline-click", e, no);
            },
            onRoadBoundaryClick: function(e, no, isRight) {
                //十字路口公路边界线的点击事件
                this.$parent.$emit('cross-road-boundary-click', e, no, isRight ? 'right' : 'left');
            },
            onRoadLanePavementClick: function(e, no, lane) {
                //机动车道路点击事件
                this.$parent.$emit("cross-road-pavement-click", e, no, lane);
            },
            onRoadLaneSolidLineClick: function(e, no, lane) {
                //机动车道路白色实线点击事件
                this.$parent.$emit("cross-solid-line-click", e, no, lane);
            },
            onRoadLaneDottedLineClick: function(e, no, lane) {
                //机动车道路白色虚线点击事件
                this.$parent.$emit("cross-dotted-line-click", e, no, lane);
            },
            onRoadParterreBoundaryClick: function(e, no, lane) {
                //花坛边界线点击事件
                this.$parent.$emit("cross-parterre-boundary-line-click", e, no, lane);
            },
            onRoadLaneYDottedLineClick: function() {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-dotted-line-click", e, no, lane);
            },
            onRoadLaneYSolidLineClick: function(e, no, lane) {
                //机动车黄色实线点击事件
                this.$parent.$emit("cross-y-solid-line-click", e, no, lane);
            },
            onRoadLaneYDoubleSolidLineClick: function(e, no, lane, side) {
                //机动车双黄色实线点击事件
                this.$parent.$emit("cross-y-double-solid-line-click", e, no, lane, side);
            },
            onRoadLaneYDoubleDottedLineClick: function(e, no, lane, side) {
                //机动车黄色虚线点击事件
                this.$parent.$emit("cross-y-double-dashed-line-click", e, no, lane, side);
            },
            onRoadLaneYSolidAreaClick: function(e, no, lane) {
                //机动车黄色禁停区域点击事件
                this.$parent.$emit("cross-y-area-click", e, no, lane);
            },
            onRoadLaneParterreClick: function(e, no, lane) {
                //花坛绿色区域点击事件
                this.$parent.$emit("cross-parterre-click", e, no, lane);
            },
            onRoadLaneParterreLineClick: function(e, no, lane, side) {
                //花坛内部白线点击事件
                this.$parent.$emit("cross-parterre-line-click", e, no, lane, side);
            },
            onRoadLaneParterreSafeAreaClick: function(e, no, lane) {
                //安全岛点击事件
                this.$parent.$emit("cross-parterre-safearea-click", e, no, lane);
            },
            onRoadLaneMarkClick: function(e, no, lane, side) {
                //道路路标点击事件
                var me = this;
                var mark = {};
                if(no === 0) {
                    mark = me.RoadTop.Lane[lane].landmark
                }

                if(no === 1) {
                    mark = me.RoadRight.Lane[lane].landmark
                }

                if(no === 2) {
                    mark = me.RoadLeft.Lane[lane].landmark
                }

                if(no === 3) {
                    mark = me.RoadBottom.Lane[lane].landmark
                }

                this.$parent.$emit("cross-lane-mark-click", e, no, lane, side, mark[side].mark);
            },
            onCrossStayAreaClick: function(e, no) {
                //十字路口行人暂留区域点击事件
                this.$parent.$emit('cross-stay-click', e, no, 'right');
            },
			onCancelLaneMarkHighlight: function() {
				var me = this;
				me.RoadTop.Lane = me.RoadTop && me.RoadTop.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadRight.Lane = me.RoadRight && me.RoadRight.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadBottom.Lane = me.RoadBottom && me.RoadBottom.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.RoadLeft.Lane = me.RoadLeft && me.RoadLeft.Lane.map(function(it) {
					return { 
						type: it.type, 
						assist: it.assist, 
						reverse: it.reverse, 
						markright: it.markright, 
						hasBoundary: it.hasBoundary, 
                        hasSafeArea: it.hasSafeArea,
						landmark: it.landmark.map(function(mark) { 
							return { seq: mark.seq , mark: mark.mark, highlight: false } 
						})
					}
				});
				
				me.$emit("update:road-top", me.RoadTop);
				me.$emit("update:road-right", me.RoadRight);
				me.$emit("update:road-bottom", me.RoadBottom);
				me.$emit("update:road-left", me.RoadLeft);
			}
        }
    })

    var render = function() {
        var template = [
            "<svg xmlns='http://wwW.w3.org/2000/svg' class='ivsom-road' version='1.1' viewBox='0 0 1920 1080' preserveAspectRatio='none meet' style='width:100%; height:100%' @mousedown.stop='onEnabledDrag' @mouseup.stop='onDragDrop' @mouseleave.stop='onDragDrop' @mousemove.stop='onDragMove' @mousewheel.prevent.stop='onScaleView'>",
                "<defs>",
                    "<clipPath id='clip'>",
                        "<path d='M-1200,-1200 -1200,2280 3120,2280 3120,-1200 -1200,-1200 z' />",
                    "</clipPath>",
                    "<clipPath id='max-clip'>",
                        "<path d='M-2400,-2400 -2400,3480 4320,3480 4320,-2400 -2400,-2400 z' />",
                    "</clipPath>",
                "</defs>",
                "<cross-road ref='crossRoad' v-if=\"RoadMode === 'A'\" :road-top.sync='Roads[0]' :road-width='RoadWidth' :road-right.sync='Roads[1]' :road-bottom.sync='Roads[2]' :road-left.sync='Roads[3]' :active='active' :style=\"{ transformOrigin: 'center center', transform: getMatrix }\" ></cross-road>",
                "<y-road ref='yRoad' v-if=\"RoadMode === 'Y'\" :road-width='RoadWidth' :road-left.sync='Roads[0]' :road-right.sync='Roads[1]' :road-bottom.sync='Roads[2]' :active='active' :style=\"{ transformOrigin: 'center center', transform: getMatrix }\" ></y-road>",
                "<t-road ref='tRoad' v-if=\"RoadMode === 'T'\" :road-width='RoadWidth' :road-left.sync='Roads[0]' :road-right.sync='Roads[1]' :road-bottom.sync='Roads[2]' :active='active' :style=\"{ transformOrigin: 'center center', transform: getMatrix }\" ></t-road>",
                "<k-road ref='kRoad' v-if=\"RoadMode === 'K'\" :road-top.sync='Roads[0]' :road-width='RoadWidth' :road-right.sync='Roads[1]' :road-left.sync='Roads[2]' :active='active' :road-bottom.sync='Roads[3]'  :style=\"{ transformOrigin: 'center center', transform: getMatrix }\" ></k-road>",
                "<l-road ref='lRoad' v-if=\"RoadMode === 'L'\" :road-top.sync='Roads[0]' :road-width='RoadWidth' :road-right.sync='Roads[1]' :active='active'  :style=\"{ transformOrigin: 'center center', transform: getMatrix }\" ></l-road>",
                "<o-road ref='oRoad' v-if=\"RoadMode === 'O'\" :roads.sync='Roads' :road-width='RoadWidth' :active='active'  :style=\"{ transformOrigin: 'center center', transform: getMatrix }\" ></o-road>",
                "<g>",
                    "<circle cx='60' cy='60' r='40' fill='#fff' stroke='#ececec' stroke-width='2' />",
                    "<path d='M60,25 L50,60 S60,45 70,60 L60,25 z' fill='#ea4748'/>",
                    "<path d='M60,95 L50,60 S60,75 70,60 L60,95 z' fill='#4e79e2'/>",
                    "<path d='M35,60 L45,70 45,50 35,60 z' fill='#ddd'/>",
                    "<path d='M85,60 L75,70 75,50 85,60 z' fill='#ddd'/>",
                    "<text x='60' y='15' font-size='12' text-anchor='middle' fill='#fff'>N</text>",
                    "<text x='10' y='65' font-size='12' text-anchor='middle' fill='#fff'>W</text>",
                    "<text x='110' y='65' font-size='12' text-anchor='middle' fill='#fff'>E</text>",
                    "<text x='60' y='115' font-size='12' text-anchor='middle' fill='#fff'>S</text>",
                "</g>",
            "</svg>"
        ];
        return template.join('');
    }

    var intersection = Vue.extend({
        template: render.apply(this),
        props: {
            Roads : {
                default : function() {
                    return [];
                },
                type: Array
            },
            RoadMode : {
                default : 'A'
            },
            Angle: {
                default : 0,
                type: Number
            },
            RoadWidth : {
                default: 500
            }
        },
        data: function() {
            return {
                move: { isDrag : false, drag : { x : 0, y : 0, offsetX: 0, offsetY: 0 } },
                rotate: { isRotate : false, angle: 0 },
                moveTop: 0,
                moveLeft: 0,
                scale: 0.5,
                active : -1
            }
        },
        components: {
            "CrossRoad" : crossRoads,
            "YRoad" : YRoads,
            "TRoad" : TRoads,
            "KRoad" : KRoads,
            "LRoad" : LRoads,
            "ORoad" : ORoads
        },
        computed:{
            getMatrix: function() {
                var me = this;
                var m1 = (Math.cos(me.Angle * Math.PI / 180) * me.scale).toFixed(6);
                var m2 = (Math.sin(me.Angle * Math.PI / 180) * me.scale).toFixed(6);
                var m3 = (-1 * (Math.sin(me.Angle * Math.PI / 180) * me.scale)).toFixed(6);
                return "matrix("+ m1 +","+ m2 +","+ m3 +","+ m1 +","+ me.moveLeft +","+ me.moveTop +")";
            }
        },
        methods: {
            onEnabledDrag: function(e) {
                var me = this;
                if (e.button === 0) {
                    me.$set(me, "move", { isDrag : true, drag : { x : e.clientX, y : e.clientY, offsetX: me.moveLeft, offsetY: me.moveTop } });
                }

                if (e.button === 1) {
                    var p = { x: 1920 / 2, y : 1080 / 2 };
                    var angle = utils.calcTriangleAngle(p, { x : e.clientX, y : e.clientY })
                    me.$set(me, "rotate", { isRotate : true, angle : angle });
                }
            },
            onDragDrop: function(e) {
                var me = this;
                if (e.button === 0) {
                    me.$set(me, "move", { isDrag : false, drag : { x : 0, y : 0, offsetX: me.moveLeft, offsetY: me.moveTop } });
                }

                if(e.button === 1) {
                    me.$set(me, "rotate", { isRotate : false, angle: 0 });
                }
            },
            onDragMove: function (e) {
                var me = this
                requestAnimationFrame(function () { })
                if (me.move.isDrag) {
                    var top = e.clientY;
                    var left = e.clientX;
                    var moveTop = top - me.move.drag.y;
                    var moveLeft = left - me.move.drag.x;
                    me.moveTop = (me.move.drag.offsetY + moveTop);
                    me.moveLeft =  (me.move.drag.offsetX + moveLeft);
                }

                if(me.rotate.isRotate) {
                    var p = { x: 1920 / 2, y : 1080 / 2 };
                    var angle = utils.calcTriangleAngle(p, { x: e.clientX, y: e.clientY })
                    angle = angle - me.rotate.angle;
                    me.$emit('update:angle', angle);
                }
            },
            onScaleView: function(e) {
                var me = this;
                me.scale = event.wheelDelta > 0 ? me.scale + 0.05 : me.scale - 0.05;
                me.scale = me.scale > 4 ? 4 : me.scale < 0 ? 0 : me.scale;
            },
			cancelMarkHighlight: function() {
				var me = this;
				me.$refs.crossRoad && me.$refs.crossRoad.onCancelLaneMarkHighlight();
				me.$refs.yRoad && me.$refs.yRoad.onCancelLaneMarkHighlight();
				me.$refs.tRoad && me.$refs.tRoad.onCancelLaneMarkHighlight();
				me.$refs.kRoad && me.$refs.kRoad.onCancelLaneMarkHighlight();
				me.$refs.lRoad && me.$refs.lRoad.onCancelLaneMarkHighlight();
				me.$refs.oRoad && me.$refs.oRoad.onCancelLaneMarkHighlight();
			},
            setActive: function(index) {
                var me = this;
                me.active = index;
            }
        }
    })

    function initialize() {
        Vue.component("intersection", intersection);
    }

    exports.install = initialize;
    Object.defineProperty(exports, '__esModule', { value: true });
})));